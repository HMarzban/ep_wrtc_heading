{"version":3,"sources":["adapter.js","getUserMediaPolyfill.js","jquery.tmpl.min.js","getStats.min.js","clientShare.js","copyPasteEvents.js","codecsHandler.js","textChat.js","videoChat.js","webrtcRoom.js","webrtc.js"],"names":["f","exports","module","define","amd","window","global","self","this","adapter","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","adapterFactory","./adapter_factory.js","2","Object","defineProperty","value","_ref","arguments","undefined","options","shimChrome","shimFirefox","shimEdge","shimSafari","logging","utils","log","browserDetails","detectBrowser","commonShim","extractVersion","disableLog","disableWarnings","browser","chromeShim","shimPeerConnection","browserShim","shimGetUserMedia","shimMediaStream","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimGetStats","shimSenderReceiverGetStats","fixNegotiationNeeded","shimRTCIceCandidate","shimConnectionState","shimMaxMessageSize","shimSendThrowTypeError","removeAllowExtmapMixed","firefoxShim","shimRemoveStream","shimSenderGetStats","shimReceiverGetStats","shimRTCDataChannel","edgeShim","shimGetDisplayMedia","shimReplaceTrack","safariShim","shimRTCIceServerUrls","shimCreateOfferLegacy","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","_interopRequireWildcard","obj","__esModule","newObj","key","prototype","hasOwnProperty","default","./chrome/chrome_shim","./common_shim","./edge/edge_shim","./firefox/firefox_shim","./safari/safari_shim","./utils","3","_typeof","Symbol","iterator","constructor","_getusermedia","enumerable","get","_getdisplaymedia","MediaStream","webkitMediaStream","RTCPeerConnection","_ontrack","set","removeEventListener","addEventListener","configurable","origSetRemoteDescription","setRemoteDescription","_this","_ontrackpoly","stream","te","receiver","getReceivers","find","track","id","event","Event","transceiver","streams","dispatchEvent","getTracks","forEach","apply","wrapPeerConnectionEvent","shimSenderWithDtmf","pc","dtmf","_dtmf","kind","createDTMFSender","_pc","getSenders","_senders","slice","origAddTrack","addTrack","sender","push","origRemoveTrack","removeTrack","idx","indexOf","splice","origAddStream","addStream","_this2","origRemoveStream","removeStream","_this3","s","RTCRtpSender","origGetSenders","_this4","senders","origGetStats","getStats","_this5","_arguments","Array","selector","onSucc","onErr","fixChromeStats_","response","standardReport","result","report","standardStats","timestamp","type","localcandidate","remotecandidate","names","name","stat","makeMapStats","stats","Map","keys","map","successCallbackWrapper_","Promise","resolve","reject","then","RTCRtpReceiver","_this6","filterStats","origGetReceivers","_this7","receivers","srcElement","MediaStreamTrack","err","DOMException","shimAddTrackRemoveTrackWithNative","version","origGetLocalStreams","getLocalStreams","_this11","nativeStreams","_reverseStreams","_this12","_streams","newStream","replaceInternalStreamId","description","sdp","internalId","externalStream","internalStream","replace","RegExp","RTCSessionDescription","replaceExternalStreamId","_this13","signalingState","alreadyExists","oldStream","method","nativeMethod","methodObj","_defineProperty","_this14","args","isLegacyCall","desc","origSetLocalDescription","setLocalDescription","origLocalDescription","getOwnPropertyDescriptor","_this15","streamid","webkitRTCPeerConnection","RTCIceCandidate","nativeAddIceCandidate","addIceCandidate","candidate","target","writable","_this8","_shimmedLocalStreams","streamId","_this9","existingSenders","newSenders","filter","newSender","concat","_this10","../utils.js","./getdisplaymedia","./getusermedia","4","getSourceId","navigator","mediaDevices","console","error","getDisplayMedia","constraints","sourceId","widthSpecified","video","width","heightSpecified","height","frameRateSpecified","frameRate","mandatory","chromeMediaSource","chromeMediaSourceId","maxFrameRate","maxWidth","maxHeight","getUserMedia","5","constraintsToChrome_","optional","cc","ideal","exact","min","max","oldname_","prefix","charAt","toUpperCase","oc","mix","advanced","shimConstraints_","func","JSON","parse","stringify","audio","remap","b","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","matches","enumerateDevices","devices","dev","d","some","match","label","toLowerCase","includes","deviceId","shimError_","PermissionDeniedError","PermissionDismissedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","message","constraint","constraintName","toString","onSuccess","onError","webkitGetUserMedia","bind","origGetUserMedia","cs","getAudioTracks","getVideoTracks","stop","6","NativeRTCIceCandidate","substr","nativeCandidate","parsedCandidate","_sdp2","parseCandidate","augmentedCandidate","assign","toJSON","sdpMid","sdpMLineIndex","usernameFragment","_sctp","sctpInDescription","sections","splitSections","shift","mediaSection","mLine","parseMLine","protocol","getRemoteFirefoxVersion","parseInt","getCanSendMaxMessageSize","remoteIsFirefox","canSendMaxMessageSize","getMaxMessageSize","maxMessageSize","matchPrefix","_getConfiguration","getConfiguration","sdpSemantics","isFirefox","canSendMMS","remoteMMS","Number","POSITIVE_INFINITY","Math","sctp","wrapDcSend","dc","origDataChannelSend","send","data","size","byteLength","readyState","TypeError","origCreateDataChannel","createDataChannel","dataChannel","channel","proto","completed","checking","iceConnectionState","_onconnectionstatechange","cb","origMethod","_connectionstatechangepoly","_lastConnectionState","connectionState","newEvent","nativeSRD","split","line","trim","join","_sdp","7","RTCIceGatherer","origMSTEnabled","ev","enabled","RTCDtmfSender","RTCDTMFSender","RTCPeerConnectionShim","_rtcpeerconnectionShim2","config","iceServers","_filtericeservers","filterIceServers","replaceTrack","setTrack","_rtcpeerconnectionShim","../utils","./filtericeservers","rtcpeerconnection-shim","8","edgeVersion","hasTurn","server","urls","url","deprecated","isString","validTurn","startsWith","9","10","catch","11","RTCTrackEvent","mozRTCPeerConnection","modernStatsTypes","inboundrtp","outboundrtp","candidatepair","nativeGetStats","DataChannel","RTCDataChannel","12","preferredMediaSource","mediaSource","13","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","14","_localStreams","_addTrack","index","tracks","getRemoteStreams","_remoteStreams","_onaddstream","_onaddstreampoly","origCreateOffer","createOffer","origCreateAnswer","createAnswer","successCallback","failureCallback","promise","withCallback","_getUserMedia","shimConstraints","errcb","OrigPeerConnection","pcConfig","pcConstraints","newIceServers","generateCertificate","offerOptions","offerToReceiveAudio","audioTransceiver","getTransceivers","direction","setDirection","addTransceiver","offerToReceiveVideo","videoTransceiver","compactObject","15","eventNameToWrap","wrapper","nativeAddEventListener","nativeEventName","wrappedCallback","modifiedEvent","_eventMap","nativeRemoveEventListener","unwrappedCb","bool","logDisabled_","deprecationWarnings_","oldMethod","newMethod","warn","mozGetUserMedia","userAgent","isSecureContext","supportsUnifiedPlan","RTCRtpTransceiver","isObject","reduce","accumulator","isObj","isEmptyObject","walkStats","outbound","streamStatsType","filteredResult","trackStats","trackIdentifier","trackStat","trackId","uastring","expr","pos","val","base","resultSet","has","endsWith","16","SDPUtils","writeMediaSection","caps","dtlsRole","writeRtpDescription","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","_initialTrackId","msid","sendEncodingParameters","ssrc","rtx","localCName","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","clockRate","numChannels","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","offer","answer","maybeAddCandidate","iceTransport","alreadyAdded","getRemoteCandidates","remoteCandidate","foundation","ip","port","priority","addRemoteCandidate","makeError","NotSupportedError","InvalidAccessError","OperationError","addTrackToStreamAndFireEvent","MediaStreamTrackEvent","fireAddTrack","trackEvent","setTimeout","_dispatchEvent","_eventTarget","document","createDocumentFragment","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","_localDescription","_remoteDescription","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","_isClosed","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","_emitGatheringStateChange","_createTransceiver","doNotAdd","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","_maybeFireNegotiationNeeded","clonedStream","clone","clonedTrack","_createIceGatherer","bufferedCandidateEvents","bufferCandidates","end","state","_gather","onlocalcandidate","evt","cand","component","ufrag","serializedCandidate","writeCandidate","getMediaSections","getDescription","complete","every","RTCIceTransport","onicestatechange","_updateIceConnectionState","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","recv","params","encodings","rtcp","cname","compound","rtcpParameters","receive","sessionpart","parseRtpParameters","isIceLite","isRejected","rejected","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","start","_updateSignalingState","receiverList","iceOptions","lines","splitLines","getKind","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","setTransport","setRemoteCandidates","getCapabilities","codec","isNewTrack","nativeTrack","removeTrackFromStreamAndFireEvent","sid","item","close","newState","states","new","closed","connected","disconnected","failed","connecting","numAudioTracks","numVideoTracks","writeSessionBoilerplate","remoteCodec","hdrExt","rHdrExt","getLocalCandidates","mediaSectionsInOffer","localTrack","reducedSize","candidateString","senderOrReceiver","promises","all","allStats","results","ortcObjectName","nativeGetstats","nativeStats","mapStats","methods","17","random","blob","part","parts","substring","address","relatedAddress","relatedPort","tcpType","parseIceOptions","parseRtpMap","parsed","channels","writeRtpMap","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","param","parseRtcpFb","writeRtcpFb","parseSsrcMedia","sp","colon","attribute","parseSsrcGroup","semantics","ssrcs","parseFingerprint","algorithm","fingerprints","setupType","fp","password","mline","rtpmapline","fmtps","maxptime","extension","secondarySsrc","encodingParameters","hasRed","hasUlpfec","primarySsrc","flows","encParam","codecPayloadType","fec","mechanism","bandwidth","maxBitrate","remoteSsrc","rsize","mux","spec","planB","msidParts","sessId","sessVer","sessUser","fmt","parseOLine","username","sessionId","sessionVersion","netType","addressType","isValidSDP","msGetUserMedia","fn","domManip","q","h","l","g","_wrap","tmpl","parent","nodes","calls","nest","w","wrap","x","html","v","update","extend","_ctnt","m","createElement","innerHTML","makeArray","childNodes","Function","tag","_default","test","k","$1","$2","isArray","nodeType","getElementsByTagName","getAttribute","parentNode","removeAttribute","pop","_","template","wrapped","innerText","textContent","outerHTML","appendChild","cloneNode","insertBefore","remove","each","appendTo","prependTo","insertAfter","replaceAll","pushStack","tmplItem","afterManip","encode","open","if","else","=","!","jQuery","mediaStreamTrack","callback","interval","getStatsLooper","getStatsWrapper","getStatsParser","stack","peer","search","nomore","getStatsResult","datachannel","ended","speed","bytesSent","helper","audioBytesSent","videoBytesSent","InstallTrigger","isSafari","res","items","that","browserFakeUserAgent","documentElement","captureStream","mozCaptureStream","getContext","play","pause","drawImage","toDataURL","HTMLVideoElement","location","href","hash","screen","URL","createObjectURL","revokeObjectURL","systemNetworkType","connection","encryption","availableBandwidth","framerateMean","bitrateMean","bytesReceived","latency","packetsLost","systemBandwidth","sentPerSecond","encodedPerSecond","videoBytestSent","connectionType","systemIpAddress","local","candidateType","transport","ipAddress","networkType","remote","resolutions","internal","candidates","checkIfOfferer","isOfferer","googInitiator","googCertificate","googFingerprintAlgorithm","fingerprintAlgorithm","checkAudioTracks","mediaType","sendrecvType","isRemote","googCodecName","kilobytes","prevBytesSent","bytes","toFixed","prevBytesReceived","googTrackId","googCurrentDelayMs","prevGoogCurrentDelayMs","prevPacketsLost","checkVideoTracks","googFrameHeightReceived","googFrameWidthReceived","googFrameHeightSent","googFrameWidthSent","prevFramerateMean","prevBitrateMean","bweforvideo","availableSendBandwidth","googAvailableSendBandwidth","googActualEncBitrate","googAvailableReceiveBandwidth","googRetransmitBitrate","googTargetEncBitrate","googBucketDelay","googTransmitBitrate","candidatePair","googActiveConnection","cid","googLocalAddress","googRemoteAddress","googTransportType","localCandidate","localCandidateId","remoteCandidateId","selected","nominated","mozLocalTransport","mozRemoteTransport","availableOutgoingBitrate","prevAvailableOutgoingBitrate","availableIncomingBitrate","prevAvailableIncomingBitrate","LOCAL_candidateType","LOCAL_transport","LOCAL_ipAddress","LOCAL_networkType","portNumber","REMOTE_candidateType","REMOTE_transport","REMOTE_ipAddress","REMOTE_networkType","dataSentReceived","remoteSource","frameWidth","frameHeight","SSRC","share","avatarUrl","scrollDownToLastChatText","$element","$","animate","scrollTop","scrollHeight","duration","queue","getUserFromId","userId","pad","collabClient","getConnectedUsers","user","slugify","text","$body_ace_outer","contents","wrtcStore","components","active","room","wrtcPubsub","events","on","eventName","off","emit","_len","_key","inlineAvatar","ROOM","headerId","inlineAvatarLimit","clientVars","webrtc","css","left","WRTC_Room","getHeaderRoomX","userInList","colorId","ep_profile_list","imageUrl","img","hide","append","show","TEXT","list","VIDEO","el","componentName","status","requestUser","roomInfo","USERS","users","actions","$headingRoom","$btnVideo","$btnText","$btnPlus","prop","newAction","attr","data-action","createShareLink","headingTagId","headerText","origin","pathname","notifyNewUserJoined","msg","btnJoin","headerTitle","roomCounter","userCount","VIDEOCHATLIMIT","authorClass","charCodeAt","minutes","Date","time","getMinutes","hours","getHours","timeStr","headId","userName","addTextChatMessage","roomBoxIconActive","textActive","videoActive","addClass","removeClass","appendUserList","empty","getUserId","stopStreaming","randomString","padInner","getFirstColumnOfSelection","rep","firstLineOfSelection","selStart","getLastColumnOfSelection","lastLineOfSelection","nextLine","startLineOffset","offsetOfIndex","getLength","selEnd","hasCommentOnLine","lineNumber","firstColumn","lastColumn","attributeManager","foundHeadOnLine","column","object","getAttributesOnPosition","getSelectionHtml","getSelection","sel","rangeCount","container","len","getRangeAt","cloneContents","selection","createRange","htmlText","hasHeaderOnSelection","hasVideoHeader","documentAttributeManager","selectionOfMultipleLine","hasMultipleLineSelected","foundLineWithComment","hasCommentOnMultipleLineSelection","hasMultipleLine","addTextOnClipboard","aces","inner","removeSelection","hTag","content","callWithAce","ace","ace_hasHeaderOnSelection","rawHtml","selectionMultipleLine","closest","eq","originalEvent","clipboardData","setData","preventDefault","execCommand","CodecsHandler","preferCodec","codecName","info","videoCodecNumbers","vp8LineNumber","vp9LineNumber","h264LineNumber","preferCodecHelper","ignore","preferCodecNumber","newLine","videoCodecNumbersOriginal","newOrder","codecNumber","findLine","sdpLines","startLine","endLine","realEndLine","findLineInRange","getCodecPayloadType","sdpLine","pattern","removeVPX","disableNACK","prioritize","codecMimeType","getParameters","mimeType","unshift","setParameters","removeNonG722","setApplicationSpecificBandwidth","isScreen","setBAS","setVideoBitrates","vp8Payload","xgoogle_min_bitrate","xgoogle_max_bitrate","videoCodec","vp8Index","rtxPayload","rtxIndex","rtxFmtpLineIndex","appendrtxNext","setOpusAttributes","opusPayload","opusIndex","opusFmtpLineIndex","appendOpusNext","stereo","maxaveragebitrate","maxplaybackrate","cbr","useinbandfec","usedtx","preferVP9","forceStereoAudio","fmtpLineIndex","extractSdp","padutils","textChat","socket","padId","currentRoom","$joinBtn","createAndAppendMessage","tim","class","escapeHtmlWithClickableLinks","data-authorid","author","eventTextChatInput","keyCode","which","textMessage","getTime","incomMsg","deactivateModal","$TextChatWrapper","removeAttr","$btn","toggle","activateModal","headTitle","existTextChat","data-id","textChatBox","headingId","addUserToRoom","present","data-text","removeUserFromRoom","$textChatUserList","socketBulkUpdateRooms","rooms","roomsInfo","postAceInit","hook","context","webSocket","docId","chatBox","innerHeight","transform","userJoin","userData","$joinButton","userLeave","bulkUpdateRooms","hTagList","videoChat","localStream","data-video","WRTC","activate","prepend","opacity","data-active","hasClass","createSession","userInfo","gateway_userJoin","_userData","gateway_userLeave","showUserMediaError","reachedVideoRoomSize","showAlert","isBulkUpdate","gritter","add","title","sticky","class_name","bulkUpdate","$videoChatUserList","deactivate","removeListener","videoChatLimit","videoSettings","localStorage","getItem","microphone","speaker","camera","audioInputSelect","querySelector","audioOutputSelect","videoSelect","deviceInfo","option","reloadSession","hElements","scroll2Header","scrollIntoView","behavior","closeTextChat","trigger","roomBtnHandler","getPadId","joinChatRoom","leaveChatRoom","pathName","link","$temp","select","shareRoomsLink","getHeaderRoomY","outerHeight","paddingTop","aceOuterPadding","ceil","offset","top","outerWidth","paddingLeft","activeEventListener","$wbrtc_roomBox","headerURI","toggleClass","position","$box","aceSetAuthorStyle","border-color","urlParams","URLSearchParams","adoptHeaderYRoom","$padOuter","$el","hClassId","$headingEl","findTags","hTagElements","hTags","children","aceInnerOffset","newHTagAdded","newY","newX","exec","positionTop","positionLeft","box","avatarBox","attemptRonnect","reconnected","videoSizes","large","small","DtlsSrtpKeyAgreement","sdpConstraints","OfferToReceiveAudio","OfferToReceiveVideo","remoteStream","callQueue","enlargedVideos","Set","localVideoElement","sizes","_pad","audioVideoInputChange","changeAudioDestination","hangupAll","appendInterfaceLayout","werc_toolbar","$wrtc_modal","$parent","videoBox","userID","$this","isActive","$modal","bytesToSize","floor","pow","toPrecision","statistic","send.codecs","$btnInfo","siblings","gState","hangup","handleClientMessage_RTC_MESSAGE","payload","receiveMessage","reason","sendErrorStat","hostname","toggleMuted","audioTrack","toggleVideo","videoTrack","setStream","isLocal","videoId","videoContainer","max-height","loadedmetadata","addInterface","autoplay","muted","attachMediaStream","$video","$mute","click","videoEnabled","$disableVideo","videoEnlarged","$largeVideo","videoSize","statName","json","sendMessage","to","from","createPeerConnection","cleanupSdp","logError","_headerId","notify","webrtcDetectedBrowser","cons1","cons2","merged","mergeConstraints","attachSinkId","element","sinkId","setSinkId","errorMessage","selectedIndex","audioDestination","videoElement","audioSource","videoSource","audioOutput","mediaConstraints","setItem","srcObject","mozSrcObject","src","minVideo","maxVideo"],"mappings":"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","file":"wrtc.heading.mini.js","sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.adapter = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t\r\n\t'use strict';\r\n\t\r\n\tvar _adapter_factory = require('./adapter_factory.js');\r\n\t\r\n\tvar adapter = (0, _adapter_factory.adapterFactory)({ window: window });\r\n\tmodule.exports = adapter; // this is the difference from adapter_core.\r\n\t\r\n\t},{\"./adapter_factory.js\":2}],2:[function(require,module,exports){\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.adapterFactory = adapterFactory;\r\n\t\r\n\tvar _utils = require('./utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tvar _chrome_shim = require('./chrome/chrome_shim');\r\n\t\r\n\tvar chromeShim = _interopRequireWildcard(_chrome_shim);\r\n\t\r\n\tvar _edge_shim = require('./edge/edge_shim');\r\n\t\r\n\tvar edgeShim = _interopRequireWildcard(_edge_shim);\r\n\t\r\n\tvar _firefox_shim = require('./firefox/firefox_shim');\r\n\t\r\n\tvar firefoxShim = _interopRequireWildcard(_firefox_shim);\r\n\t\r\n\tvar _safari_shim = require('./safari/safari_shim');\r\n\t\r\n\tvar safariShim = _interopRequireWildcard(_safari_shim);\r\n\t\r\n\tvar _common_shim = require('./common_shim');\r\n\t\r\n\tvar commonShim = _interopRequireWildcard(_common_shim);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\t// Shimming starts here.\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\tfunction adapterFactory() {\r\n\t\tvar _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\r\n\t\t\t\twindow = _ref.window;\r\n\t\r\n\t\tvar options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\r\n\t\t\tshimChrome: true,\r\n\t\t\tshimFirefox: true,\r\n\t\t\tshimEdge: true,\r\n\t\t\tshimSafari: true\r\n\t\t};\r\n\t\r\n\t\t// Utils.\r\n\t\tvar logging = utils.log;\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tvar adapter = {\r\n\t\t\tbrowserDetails: browserDetails,\r\n\t\t\tcommonShim: commonShim,\r\n\t\t\textractVersion: utils.extractVersion,\r\n\t\t\tdisableLog: utils.disableLog,\r\n\t\t\tdisableWarnings: utils.disableWarnings\r\n\t\t};\r\n\t\r\n\t\t// Shim browser if found.\r\n\t\tswitch (browserDetails.browser) {\r\n\t\t\tcase 'chrome':\r\n\t\t\t\tif (!chromeShim || !chromeShim.shimPeerConnection || !options.shimChrome) {\r\n\t\t\t\t\tlogging('Chrome shim is not included in this adapter release.');\r\n\t\t\t\t\treturn adapter;\r\n\t\t\t\t}\r\n\t\t\t\tlogging('adapter.js shimming chrome.');\r\n\t\t\t\t// Export to the adapter global object visible in the browser.\r\n\t\t\t\tadapter.browserShim = chromeShim;\r\n\t\r\n\t\t\t\tchromeShim.shimGetUserMedia(window);\r\n\t\t\t\tchromeShim.shimMediaStream(window);\r\n\t\t\t\tchromeShim.shimPeerConnection(window);\r\n\t\t\t\tchromeShim.shimOnTrack(window);\r\n\t\t\t\tchromeShim.shimAddTrackRemoveTrack(window);\r\n\t\t\t\tchromeShim.shimGetSendersWithDtmf(window);\r\n\t\t\t\tchromeShim.shimGetStats(window);\r\n\t\t\t\tchromeShim.shimSenderReceiverGetStats(window);\r\n\t\t\t\tchromeShim.fixNegotiationNeeded(window);\r\n\t\r\n\t\t\t\tcommonShim.shimRTCIceCandidate(window);\r\n\t\t\t\tcommonShim.shimConnectionState(window);\r\n\t\t\t\tcommonShim.shimMaxMessageSize(window);\r\n\t\t\t\tcommonShim.shimSendThrowTypeError(window);\r\n\t\t\t\tcommonShim.removeAllowExtmapMixed(window);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'firefox':\r\n\t\t\t\tif (!firefoxShim || !firefoxShim.shimPeerConnection || !options.shimFirefox) {\r\n\t\t\t\t\tlogging('Firefox shim is not included in this adapter release.');\r\n\t\t\t\t\treturn adapter;\r\n\t\t\t\t}\r\n\t\t\t\tlogging('adapter.js shimming firefox.');\r\n\t\t\t\t// Export to the adapter global object visible in the browser.\r\n\t\t\t\tadapter.browserShim = firefoxShim;\r\n\t\r\n\t\t\t\tfirefoxShim.shimGetUserMedia(window);\r\n\t\t\t\tfirefoxShim.shimPeerConnection(window);\r\n\t\t\t\tfirefoxShim.shimOnTrack(window);\r\n\t\t\t\tfirefoxShim.shimRemoveStream(window);\r\n\t\t\t\tfirefoxShim.shimSenderGetStats(window);\r\n\t\t\t\tfirefoxShim.shimReceiverGetStats(window);\r\n\t\t\t\tfirefoxShim.shimRTCDataChannel(window);\r\n\t\r\n\t\t\t\tcommonShim.shimRTCIceCandidate(window);\r\n\t\t\t\tcommonShim.shimConnectionState(window);\r\n\t\t\t\tcommonShim.shimMaxMessageSize(window);\r\n\t\t\t\tcommonShim.shimSendThrowTypeError(window);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'edge':\r\n\t\t\t\tif (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\r\n\t\t\t\t\tlogging('MS edge shim is not included in this adapter release.');\r\n\t\t\t\t\treturn adapter;\r\n\t\t\t\t}\r\n\t\t\t\tlogging('adapter.js shimming edge.');\r\n\t\t\t\t// Export to the adapter global object visible in the browser.\r\n\t\t\t\tadapter.browserShim = edgeShim;\r\n\t\r\n\t\t\t\tedgeShim.shimGetUserMedia(window);\r\n\t\t\t\tedgeShim.shimGetDisplayMedia(window);\r\n\t\t\t\tedgeShim.shimPeerConnection(window);\r\n\t\t\t\tedgeShim.shimReplaceTrack(window);\r\n\t\r\n\t\t\t\t// the edge shim implements the full RTCIceCandidate object.\r\n\t\r\n\t\t\t\tcommonShim.shimMaxMessageSize(window);\r\n\t\t\t\tcommonShim.shimSendThrowTypeError(window);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'safari':\r\n\t\t\t\tif (!safariShim || !options.shimSafari) {\r\n\t\t\t\t\tlogging('Safari shim is not included in this adapter release.');\r\n\t\t\t\t\treturn adapter;\r\n\t\t\t\t}\r\n\t\t\t\tlogging('adapter.js shimming safari.');\r\n\t\t\t\t// Export to the adapter global object visible in the browser.\r\n\t\t\t\tadapter.browserShim = safariShim;\r\n\t\r\n\t\t\t\tsafariShim.shimRTCIceServerUrls(window);\r\n\t\t\t\tsafariShim.shimCreateOfferLegacy(window);\r\n\t\t\t\tsafariShim.shimCallbacksAPI(window);\r\n\t\t\t\tsafariShim.shimLocalStreamsAPI(window);\r\n\t\t\t\tsafariShim.shimRemoteStreamsAPI(window);\r\n\t\t\t\tsafariShim.shimTrackEventTransceiver(window);\r\n\t\t\t\tsafariShim.shimGetUserMedia(window);\r\n\t\r\n\t\t\t\tcommonShim.shimRTCIceCandidate(window);\r\n\t\t\t\tcommonShim.shimMaxMessageSize(window);\r\n\t\t\t\tcommonShim.shimSendThrowTypeError(window);\r\n\t\t\t\tcommonShim.removeAllowExtmapMixed(window);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tlogging('Unsupported browser!');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\r\n\t\treturn adapter;\r\n\t}\r\n\t\r\n\t// Browser shims.\r\n\t\r\n\t},{\"./chrome/chrome_shim\":3,\"./common_shim\":6,\"./edge/edge_shim\":7,\"./firefox/firefox_shim\":11,\"./safari/safari_shim\":14,\"./utils\":15}],3:[function(require,module,exports){\r\n\t\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\tvar _getusermedia = require('./getusermedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetUserMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getusermedia.shimGetUserMedia;\r\n\t\t}\r\n\t});\r\n\t\r\n\tvar _getdisplaymedia = require('./getdisplaymedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetDisplayMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getdisplaymedia.shimGetDisplayMedia;\r\n\t\t}\r\n\t});\r\n\texports.shimMediaStream = shimMediaStream;\r\n\texports.shimOnTrack = shimOnTrack;\r\n\texports.shimGetSendersWithDtmf = shimGetSendersWithDtmf;\r\n\texports.shimGetStats = shimGetStats;\r\n\texports.shimSenderReceiverGetStats = shimSenderReceiverGetStats;\r\n\texports.shimAddTrackRemoveTrackWithNative = shimAddTrackRemoveTrackWithNative;\r\n\texports.shimAddTrackRemoveTrack = shimAddTrackRemoveTrack;\r\n\texports.shimPeerConnection = shimPeerConnection;\r\n\texports.fixNegotiationNeeded = fixNegotiationNeeded;\r\n\t\r\n\tvar _utils = require('../utils.js');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\r\n\t\r\n\tfunction shimMediaStream(window) {\r\n\t\twindow.MediaStream = window.MediaStream || window.webkitMediaStream;\r\n\t}\r\n\t\r\n\tfunction shimOnTrack(window) {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('ontrack' in window.RTCPeerConnection.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn this._ontrack;\r\n\t\t\t\t},\r\n\t\t\t\tset: function set(f) {\r\n\t\t\t\t\tif (this._ontrack) {\r\n\t\t\t\t\t\tthis.removeEventListener('track', this._ontrack);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.addEventListener('track', this._ontrack = f);\r\n\t\t\t\t},\r\n\t\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tconfigurable: true\r\n\t\t\t});\r\n\t\t\tvar origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n\t\t\twindow.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\r\n\t\t\t\tvar _this = this;\r\n\t\r\n\t\t\t\tif (!this._ontrackpoly) {\r\n\t\t\t\t\tthis._ontrackpoly = function (e) {\r\n\t\t\t\t\t\t// onaddstream does not fire when a track is added to an existing\r\n\t\t\t\t\t\t// stream. But stream.onaddtrack is implemented so we use that.\r\n\t\t\t\t\t\te.stream.addEventListener('addtrack', function (te) {\r\n\t\t\t\t\t\t\tvar receiver = void 0;\r\n\t\t\t\t\t\t\tif (window.RTCPeerConnection.prototype.getReceivers) {\r\n\t\t\t\t\t\t\t\treceiver = _this.getReceivers().find(function (r) {\r\n\t\t\t\t\t\t\t\t\treturn r.track && r.track.id === te.track.id;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treceiver = { track: te.track };\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\tvar event = new Event('track');\r\n\t\t\t\t\t\t\tevent.track = te.track;\r\n\t\t\t\t\t\t\tevent.receiver = receiver;\r\n\t\t\t\t\t\t\tevent.transceiver = { receiver: receiver };\r\n\t\t\t\t\t\t\tevent.streams = [e.stream];\r\n\t\t\t\t\t\t\t_this.dispatchEvent(event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\te.stream.getTracks().forEach(function (track) {\r\n\t\t\t\t\t\t\tvar receiver = void 0;\r\n\t\t\t\t\t\t\tif (window.RTCPeerConnection.prototype.getReceivers) {\r\n\t\t\t\t\t\t\t\treceiver = _this.getReceivers().find(function (r) {\r\n\t\t\t\t\t\t\t\t\treturn r.track && r.track.id === track.id;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treceiver = { track: track };\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar event = new Event('track');\r\n\t\t\t\t\t\t\tevent.track = track;\r\n\t\t\t\t\t\t\tevent.receiver = receiver;\r\n\t\t\t\t\t\t\tevent.transceiver = { receiver: receiver };\r\n\t\t\t\t\t\t\tevent.streams = [e.stream];\r\n\t\t\t\t\t\t\t_this.dispatchEvent(event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.addEventListener('addstream', this._ontrackpoly);\r\n\t\t\t\t}\r\n\t\t\t\treturn origSetRemoteDescription.apply(this, arguments);\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\t// even if RTCRtpTransceiver is in window, it is only used and\r\n\t\t\t// emitted in unified-plan. Unfortunately this means we need\r\n\t\t\t// to unconditionally wrap the event.\r\n\t\t\tutils.wrapPeerConnectionEvent(window, 'track', function (e) {\r\n\t\t\t\tif (!e.transceiver) {\r\n\t\t\t\t\tObject.defineProperty(e, 'transceiver', { value: { receiver: e.receiver } });\r\n\t\t\t\t}\r\n\t\t\t\treturn e;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimGetSendersWithDtmf(window) {\r\n\t\t// Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('getSenders' in window.RTCPeerConnection.prototype) && 'createDTMFSender' in window.RTCPeerConnection.prototype) {\r\n\t\t\tvar shimSenderWithDtmf = function shimSenderWithDtmf(pc, track) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttrack: track,\r\n\t\t\t\t\tget dtmf() {\r\n\t\t\t\t\t\tif (this._dtmf === undefined) {\r\n\t\t\t\t\t\t\tif (track.kind === 'audio') {\r\n\t\t\t\t\t\t\t\tthis._dtmf = pc.createDTMFSender(track);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis._dtmf = null;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn this._dtmf;\r\n\t\t\t\t\t},\r\n\t\t\t\t\t_pc: pc\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\r\n\t\t\t// augment addTrack when getSenders is not available.\r\n\t\t\tif (!window.RTCPeerConnection.prototype.getSenders) {\r\n\t\t\t\twindow.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n\t\t\t\t\tthis._senders = this._senders || [];\r\n\t\t\t\t\treturn this._senders.slice(); // return a copy of the internal state.\r\n\t\t\t\t};\r\n\t\t\t\tvar origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n\t\t\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\r\n\t\t\t\t\tvar sender = origAddTrack.apply(this, arguments);\r\n\t\t\t\t\tif (!sender) {\r\n\t\t\t\t\t\tsender = shimSenderWithDtmf(this, track);\r\n\t\t\t\t\t\tthis._senders.push(sender);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn sender;\r\n\t\t\t\t};\r\n\t\r\n\t\t\t\tvar origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\r\n\t\t\t\twindow.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\r\n\t\t\t\t\torigRemoveTrack.apply(this, arguments);\r\n\t\t\t\t\tvar idx = this._senders.indexOf(sender);\r\n\t\t\t\t\tif (idx !== -1) {\r\n\t\t\t\t\t\tthis._senders.splice(idx, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tvar origAddStream = window.RTCPeerConnection.prototype.addStream;\r\n\t\t\twindow.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n\t\t\t\tvar _this2 = this;\r\n\t\r\n\t\t\t\tthis._senders = this._senders || [];\r\n\t\t\t\torigAddStream.apply(this, [stream]);\r\n\t\t\t\tstream.getTracks().forEach(function (track) {\r\n\t\t\t\t\t_this2._senders.push(shimSenderWithDtmf(_this2, track));\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\r\n\t\t\tvar origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\r\n\t\t\twindow.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n\t\t\t\tvar _this3 = this;\r\n\t\r\n\t\t\t\tthis._senders = this._senders || [];\r\n\t\t\t\torigRemoveStream.apply(this, [stream]);\r\n\t\r\n\t\t\t\tstream.getTracks().forEach(function (track) {\r\n\t\t\t\t\tvar sender = _this3._senders.find(function (s) {\r\n\t\t\t\t\t\treturn s.track === track;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (sender) {\r\n\t\t\t\t\t\t// remove sender\r\n\t\t\t\t\t\t_this3._senders.splice(_this3._senders.indexOf(sender), 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t} else if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && 'getSenders' in window.RTCPeerConnection.prototype && 'createDTMFSender' in window.RTCPeerConnection.prototype && window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\r\n\t\t\tvar origGetSenders = window.RTCPeerConnection.prototype.getSenders;\r\n\t\t\twindow.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n\t\t\t\tvar _this4 = this;\r\n\t\r\n\t\t\t\tvar senders = origGetSenders.apply(this, []);\r\n\t\t\t\tsenders.forEach(function (sender) {\r\n\t\t\t\t\treturn sender._pc = _this4;\r\n\t\t\t\t});\r\n\t\t\t\treturn senders;\r\n\t\t\t};\r\n\t\r\n\t\t\tObject.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\tif (this._dtmf === undefined) {\r\n\t\t\t\t\t\tif (this.track.kind === 'audio') {\r\n\t\t\t\t\t\t\tthis._dtmf = this._pc.createDTMFSender(this.track);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._dtmf = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this._dtmf;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimGetStats(window) {\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tvar origGetStats = window.RTCPeerConnection.prototype.getStats;\r\n\t\twindow.RTCPeerConnection.prototype.getStats = function getStats() {\r\n\t\t\tvar _this5 = this;\r\n\t\r\n\t\t\tvar _arguments = Array.prototype.slice.call(arguments),\r\n\t\t\t\t\tselector = _arguments[0],\r\n\t\t\t\t\tonSucc = _arguments[1],\r\n\t\t\t\t\tonErr = _arguments[2];\r\n\t\r\n\t\t\t// If selector is a function then we are in the old style stats so just\r\n\t\t\t// pass back the original getStats format to avoid breaking old users.\r\n\t\r\n\t\r\n\t\t\tif (arguments.length > 0 && typeof selector === 'function') {\r\n\t\t\t\treturn origGetStats.apply(this, arguments);\r\n\t\t\t}\r\n\t\r\n\t\t\t// When spec-style getStats is supported, return those when called with\r\n\t\t\t// either no arguments or the selector argument is null.\r\n\t\t\tif (origGetStats.length === 0 && (arguments.length === 0 || typeof selector !== 'function')) {\r\n\t\t\t\treturn origGetStats.apply(this, []);\r\n\t\t\t}\r\n\t\r\n\t\t\tvar fixChromeStats_ = function fixChromeStats_(response) {\r\n\t\t\t\tvar standardReport = {};\r\n\t\t\t\tvar reports = response.result();\r\n\t\t\t\treports.forEach(function (report) {\r\n\t\t\t\t\tvar standardStats = {\r\n\t\t\t\t\t\tid: report.id,\r\n\t\t\t\t\t\ttimestamp: report.timestamp,\r\n\t\t\t\t\t\ttype: {\r\n\t\t\t\t\t\t\tlocalcandidate: 'local-candidate',\r\n\t\t\t\t\t\t\tremotecandidate: 'remote-candidate'\r\n\t\t\t\t\t\t}[report.type] || report.type\r\n\t\t\t\t\t};\r\n\t\t\t\t\treport.names().forEach(function (name) {\r\n\t\t\t\t\t\tstandardStats[name] = report.stat(name);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tstandardReport[standardStats.id] = standardStats;\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\treturn standardReport;\r\n\t\t\t};\r\n\t\r\n\t\t\t// shim getStats with maplike support\r\n\t\t\tvar makeMapStats = function makeMapStats(stats) {\r\n\t\t\t\treturn new Map(Object.keys(stats).map(function (key) {\r\n\t\t\t\t\treturn [key, stats[key]];\r\n\t\t\t\t}));\r\n\t\t\t};\r\n\t\r\n\t\t\tif (arguments.length >= 2) {\r\n\t\t\t\tvar successCallbackWrapper_ = function successCallbackWrapper_(response) {\r\n\t\t\t\t\tonSucc(makeMapStats(fixChromeStats_(response)));\r\n\t\t\t\t};\r\n\t\r\n\t\t\t\treturn origGetStats.apply(this, [successCallbackWrapper_, selector]);\r\n\t\t\t}\r\n\t\r\n\t\t\t// promise-support\r\n\t\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\t\torigGetStats.apply(_this5, [function (response) {\r\n\t\t\t\t\tresolve(makeMapStats(fixChromeStats_(response)));\r\n\t\t\t\t}, reject]);\r\n\t\t\t}).then(onSucc, onErr);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimSenderReceiverGetStats(window) {\r\n\t\tif (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender && window.RTCRtpReceiver)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\t// shim sender stats.\r\n\t\tif (!('getStats' in window.RTCRtpSender.prototype)) {\r\n\t\t\tvar origGetSenders = window.RTCPeerConnection.prototype.getSenders;\r\n\t\t\tif (origGetSenders) {\r\n\t\t\t\twindow.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n\t\t\t\t\tvar _this6 = this;\r\n\t\r\n\t\t\t\t\tvar senders = origGetSenders.apply(this, []);\r\n\t\t\t\t\tsenders.forEach(function (sender) {\r\n\t\t\t\t\t\treturn sender._pc = _this6;\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn senders;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\r\n\t\t\tvar origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n\t\t\tif (origAddTrack) {\r\n\t\t\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack() {\r\n\t\t\t\t\tvar sender = origAddTrack.apply(this, arguments);\r\n\t\t\t\t\tsender._pc = this;\r\n\t\t\t\t\treturn sender;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\twindow.RTCRtpSender.prototype.getStats = function getStats() {\r\n\t\t\t\tvar sender = this;\r\n\t\t\t\treturn this._pc.getStats().then(function (result) {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t/* Note: this will include stats of all senders that\r\n\t\t\t\t\t\t *   send a track with the same id as sender.track as\r\n\t\t\t\t\t\t *   it is not possible to identify the RTCRtpSender.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tutils.filterStats(result, sender.track, true)\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t\r\n\t\t// shim receiver stats.\r\n\t\tif (!('getStats' in window.RTCRtpReceiver.prototype)) {\r\n\t\t\tvar origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\r\n\t\t\tif (origGetReceivers) {\r\n\t\t\t\twindow.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\r\n\t\t\t\t\tvar _this7 = this;\r\n\t\r\n\t\t\t\t\tvar receivers = origGetReceivers.apply(this, []);\r\n\t\t\t\t\treceivers.forEach(function (receiver) {\r\n\t\t\t\t\t\treturn receiver._pc = _this7;\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn receivers;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tutils.wrapPeerConnectionEvent(window, 'track', function (e) {\r\n\t\t\t\te.receiver._pc = e.srcElement;\r\n\t\t\t\treturn e;\r\n\t\t\t});\r\n\t\t\twindow.RTCRtpReceiver.prototype.getStats = function getStats() {\r\n\t\t\t\tvar receiver = this;\r\n\t\t\t\treturn this._pc.getStats().then(function (result) {\r\n\t\t\t\t\treturn utils.filterStats(result, receiver.track, false);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t\r\n\t\tif (!('getStats' in window.RTCRtpSender.prototype && 'getStats' in window.RTCRtpReceiver.prototype)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\t// shim RTCPeerConnection.getStats(track).\r\n\t\tvar origGetStats = window.RTCPeerConnection.prototype.getStats;\r\n\t\twindow.RTCPeerConnection.prototype.getStats = function getStats() {\r\n\t\t\tif (arguments.length > 0 && arguments[0] instanceof window.MediaStreamTrack) {\r\n\t\t\t\tvar track = arguments[0];\r\n\t\t\t\tvar sender = void 0;\r\n\t\t\t\tvar receiver = void 0;\r\n\t\t\t\tvar err = void 0;\r\n\t\t\t\tthis.getSenders().forEach(function (s) {\r\n\t\t\t\t\tif (s.track === track) {\r\n\t\t\t\t\t\tif (sender) {\r\n\t\t\t\t\t\t\terr = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsender = s;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis.getReceivers().forEach(function (r) {\r\n\t\t\t\t\tif (r.track === track) {\r\n\t\t\t\t\t\tif (receiver) {\r\n\t\t\t\t\t\t\terr = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treceiver = r;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn r.track === track;\r\n\t\t\t\t});\r\n\t\t\t\tif (err || sender && receiver) {\r\n\t\t\t\t\treturn Promise.reject(new DOMException('There are more than one sender or receiver for the track.', 'InvalidAccessError'));\r\n\t\t\t\t} else if (sender) {\r\n\t\t\t\t\treturn sender.getStats();\r\n\t\t\t\t} else if (receiver) {\r\n\t\t\t\t\treturn receiver.getStats();\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.reject(new DOMException('There is no sender or receiver for the track.', 'InvalidAccessError'));\r\n\t\t\t}\r\n\t\t\treturn origGetStats.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimAddTrackRemoveTrackWithNative(window) {\r\n\t\t// shim addTrack/removeTrack with native variants in order to make\r\n\t\t// the interactions with legacy getLocalStreams behave as in other browsers.\r\n\t\t// Keeps a mapping stream.id => [stream, rtpsenders...]\r\n\t\twindow.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\r\n\t\t\tvar _this8 = this;\r\n\t\r\n\t\t\tthis._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\t\t\treturn Object.keys(this._shimmedLocalStreams).map(function (streamId) {\r\n\t\t\t\treturn _this8._shimmedLocalStreams[streamId][0];\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tvar origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\r\n\t\t\tif (!stream) {\r\n\t\t\t\treturn origAddTrack.apply(this, arguments);\r\n\t\t\t}\r\n\t\t\tthis._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\t\r\n\t\t\tvar sender = origAddTrack.apply(this, arguments);\r\n\t\t\tif (!this._shimmedLocalStreams[stream.id]) {\r\n\t\t\t\tthis._shimmedLocalStreams[stream.id] = [stream, sender];\r\n\t\t\t} else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\r\n\t\t\t\tthis._shimmedLocalStreams[stream.id].push(sender);\r\n\t\t\t}\r\n\t\t\treturn sender;\r\n\t\t};\r\n\t\r\n\t\tvar origAddStream = window.RTCPeerConnection.prototype.addStream;\r\n\t\twindow.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n\t\t\tvar _this9 = this;\r\n\t\r\n\t\t\tthis._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\t\r\n\t\t\tstream.getTracks().forEach(function (track) {\r\n\t\t\t\tvar alreadyExists = _this9.getSenders().find(function (s) {\r\n\t\t\t\t\treturn s.track === track;\r\n\t\t\t\t});\r\n\t\t\t\tif (alreadyExists) {\r\n\t\t\t\t\tthrow new DOMException('Track already exists.', 'InvalidAccessError');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tvar existingSenders = this.getSenders();\r\n\t\t\torigAddStream.apply(this, arguments);\r\n\t\t\tvar newSenders = this.getSenders().filter(function (newSender) {\r\n\t\t\t\treturn existingSenders.indexOf(newSender) === -1;\r\n\t\t\t});\r\n\t\t\tthis._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\r\n\t\t};\r\n\t\r\n\t\tvar origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\r\n\t\twindow.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n\t\t\tthis._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\t\t\tdelete this._shimmedLocalStreams[stream.id];\r\n\t\t\treturn origRemoveStream.apply(this, arguments);\r\n\t\t};\r\n\t\r\n\t\tvar origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\r\n\t\twindow.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\r\n\t\t\tvar _this10 = this;\r\n\t\r\n\t\t\tthis._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\t\t\tif (sender) {\r\n\t\t\t\tObject.keys(this._shimmedLocalStreams).forEach(function (streamId) {\r\n\t\t\t\t\tvar idx = _this10._shimmedLocalStreams[streamId].indexOf(sender);\r\n\t\t\t\t\tif (idx !== -1) {\r\n\t\t\t\t\t\t_this10._shimmedLocalStreams[streamId].splice(idx, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (_this10._shimmedLocalStreams[streamId].length === 1) {\r\n\t\t\t\t\t\tdelete _this10._shimmedLocalStreams[streamId];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn origRemoveTrack.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimAddTrackRemoveTrack(window) {\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\t// shim addTrack and removeTrack.\r\n\t\tif (window.RTCPeerConnection.prototype.addTrack && browserDetails.version >= 65) {\r\n\t\t\treturn shimAddTrackRemoveTrackWithNative(window);\r\n\t\t}\r\n\t\r\n\t\t// also shim pc.getLocalStreams when addTrack is shimmed\r\n\t\t// to return the original streams.\r\n\t\tvar origGetLocalStreams = window.RTCPeerConnection.prototype.getLocalStreams;\r\n\t\twindow.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\r\n\t\t\tvar _this11 = this;\r\n\t\r\n\t\t\tvar nativeStreams = origGetLocalStreams.apply(this);\r\n\t\t\tthis._reverseStreams = this._reverseStreams || {};\r\n\t\t\treturn nativeStreams.map(function (stream) {\r\n\t\t\t\treturn _this11._reverseStreams[stream.id];\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tvar origAddStream = window.RTCPeerConnection.prototype.addStream;\r\n\t\twindow.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n\t\t\tvar _this12 = this;\r\n\t\r\n\t\t\tthis._streams = this._streams || {};\r\n\t\t\tthis._reverseStreams = this._reverseStreams || {};\r\n\t\r\n\t\t\tstream.getTracks().forEach(function (track) {\r\n\t\t\t\tvar alreadyExists = _this12.getSenders().find(function (s) {\r\n\t\t\t\t\treturn s.track === track;\r\n\t\t\t\t});\r\n\t\t\t\tif (alreadyExists) {\r\n\t\t\t\t\tthrow new DOMException('Track already exists.', 'InvalidAccessError');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// Add identity mapping for consistency with addTrack.\r\n\t\t\t// Unless this is being used with a stream from addTrack.\r\n\t\t\tif (!this._reverseStreams[stream.id]) {\r\n\t\t\t\tvar newStream = new window.MediaStream(stream.getTracks());\r\n\t\t\t\tthis._streams[stream.id] = newStream;\r\n\t\t\t\tthis._reverseStreams[newStream.id] = stream;\r\n\t\t\t\tstream = newStream;\r\n\t\t\t}\r\n\t\t\torigAddStream.apply(this, [stream]);\r\n\t\t};\r\n\t\r\n\t\tvar origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\r\n\t\twindow.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n\t\t\tthis._streams = this._streams || {};\r\n\t\t\tthis._reverseStreams = this._reverseStreams || {};\r\n\t\r\n\t\t\torigRemoveStream.apply(this, [this._streams[stream.id] || stream]);\r\n\t\t\tdelete this._reverseStreams[this._streams[stream.id] ? this._streams[stream.id].id : stream.id];\r\n\t\t\tdelete this._streams[stream.id];\r\n\t\t};\r\n\t\r\n\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\r\n\t\t\tvar _this13 = this;\r\n\t\r\n\t\t\tif (this.signalingState === 'closed') {\r\n\t\t\t\tthrow new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\r\n\t\t\t}\r\n\t\t\tvar streams = [].slice.call(arguments, 1);\r\n\t\t\tif (streams.length !== 1 || !streams[0].getTracks().find(function (t) {\r\n\t\t\t\treturn t === track;\r\n\t\t\t})) {\r\n\t\t\t\t// this is not fully correct but all we can manage without\r\n\t\t\t\t// [[associated MediaStreams]] internal slot.\r\n\t\t\t\tthrow new DOMException('The adapter.js addTrack polyfill only supports a single ' + ' stream which is associated with the specified track.', 'NotSupportedError');\r\n\t\t\t}\r\n\t\r\n\t\t\tvar alreadyExists = this.getSenders().find(function (s) {\r\n\t\t\t\treturn s.track === track;\r\n\t\t\t});\r\n\t\t\tif (alreadyExists) {\r\n\t\t\t\tthrow new DOMException('Track already exists.', 'InvalidAccessError');\r\n\t\t\t}\r\n\t\r\n\t\t\tthis._streams = this._streams || {};\r\n\t\t\tthis._reverseStreams = this._reverseStreams || {};\r\n\t\t\tvar oldStream = this._streams[stream.id];\r\n\t\t\tif (oldStream) {\r\n\t\t\t\t// this is using odd Chrome behaviour, use with caution:\r\n\t\t\t\t// https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\r\n\t\t\t\t// Note: we rely on the high-level addTrack/dtmf shim to\r\n\t\t\t\t// create the sender with a dtmf sender.\r\n\t\t\t\toldStream.addTrack(track);\r\n\t\r\n\t\t\t\t// Trigger ONN async.\r\n\t\t\t\tPromise.resolve().then(function () {\r\n\t\t\t\t\t_this13.dispatchEvent(new Event('negotiationneeded'));\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tvar newStream = new window.MediaStream([track]);\r\n\t\t\t\tthis._streams[stream.id] = newStream;\r\n\t\t\t\tthis._reverseStreams[newStream.id] = stream;\r\n\t\t\t\tthis.addStream(newStream);\r\n\t\t\t}\r\n\t\t\treturn this.getSenders().find(function (s) {\r\n\t\t\t\treturn s.track === track;\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\t// replace the internal stream id with the external one and\r\n\t\t// vice versa.\r\n\t\tfunction replaceInternalStreamId(pc, description) {\r\n\t\t\tvar sdp = description.sdp;\r\n\t\t\tObject.keys(pc._reverseStreams || []).forEach(function (internalId) {\r\n\t\t\t\tvar externalStream = pc._reverseStreams[internalId];\r\n\t\t\t\tvar internalStream = pc._streams[externalStream.id];\r\n\t\t\t\tsdp = sdp.replace(new RegExp(internalStream.id, 'g'), externalStream.id);\r\n\t\t\t});\r\n\t\t\treturn new RTCSessionDescription({\r\n\t\t\t\ttype: description.type,\r\n\t\t\t\tsdp: sdp\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction replaceExternalStreamId(pc, description) {\r\n\t\t\tvar sdp = description.sdp;\r\n\t\t\tObject.keys(pc._reverseStreams || []).forEach(function (internalId) {\r\n\t\t\t\tvar externalStream = pc._reverseStreams[internalId];\r\n\t\t\t\tvar internalStream = pc._streams[externalStream.id];\r\n\t\t\t\tsdp = sdp.replace(new RegExp(externalStream.id, 'g'), internalStream.id);\r\n\t\t\t});\r\n\t\t\treturn new RTCSessionDescription({\r\n\t\t\t\ttype: description.type,\r\n\t\t\t\tsdp: sdp\r\n\t\t\t});\r\n\t\t}\r\n\t\t['createOffer', 'createAnswer'].forEach(function (method) {\r\n\t\t\tvar nativeMethod = window.RTCPeerConnection.prototype[method];\r\n\t\t\tvar methodObj = _defineProperty({}, method, function () {\r\n\t\t\t\tvar _this14 = this;\r\n\t\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\tvar isLegacyCall = arguments.length && typeof arguments[0] === 'function';\r\n\t\t\t\tif (isLegacyCall) {\r\n\t\t\t\t\treturn nativeMethod.apply(this, [function (description) {\r\n\t\t\t\t\t\tvar desc = replaceInternalStreamId(_this14, description);\r\n\t\t\t\t\t\targs[0].apply(null, [desc]);\r\n\t\t\t\t\t}, function (err) {\r\n\t\t\t\t\t\tif (args[1]) {\r\n\t\t\t\t\t\t\targs[1].apply(null, err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, arguments[2]]);\r\n\t\t\t\t}\r\n\t\t\t\treturn nativeMethod.apply(this, arguments).then(function (description) {\r\n\t\t\t\t\treturn replaceInternalStreamId(_this14, description);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\twindow.RTCPeerConnection.prototype[method] = methodObj[method];\r\n\t\t});\r\n\t\r\n\t\tvar origSetLocalDescription = window.RTCPeerConnection.prototype.setLocalDescription;\r\n\t\twindow.RTCPeerConnection.prototype.setLocalDescription = function setLocalDescription() {\r\n\t\t\tif (!arguments.length || !arguments[0].type) {\r\n\t\t\t\treturn origSetLocalDescription.apply(this, arguments);\r\n\t\t\t}\r\n\t\t\targuments[0] = replaceExternalStreamId(this, arguments[0]);\r\n\t\t\treturn origSetLocalDescription.apply(this, arguments);\r\n\t\t};\r\n\t\r\n\t\t// TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\r\n\t\r\n\t\tvar origLocalDescription = Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype, 'localDescription');\r\n\t\tObject.defineProperty(window.RTCPeerConnection.prototype, 'localDescription', {\r\n\t\t\tget: function get() {\r\n\t\t\t\tvar description = origLocalDescription.get.apply(this);\r\n\t\t\t\tif (description.type === '') {\r\n\t\t\t\t\treturn description;\r\n\t\t\t\t}\r\n\t\t\t\treturn replaceInternalStreamId(this, description);\r\n\t\t\t}\r\n\t\t});\r\n\t\r\n\t\twindow.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\r\n\t\t\tvar _this15 = this;\r\n\t\r\n\t\t\tif (this.signalingState === 'closed') {\r\n\t\t\t\tthrow new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\r\n\t\t\t}\r\n\t\t\t// We can not yet check for sender instanceof RTCRtpSender\r\n\t\t\t// since we shim RTPSender. So we check if sender._pc is set.\r\n\t\t\tif (!sender._pc) {\r\n\t\t\t\tthrow new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' + 'does not implement interface RTCRtpSender.', 'TypeError');\r\n\t\t\t}\r\n\t\t\tvar isLocal = sender._pc === this;\r\n\t\t\tif (!isLocal) {\r\n\t\t\t\tthrow new DOMException('Sender was not created by this connection.', 'InvalidAccessError');\r\n\t\t\t}\r\n\t\r\n\t\t\t// Search for the native stream the senders track belongs to.\r\n\t\t\tthis._streams = this._streams || {};\r\n\t\t\tvar stream = void 0;\r\n\t\t\tObject.keys(this._streams).forEach(function (streamid) {\r\n\t\t\t\tvar hasTrack = _this15._streams[streamid].getTracks().find(function (track) {\r\n\t\t\t\t\treturn sender.track === track;\r\n\t\t\t\t});\r\n\t\t\t\tif (hasTrack) {\r\n\t\t\t\t\tstream = _this15._streams[streamid];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tif (stream) {\r\n\t\t\t\tif (stream.getTracks().length === 1) {\r\n\t\t\t\t\t// if this is the last track of the stream, remove the stream. This\r\n\t\t\t\t\t// takes care of any shimmed _senders.\r\n\t\t\t\t\tthis.removeStream(this._reverseStreams[stream.id]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// relying on the same odd chrome behaviour as above.\r\n\t\t\t\t\tstream.removeTrack(sender.track);\r\n\t\t\t\t}\r\n\t\t\t\tthis.dispatchEvent(new Event('negotiationneeded'));\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimPeerConnection(window) {\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tif (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\r\n\t\t\t// very basic support for old versions.\r\n\t\t\twindow.RTCPeerConnection = window.webkitRTCPeerConnection;\r\n\t\t}\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\t// shim implicit creation of RTCSessionDescription/RTCIceCandidate\r\n\t\tif (browserDetails.version < 53) {\r\n\t\t\t['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {\r\n\t\t\t\tvar nativeMethod = window.RTCPeerConnection.prototype[method];\r\n\t\t\t\tvar methodObj = _defineProperty({}, method, function () {\r\n\t\t\t\t\targuments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);\r\n\t\t\t\t\treturn nativeMethod.apply(this, arguments);\r\n\t\t\t\t});\r\n\t\t\t\twindow.RTCPeerConnection.prototype[method] = methodObj[method];\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\t// support for addIceCandidate(null or undefined)\r\n\t\tvar nativeAddIceCandidate = window.RTCPeerConnection.prototype.addIceCandidate;\r\n\t\twindow.RTCPeerConnection.prototype.addIceCandidate = function addIceCandidate() {\r\n\t\t\tif (!arguments[0]) {\r\n\t\t\t\tif (arguments[1]) {\r\n\t\t\t\t\targuments[1].apply(null);\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t}\r\n\t\t\t// Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\r\n\t\t\t// in older versions. Native support planned for Chrome M77.\r\n\t\t\tif (browserDetails.version < 78 && arguments[0] && arguments[0].candidate === '') {\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t}\r\n\t\t\treturn nativeAddIceCandidate.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction fixNegotiationNeeded(window) {\r\n\t\tutils.wrapPeerConnectionEvent(window, 'negotiationneeded', function (e) {\r\n\t\t\tvar pc = e.target;\r\n\t\t\tif (pc.signalingState !== 'stable') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\treturn e;\r\n\t\t});\r\n\t}\r\n\t\r\n\t},{\"../utils.js\":15,\"./getdisplaymedia\":4,\"./getusermedia\":5}],4:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = shimGetDisplayMedia;\r\n\tfunction shimGetDisplayMedia(window, getSourceId) {\r\n\t\tif (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// getSourceId is a function that returns a promise resolving with\r\n\t\t// the sourceId of the screen/window/tab to be shared.\r\n\t\tif (typeof getSourceId !== 'function') {\r\n\t\t\tconsole.error('shimGetDisplayMedia: getSourceId argument is not ' + 'a function');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\twindow.navigator.mediaDevices.getDisplayMedia = function getDisplayMedia(constraints) {\r\n\t\t\treturn getSourceId(constraints).then(function (sourceId) {\r\n\t\t\t\tvar widthSpecified = constraints.video && constraints.video.width;\r\n\t\t\t\tvar heightSpecified = constraints.video && constraints.video.height;\r\n\t\t\t\tvar frameRateSpecified = constraints.video && constraints.video.frameRate;\r\n\t\t\t\tconstraints.video = {\r\n\t\t\t\t\tmandatory: {\r\n\t\t\t\t\t\tchromeMediaSource: 'desktop',\r\n\t\t\t\t\t\tchromeMediaSourceId: sourceId,\r\n\t\t\t\t\t\tmaxFrameRate: frameRateSpecified || 3\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tif (widthSpecified) {\r\n\t\t\t\t\tconstraints.video.mandatory.maxWidth = widthSpecified;\r\n\t\t\t\t}\r\n\t\t\t\tif (heightSpecified) {\r\n\t\t\t\t\tconstraints.video.mandatory.maxHeight = heightSpecified;\r\n\t\t\t\t}\r\n\t\t\t\treturn window.navigator.mediaDevices.getUserMedia(constraints);\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\t\r\n\t},{}],5:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\texports.shimGetUserMedia = shimGetUserMedia;\r\n\t\r\n\tvar _utils = require('../utils.js');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tvar logging = utils.log;\r\n\t\r\n\tfunction shimGetUserMedia(window) {\r\n\t\tvar navigator = window && window.navigator;\r\n\t\r\n\t\tif (!navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tvar constraintsToChrome_ = function constraintsToChrome_(c) {\r\n\t\t\tif ((typeof c === 'undefined' ? 'undefined' : _typeof(c)) !== 'object' || c.mandatory || c.optional) {\r\n\t\t\t\treturn c;\r\n\t\t\t}\r\n\t\t\tvar cc = {};\r\n\t\t\tObject.keys(c).forEach(function (key) {\r\n\t\t\t\tif (key === 'require' || key === 'advanced' || key === 'mediaSource') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar r = _typeof(c[key]) === 'object' ? c[key] : { ideal: c[key] };\r\n\t\t\t\tif (r.exact !== undefined && typeof r.exact === 'number') {\r\n\t\t\t\t\tr.min = r.max = r.exact;\r\n\t\t\t\t}\r\n\t\t\t\tvar oldname_ = function oldname_(prefix, name) {\r\n\t\t\t\t\tif (prefix) {\r\n\t\t\t\t\t\treturn prefix + name.charAt(0).toUpperCase() + name.slice(1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn name === 'deviceId' ? 'sourceId' : name;\r\n\t\t\t\t};\r\n\t\t\t\tif (r.ideal !== undefined) {\r\n\t\t\t\t\tcc.optional = cc.optional || [];\r\n\t\t\t\t\tvar oc = {};\r\n\t\t\t\t\tif (typeof r.ideal === 'number') {\r\n\t\t\t\t\t\toc[oldname_('min', key)] = r.ideal;\r\n\t\t\t\t\t\tcc.optional.push(oc);\r\n\t\t\t\t\t\toc = {};\r\n\t\t\t\t\t\toc[oldname_('max', key)] = r.ideal;\r\n\t\t\t\t\t\tcc.optional.push(oc);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toc[oldname_('', key)] = r.ideal;\r\n\t\t\t\t\t\tcc.optional.push(oc);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (r.exact !== undefined && typeof r.exact !== 'number') {\r\n\t\t\t\t\tcc.mandatory = cc.mandatory || {};\r\n\t\t\t\t\tcc.mandatory[oldname_('', key)] = r.exact;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t['min', 'max'].forEach(function (mix) {\r\n\t\t\t\t\t\tif (r[mix] !== undefined) {\r\n\t\t\t\t\t\t\tcc.mandatory = cc.mandatory || {};\r\n\t\t\t\t\t\t\tcc.mandatory[oldname_(mix, key)] = r[mix];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (c.advanced) {\r\n\t\t\t\tcc.optional = (cc.optional || []).concat(c.advanced);\r\n\t\t\t}\r\n\t\t\treturn cc;\r\n\t\t};\r\n\t\r\n\t\tvar shimConstraints_ = function shimConstraints_(constraints, func) {\r\n\t\t\tif (browserDetails.version >= 61) {\r\n\t\t\t\treturn func(constraints);\r\n\t\t\t}\r\n\t\t\tconstraints = JSON.parse(JSON.stringify(constraints));\r\n\t\t\tif (constraints && _typeof(constraints.audio) === 'object') {\r\n\t\t\t\tvar remap = function remap(obj, a, b) {\r\n\t\t\t\t\tif (a in obj && !(b in obj)) {\r\n\t\t\t\t\t\tobj[b] = obj[a];\r\n\t\t\t\t\t\tdelete obj[a];\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tconstraints = JSON.parse(JSON.stringify(constraints));\r\n\t\t\t\tremap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\r\n\t\t\t\tremap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\r\n\t\t\t\tconstraints.audio = constraintsToChrome_(constraints.audio);\r\n\t\t\t}\r\n\t\t\tif (constraints && _typeof(constraints.video) === 'object') {\r\n\t\t\t\t// Shim facingMode for mobile & surface pro.\r\n\t\t\t\tvar face = constraints.video.facingMode;\r\n\t\t\t\tface = face && ((typeof face === 'undefined' ? 'undefined' : _typeof(face)) === 'object' ? face : { ideal: face });\r\n\t\t\t\tvar getSupportedFacingModeLies = browserDetails.version < 66;\r\n\t\r\n\t\t\t\tif (face && (face.exact === 'user' || face.exact === 'environment' || face.ideal === 'user' || face.ideal === 'environment') && !(navigator.mediaDevices.getSupportedConstraints && navigator.mediaDevices.getSupportedConstraints().facingMode && !getSupportedFacingModeLies)) {\r\n\t\t\t\t\tdelete constraints.video.facingMode;\r\n\t\t\t\t\tvar matches = void 0;\r\n\t\t\t\t\tif (face.exact === 'environment' || face.ideal === 'environment') {\r\n\t\t\t\t\t\tmatches = ['back', 'rear'];\r\n\t\t\t\t\t} else if (face.exact === 'user' || face.ideal === 'user') {\r\n\t\t\t\t\t\tmatches = ['front'];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\t// Look for matches in label, or use last cam for back (typical).\r\n\t\t\t\t\t\treturn navigator.mediaDevices.enumerateDevices().then(function (devices) {\r\n\t\t\t\t\t\t\tdevices = devices.filter(function (d) {\r\n\t\t\t\t\t\t\t\treturn d.kind === 'videoinput';\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tvar dev = devices.find(function (d) {\r\n\t\t\t\t\t\t\t\treturn matches.some(function (match) {\r\n\t\t\t\t\t\t\t\t\treturn d.label.toLowerCase().includes(match);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tif (!dev && devices.length && matches.includes('back')) {\r\n\t\t\t\t\t\t\t\tdev = devices[devices.length - 1]; // more likely the back cam\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (dev) {\r\n\t\t\t\t\t\t\t\tconstraints.video.deviceId = face.exact ? { exact: dev.deviceId } : { ideal: dev.deviceId };\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconstraints.video = constraintsToChrome_(constraints.video);\r\n\t\t\t\t\t\t\tlogging('chrome: ' + JSON.stringify(constraints));\r\n\t\t\t\t\t\t\treturn func(constraints);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconstraints.video = constraintsToChrome_(constraints.video);\r\n\t\t\t}\r\n\t\t\tlogging('chrome: ' + JSON.stringify(constraints));\r\n\t\t\treturn func(constraints);\r\n\t\t};\r\n\t\r\n\t\tvar shimError_ = function shimError_(e) {\r\n\t\t\tif (browserDetails.version >= 64) {\r\n\t\t\t\treturn e;\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tname: {\r\n\t\t\t\t\tPermissionDeniedError: 'NotAllowedError',\r\n\t\t\t\t\tPermissionDismissedError: 'NotAllowedError',\r\n\t\t\t\t\tInvalidStateError: 'NotAllowedError',\r\n\t\t\t\t\tDevicesNotFoundError: 'NotFoundError',\r\n\t\t\t\t\tConstraintNotSatisfiedError: 'OverconstrainedError',\r\n\t\t\t\t\tTrackStartError: 'NotReadableError',\r\n\t\t\t\t\tMediaDeviceFailedDueToShutdown: 'NotAllowedError',\r\n\t\t\t\t\tMediaDeviceKillSwitchOn: 'NotAllowedError',\r\n\t\t\t\t\tTabCaptureError: 'AbortError',\r\n\t\t\t\t\tScreenCaptureError: 'AbortError',\r\n\t\t\t\t\tDeviceCaptureError: 'AbortError'\r\n\t\t\t\t}[e.name] || e.name,\r\n\t\t\t\tmessage: e.message,\r\n\t\t\t\tconstraint: e.constraint || e.constraintName,\r\n\t\t\t\ttoString: function toString() {\r\n\t\t\t\t\treturn this.name + (this.message && ': ') + this.message;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t};\r\n\t\r\n\t\tvar getUserMedia_ = function getUserMedia_(constraints, onSuccess, onError) {\r\n\t\t\tshimConstraints_(constraints, function (c) {\r\n\t\t\t\tnavigator.webkitGetUserMedia(c, onSuccess, function (e) {\r\n\t\t\t\t\tif (onError) {\r\n\t\t\t\t\t\tonError(shimError_(e));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t};\r\n\t\tnavigator.getUserMedia = getUserMedia_.bind(navigator);\r\n\t\r\n\t\t// Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\r\n\t\t// function which returns a Promise, it does not accept spec-style\r\n\t\t// constraints.\r\n\t\tif (navigator.mediaDevices.getUserMedia) {\r\n\t\t\tvar origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\r\n\t\t\tnavigator.mediaDevices.getUserMedia = function (cs) {\r\n\t\t\t\treturn shimConstraints_(cs, function (c) {\r\n\t\t\t\t\treturn origGetUserMedia(c).then(function (stream) {\r\n\t\t\t\t\t\tif (c.audio && !stream.getAudioTracks().length || c.video && !stream.getVideoTracks().length) {\r\n\t\t\t\t\t\t\tstream.getTracks().forEach(function (track) {\r\n\t\t\t\t\t\t\t\ttrack.stop();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tthrow new DOMException('', 'NotFoundError');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn stream;\r\n\t\t\t\t\t}, function (e) {\r\n\t\t\t\t\t\treturn Promise.reject(shimError_(e));\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t\r\n\t},{\"../utils.js\":15}],6:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\texports.shimRTCIceCandidate = shimRTCIceCandidate;\r\n\texports.shimMaxMessageSize = shimMaxMessageSize;\r\n\texports.shimSendThrowTypeError = shimSendThrowTypeError;\r\n\texports.shimConnectionState = shimConnectionState;\r\n\texports.removeAllowExtmapMixed = removeAllowExtmapMixed;\r\n\t\r\n\tvar _sdp = require('sdp');\r\n\t\r\n\tvar _sdp2 = _interopRequireDefault(_sdp);\r\n\t\r\n\tvar _utils = require('./utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\t\r\n\tfunction shimRTCIceCandidate(window) {\r\n\t\t// foundation is arbitrarily chosen as an indicator for full support for\r\n\t\t// https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\r\n\t\tif (!window.RTCIceCandidate || window.RTCIceCandidate && 'foundation' in window.RTCIceCandidate.prototype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tvar NativeRTCIceCandidate = window.RTCIceCandidate;\r\n\t\twindow.RTCIceCandidate = function RTCIceCandidate(args) {\r\n\t\t\t// Remove the a= which shouldn't be part of the candidate string.\r\n\t\t\tif ((typeof args === 'undefined' ? 'undefined' : _typeof(args)) === 'object' && args.candidate && args.candidate.indexOf('a=') === 0) {\r\n\t\t\t\targs = JSON.parse(JSON.stringify(args));\r\n\t\t\t\targs.candidate = args.candidate.substr(2);\r\n\t\t\t}\r\n\t\r\n\t\t\tif (args.candidate && args.candidate.length) {\r\n\t\t\t\t// Augment the native candidate with the parsed fields.\r\n\t\t\t\tvar nativeCandidate = new NativeRTCIceCandidate(args);\r\n\t\t\t\tvar parsedCandidate = _sdp2.default.parseCandidate(args.candidate);\r\n\t\t\t\tvar augmentedCandidate = Object.assign(nativeCandidate, parsedCandidate);\r\n\t\r\n\t\t\t\t// Add a serializer that does not serialize the extra attributes.\r\n\t\t\t\taugmentedCandidate.toJSON = function toJSON() {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tcandidate: augmentedCandidate.candidate,\r\n\t\t\t\t\t\tsdpMid: augmentedCandidate.sdpMid,\r\n\t\t\t\t\t\tsdpMLineIndex: augmentedCandidate.sdpMLineIndex,\r\n\t\t\t\t\t\tusernameFragment: augmentedCandidate.usernameFragment\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\t\t\t\treturn augmentedCandidate;\r\n\t\t\t}\r\n\t\t\treturn new NativeRTCIceCandidate(args);\r\n\t\t};\r\n\t\twindow.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\r\n\t\r\n\t\t// Hook up the augmented candidate in onicecandidate and\r\n\t\t// addEventListener('icecandidate', ...)\r\n\t\tutils.wrapPeerConnectionEvent(window, 'icecandidate', function (e) {\r\n\t\t\tif (e.candidate) {\r\n\t\t\t\tObject.defineProperty(e, 'candidate', {\r\n\t\t\t\t\tvalue: new window.RTCIceCandidate(e.candidate),\r\n\t\t\t\t\twritable: 'false'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn e;\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction shimMaxMessageSize(window) {\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tif (!('sctp' in window.RTCPeerConnection.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn typeof this._sctp === 'undefined' ? null : this._sctp;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\tvar sctpInDescription = function sctpInDescription(description) {\r\n\t\t\tif (!description || !description.sdp) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar sections = _sdp2.default.splitSections(description.sdp);\r\n\t\t\tsections.shift();\r\n\t\t\treturn sections.some(function (mediaSection) {\r\n\t\t\t\tvar mLine = _sdp2.default.parseMLine(mediaSection);\r\n\t\t\t\treturn mLine && mLine.kind === 'application' && mLine.protocol.indexOf('SCTP') !== -1;\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tvar getRemoteFirefoxVersion = function getRemoteFirefoxVersion(description) {\r\n\t\t\t// TODO: Is there a better solution for detecting Firefox?\r\n\t\t\tvar match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\r\n\t\t\tif (match === null || match.length < 2) {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t\tvar version = parseInt(match[1], 10);\r\n\t\t\t// Test for NaN (yes, this is ugly)\r\n\t\t\treturn version !== version ? -1 : version;\r\n\t\t};\r\n\t\r\n\t\tvar getCanSendMaxMessageSize = function getCanSendMaxMessageSize(remoteIsFirefox) {\r\n\t\t\t// Every implementation we know can send at least 64 KiB.\r\n\t\t\t// Note: Although Chrome is technically able to send up to 256 KiB, the\r\n\t\t\t//       data does not reach the other peer reliably.\r\n\t\t\t//       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\r\n\t\t\tvar canSendMaxMessageSize = 65536;\r\n\t\t\tif (browserDetails.browser === 'firefox') {\r\n\t\t\t\tif (browserDetails.version < 57) {\r\n\t\t\t\t\tif (remoteIsFirefox === -1) {\r\n\t\t\t\t\t\t// FF < 57 will send in 16 KiB chunks using the deprecated PPID\r\n\t\t\t\t\t\t// fragmentation.\r\n\t\t\t\t\t\tcanSendMaxMessageSize = 16384;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// However, other FF (and RAWRTC) can reassemble PPID-fragmented\r\n\t\t\t\t\t\t// messages. Thus, supporting ~2 GiB when sending.\r\n\t\t\t\t\t\tcanSendMaxMessageSize = 2147483637;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (browserDetails.version < 60) {\r\n\t\t\t\t\t// Currently, all FF >= 57 will reset the remote maximum message size\r\n\t\t\t\t\t// to the default value when a data channel is created at a later\r\n\t\t\t\t\t// stage. :(\r\n\t\t\t\t\t// See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\r\n\t\t\t\t\tcanSendMaxMessageSize = browserDetails.version === 57 ? 65535 : 65536;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// FF >= 60 supports sending ~2 GiB\r\n\t\t\t\t\tcanSendMaxMessageSize = 2147483637;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn canSendMaxMessageSize;\r\n\t\t};\r\n\t\r\n\t\tvar getMaxMessageSize = function getMaxMessageSize(description, remoteIsFirefox) {\r\n\t\t\t// Note: 65536 bytes is the default value from the SDP spec. Also,\r\n\t\t\t//       every implementation we know supports receiving 65536 bytes.\r\n\t\t\tvar maxMessageSize = 65536;\r\n\t\r\n\t\t\t// FF 57 has a slightly incorrect default remote max message size, so\r\n\t\t\t// we need to adjust it here to avoid a failure when sending.\r\n\t\t\t// See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\r\n\t\t\tif (browserDetails.browser === 'firefox' && browserDetails.version === 57) {\r\n\t\t\t\tmaxMessageSize = 65535;\r\n\t\t\t}\r\n\t\r\n\t\t\tvar match = _sdp2.default.matchPrefix(description.sdp, 'a=max-message-size:');\r\n\t\t\tif (match.length > 0) {\r\n\t\t\t\tmaxMessageSize = parseInt(match[0].substr(19), 10);\r\n\t\t\t} else if (browserDetails.browser === 'firefox' && remoteIsFirefox !== -1) {\r\n\t\t\t\t// If the maximum message size is not present in the remote SDP and\r\n\t\t\t\t// both local and remote are Firefox, the remote peer can receive\r\n\t\t\t\t// ~2 GiB.\r\n\t\t\t\tmaxMessageSize = 2147483637;\r\n\t\t\t}\r\n\t\t\treturn maxMessageSize;\r\n\t\t};\r\n\t\r\n\t\tvar origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n\t\twindow.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\r\n\t\t\tthis._sctp = null;\r\n\t\t\t// Chrome decided to not expose .sctp in plan-b mode.\r\n\t\t\t// As usual, adapter.js has to do an 'ugly worakaround'\r\n\t\t\t// to cover up the mess.\r\n\t\t\tif (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\r\n\t\t\t\tvar _getConfiguration = this.getConfiguration(),\r\n\t\t\t\t\t\tsdpSemantics = _getConfiguration.sdpSemantics;\r\n\t\r\n\t\t\t\tif (sdpSemantics === 'plan-b') {\r\n\t\t\t\t\tObject.defineProperty(this, 'sctp', {\r\n\t\t\t\t\t\tget: function get() {\r\n\t\t\t\t\t\t\treturn typeof this._sctp === 'undefined' ? null : this._sctp;\r\n\t\t\t\t\t\t},\r\n\t\r\n\t\t\t\t\t\tenumerable: true,\r\n\t\t\t\t\t\tconfigurable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\tif (sctpInDescription(arguments[0])) {\r\n\t\t\t\t// Check if the remote is FF.\r\n\t\t\t\tvar isFirefox = getRemoteFirefoxVersion(arguments[0]);\r\n\t\r\n\t\t\t\t// Get the maximum message size the local peer is capable of sending\r\n\t\t\t\tvar canSendMMS = getCanSendMaxMessageSize(isFirefox);\r\n\t\r\n\t\t\t\t// Get the maximum message size of the remote peer.\r\n\t\t\t\tvar remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\r\n\t\r\n\t\t\t\t// Determine final maximum message size\r\n\t\t\t\tvar maxMessageSize = void 0;\r\n\t\t\t\tif (canSendMMS === 0 && remoteMMS === 0) {\r\n\t\t\t\t\tmaxMessageSize = Number.POSITIVE_INFINITY;\r\n\t\t\t\t} else if (canSendMMS === 0 || remoteMMS === 0) {\r\n\t\t\t\t\tmaxMessageSize = Math.max(canSendMMS, remoteMMS);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmaxMessageSize = Math.min(canSendMMS, remoteMMS);\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t// Create a dummy RTCSctpTransport object and the 'maxMessageSize'\r\n\t\t\t\t// attribute.\r\n\t\t\t\tvar sctp = {};\r\n\t\t\t\tObject.defineProperty(sctp, 'maxMessageSize', {\r\n\t\t\t\t\tget: function get() {\r\n\t\t\t\t\t\treturn maxMessageSize;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis._sctp = sctp;\r\n\t\t\t}\r\n\t\r\n\t\t\treturn origSetRemoteDescription.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimSendThrowTypeError(window) {\r\n\t\tif (!(window.RTCPeerConnection && 'createDataChannel' in window.RTCPeerConnection.prototype)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\t// Note: Although Firefox >= 57 has a native implementation, the maximum\r\n\t\t//       message size can be reset for all data channels at a later stage.\r\n\t\t//       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\r\n\t\r\n\t\tfunction wrapDcSend(dc, pc) {\r\n\t\t\tvar origDataChannelSend = dc.send;\r\n\t\t\tdc.send = function send() {\r\n\t\t\t\tvar data = arguments[0];\r\n\t\t\t\tvar length = data.length || data.size || data.byteLength;\r\n\t\t\t\tif (dc.readyState === 'open' && pc.sctp && length > pc.sctp.maxMessageSize) {\r\n\t\t\t\t\tthrow new TypeError('Message too large (can send a maximum of ' + pc.sctp.maxMessageSize + ' bytes)');\r\n\t\t\t\t}\r\n\t\t\t\treturn origDataChannelSend.apply(dc, arguments);\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar origCreateDataChannel = window.RTCPeerConnection.prototype.createDataChannel;\r\n\t\twindow.RTCPeerConnection.prototype.createDataChannel = function createDataChannel() {\r\n\t\t\tvar dataChannel = origCreateDataChannel.apply(this, arguments);\r\n\t\t\twrapDcSend(dataChannel, this);\r\n\t\t\treturn dataChannel;\r\n\t\t};\r\n\t\tutils.wrapPeerConnectionEvent(window, 'datachannel', function (e) {\r\n\t\t\twrapDcSend(e.channel, e.target);\r\n\t\t\treturn e;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\r\n\t * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\r\n\t * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\r\n\t * since DTLS failures would be hidden. See\r\n\t * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\r\n\t * for the Firefox tracking bug.\r\n\t */\r\n\tfunction shimConnectionState(window) {\r\n\t\tif (!window.RTCPeerConnection || 'connectionState' in window.RTCPeerConnection.prototype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar proto = window.RTCPeerConnection.prototype;\r\n\t\tObject.defineProperty(proto, 'connectionState', {\r\n\t\t\tget: function get() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tcompleted: 'connected',\r\n\t\t\t\t\tchecking: 'connecting'\r\n\t\t\t\t}[this.iceConnectionState] || this.iceConnectionState;\r\n\t\t\t},\r\n\t\r\n\t\t\tenumerable: true,\r\n\t\t\tconfigurable: true\r\n\t\t});\r\n\t\tObject.defineProperty(proto, 'onconnectionstatechange', {\r\n\t\t\tget: function get() {\r\n\t\t\t\treturn this._onconnectionstatechange || null;\r\n\t\t\t},\r\n\t\t\tset: function set(cb) {\r\n\t\t\t\tif (this._onconnectionstatechange) {\r\n\t\t\t\t\tthis.removeEventListener('connectionstatechange', this._onconnectionstatechange);\r\n\t\t\t\t\tdelete this._onconnectionstatechange;\r\n\t\t\t\t}\r\n\t\t\t\tif (cb) {\r\n\t\t\t\t\tthis.addEventListener('connectionstatechange', this._onconnectionstatechange = cb);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\r\n\t\t\tenumerable: true,\r\n\t\t\tconfigurable: true\r\n\t\t});\r\n\t\r\n\t\t['setLocalDescription', 'setRemoteDescription'].forEach(function (method) {\r\n\t\t\tvar origMethod = proto[method];\r\n\t\t\tproto[method] = function () {\r\n\t\t\t\tif (!this._connectionstatechangepoly) {\r\n\t\t\t\t\tthis._connectionstatechangepoly = function (e) {\r\n\t\t\t\t\t\tvar pc = e.target;\r\n\t\t\t\t\t\tif (pc._lastConnectionState !== pc.connectionState) {\r\n\t\t\t\t\t\t\tpc._lastConnectionState = pc.connectionState;\r\n\t\t\t\t\t\t\tvar newEvent = new Event('connectionstatechange', e);\r\n\t\t\t\t\t\t\tpc.dispatchEvent(newEvent);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn e;\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.addEventListener('iceconnectionstatechange', this._connectionstatechangepoly);\r\n\t\t\t\t}\r\n\t\t\t\treturn origMethod.apply(this, arguments);\r\n\t\t\t};\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction removeAllowExtmapMixed(window) {\r\n\t\t/* remove a=extmap-allow-mixed for Chrome < M71 */\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\tif (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n\t\twindow.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription(desc) {\r\n\t\t\tif (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\r\n\t\t\t\tdesc.sdp = desc.sdp.split('\\n').filter(function (line) {\r\n\t\t\t\t\treturn line.trim() !== 'a=extmap-allow-mixed';\r\n\t\t\t\t}).join('\\n');\r\n\t\t\t}\r\n\t\t\treturn nativeSRD.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\t},{\"./utils\":15,\"sdp\":17}],7:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\r\n\t\r\n\tvar _getusermedia = require('./getusermedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetUserMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getusermedia.shimGetUserMedia;\r\n\t\t}\r\n\t});\r\n\t\r\n\tvar _getdisplaymedia = require('./getdisplaymedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetDisplayMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getdisplaymedia.shimGetDisplayMedia;\r\n\t\t}\r\n\t});\r\n\texports.shimPeerConnection = shimPeerConnection;\r\n\texports.shimReplaceTrack = shimReplaceTrack;\r\n\t\r\n\tvar _utils = require('../utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tvar _filtericeservers = require('./filtericeservers');\r\n\t\r\n\tvar _rtcpeerconnectionShim = require('rtcpeerconnection-shim');\r\n\t\r\n\tvar _rtcpeerconnectionShim2 = _interopRequireDefault(_rtcpeerconnectionShim);\r\n\t\r\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction shimPeerConnection(window) {\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tif (window.RTCIceGatherer) {\r\n\t\t\tif (!window.RTCIceCandidate) {\r\n\t\t\t\twindow.RTCIceCandidate = function RTCIceCandidate(args) {\r\n\t\t\t\t\treturn args;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (!window.RTCSessionDescription) {\r\n\t\t\t\twindow.RTCSessionDescription = function RTCSessionDescription(args) {\r\n\t\t\t\t\treturn args;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t// this adds an additional event listener to MediaStrackTrack that signals\r\n\t\t\t// when a tracks enabled property was changed. Workaround for a bug in\r\n\t\t\t// addStream, see below. No longer required in 15025+\r\n\t\t\tif (browserDetails.version < 15025) {\r\n\t\t\t\tvar origMSTEnabled = Object.getOwnPropertyDescriptor(window.MediaStreamTrack.prototype, 'enabled');\r\n\t\t\t\tObject.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\r\n\t\t\t\t\tset: function set(value) {\r\n\t\t\t\t\t\torigMSTEnabled.set.call(this, value);\r\n\t\t\t\t\t\tvar ev = new Event('enabled');\r\n\t\t\t\t\t\tev.enabled = value;\r\n\t\t\t\t\t\tthis.dispatchEvent(ev);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\t// ORTC defines the DTMF sender a bit different.\r\n\t\t// https://github.com/w3c/ortc/issues/714\r\n\t\tif (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\tif (this._dtmf === undefined) {\r\n\t\t\t\t\t\tif (this.track.kind === 'audio') {\r\n\t\t\t\t\t\t\tthis._dtmf = new window.RTCDtmfSender(this);\r\n\t\t\t\t\t\t} else if (this.track.kind === 'video') {\r\n\t\t\t\t\t\t\tthis._dtmf = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this._dtmf;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t// Edge currently only implements the RTCDtmfSender, not the\r\n\t\t// RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*\r\n\t\tif (window.RTCDtmfSender && !window.RTCDTMFSender) {\r\n\t\t\twindow.RTCDTMFSender = window.RTCDtmfSender;\r\n\t\t}\r\n\t\r\n\t\tvar RTCPeerConnectionShim = (0, _rtcpeerconnectionShim2.default)(window, browserDetails.version);\r\n\t\twindow.RTCPeerConnection = function RTCPeerConnection(config) {\r\n\t\t\tif (config && config.iceServers) {\r\n\t\t\t\tconfig.iceServers = (0, _filtericeservers.filterIceServers)(config.iceServers, browserDetails.version);\r\n\t\t\t\tutils.log('ICE servers after filtering:', config.iceServers);\r\n\t\t\t}\r\n\t\t\treturn new RTCPeerConnectionShim(config);\r\n\t\t};\r\n\t\twindow.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;\r\n\t}\r\n\t\r\n\tfunction shimReplaceTrack(window) {\r\n\t\t// ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\r\n\t\tif (window.RTCRtpSender && !('replaceTrack' in window.RTCRtpSender.prototype)) {\r\n\t\t\twindow.RTCRtpSender.prototype.replaceTrack = window.RTCRtpSender.prototype.setTrack;\r\n\t\t}\r\n\t}\r\n\t\r\n\t},{\"../utils\":15,\"./filtericeservers\":8,\"./getdisplaymedia\":9,\"./getusermedia\":10,\"rtcpeerconnection-shim\":16}],8:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.filterIceServers = filterIceServers;\r\n\t\r\n\tvar _utils = require('../utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\t// Edge does not like\r\n\t// 1) stun: filtered after 14393 unless ?transport=udp is present\r\n\t// 2) turn: that does not have all of turn:host:port?transport=udp\r\n\t// 3) turn: with ipv6 addresses\r\n\t// 4) turn: occurring muliple times\r\n\tfunction filterIceServers(iceServers, edgeVersion) {\r\n\t\tvar hasTurn = false;\r\n\t\ticeServers = JSON.parse(JSON.stringify(iceServers));\r\n\t\treturn iceServers.filter(function (server) {\r\n\t\t\tif (server && (server.urls || server.url)) {\r\n\t\t\t\tvar urls = server.urls || server.url;\r\n\t\t\t\tif (server.url && !server.urls) {\r\n\t\t\t\t\tutils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\r\n\t\t\t\t}\r\n\t\t\t\tvar isString = typeof urls === 'string';\r\n\t\t\t\tif (isString) {\r\n\t\t\t\t\turls = [urls];\r\n\t\t\t\t}\r\n\t\t\t\turls = urls.filter(function (url) {\r\n\t\t\t\t\t// filter STUN unconditionally.\r\n\t\t\t\t\tif (url.indexOf('stun:') === 0) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tvar validTurn = url.startsWith('turn') && !url.startsWith('turn:[') && url.includes('transport=udp');\r\n\t\t\t\t\tif (validTurn && !hasTurn) {\r\n\t\t\t\t\t\thasTurn = true;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn validTurn && !hasTurn;\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\tdelete server.url;\r\n\t\t\t\tserver.urls = isString ? urls[0] : urls;\r\n\t\t\t\treturn !!urls.length;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t},{\"../utils\":15}],9:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = shimGetDisplayMedia;\r\n\tfunction shimGetDisplayMedia(window) {\r\n\t\tif (!('getDisplayMedia' in window.navigator)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\twindow.navigator.mediaDevices.getDisplayMedia = window.navigator.getDisplayMedia.bind(window.navigator);\r\n\t}\r\n\t\r\n\t},{}],10:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetUserMedia = shimGetUserMedia;\r\n\tfunction shimGetUserMedia(window) {\r\n\t\tvar navigator = window && window.navigator;\r\n\t\r\n\t\tvar shimError_ = function shimError_(e) {\r\n\t\t\treturn {\r\n\t\t\t\tname: { PermissionDeniedError: 'NotAllowedError' }[e.name] || e.name,\r\n\t\t\t\tmessage: e.message,\r\n\t\t\t\tconstraint: e.constraint,\r\n\t\t\t\ttoString: function toString() {\r\n\t\t\t\t\treturn this.name;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t};\r\n\t\r\n\t\t// getUserMedia error shim.\r\n\t\tvar origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\r\n\t\tnavigator.mediaDevices.getUserMedia = function (c) {\r\n\t\t\treturn origGetUserMedia(c).catch(function (e) {\r\n\t\t\t\treturn Promise.reject(shimError_(e));\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\t\r\n\t},{}],11:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\tvar _getusermedia = require('./getusermedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetUserMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getusermedia.shimGetUserMedia;\r\n\t\t}\r\n\t});\r\n\t\r\n\tvar _getdisplaymedia = require('./getdisplaymedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetDisplayMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getdisplaymedia.shimGetDisplayMedia;\r\n\t\t}\r\n\t});\r\n\texports.shimOnTrack = shimOnTrack;\r\n\texports.shimPeerConnection = shimPeerConnection;\r\n\texports.shimSenderGetStats = shimSenderGetStats;\r\n\texports.shimReceiverGetStats = shimReceiverGetStats;\r\n\texports.shimRemoveStream = shimRemoveStream;\r\n\texports.shimRTCDataChannel = shimRTCDataChannel;\r\n\t\r\n\tvar _utils = require('../utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\r\n\t\r\n\tfunction shimOnTrack(window) {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCTrackEvent && 'receiver' in window.RTCTrackEvent.prototype && !('transceiver' in window.RTCTrackEvent.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn { receiver: this.receiver };\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimPeerConnection(window) {\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\r\n\t\t\treturn; // probably media.peerconnection.enabled=false in about:config\r\n\t\t}\r\n\t\tif (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\r\n\t\t\t// very basic support for old versions.\r\n\t\t\twindow.RTCPeerConnection = window.mozRTCPeerConnection;\r\n\t\t}\r\n\t\r\n\t\tif (browserDetails.version < 53) {\r\n\t\t\t// shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\r\n\t\t\t['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {\r\n\t\t\t\tvar nativeMethod = window.RTCPeerConnection.prototype[method];\r\n\t\t\t\tvar methodObj = _defineProperty({}, method, function () {\r\n\t\t\t\t\targuments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);\r\n\t\t\t\t\treturn nativeMethod.apply(this, arguments);\r\n\t\t\t\t});\r\n\t\t\t\twindow.RTCPeerConnection.prototype[method] = methodObj[method];\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\t// support for addIceCandidate(null or undefined)\r\n\t\tvar nativeAddIceCandidate = window.RTCPeerConnection.prototype.addIceCandidate;\r\n\t\twindow.RTCPeerConnection.prototype.addIceCandidate = function addIceCandidate() {\r\n\t\t\tif (!arguments[0]) {\r\n\t\t\t\tif (arguments[1]) {\r\n\t\t\t\t\targuments[1].apply(null);\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t}\r\n\t\t\t// Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\r\n\t\t\t// in older versions.\r\n\t\t\tif (browserDetails.version < 68 && arguments[0] && arguments[0].candidate === '') {\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t}\r\n\t\t\treturn nativeAddIceCandidate.apply(this, arguments);\r\n\t\t};\r\n\t\r\n\t\tvar modernStatsTypes = {\r\n\t\t\tinboundrtp: 'inbound-rtp',\r\n\t\t\toutboundrtp: 'outbound-rtp',\r\n\t\t\tcandidatepair: 'candidate-pair',\r\n\t\t\tlocalcandidate: 'local-candidate',\r\n\t\t\tremotecandidate: 'remote-candidate'\r\n\t\t};\r\n\t\r\n\t\tvar nativeGetStats = window.RTCPeerConnection.prototype.getStats;\r\n\t\twindow.RTCPeerConnection.prototype.getStats = function getStats() {\r\n\t\t\tvar _arguments = Array.prototype.slice.call(arguments),\r\n\t\t\t\t\tselector = _arguments[0],\r\n\t\t\t\t\tonSucc = _arguments[1],\r\n\t\t\t\t\tonErr = _arguments[2];\r\n\t\r\n\t\t\treturn nativeGetStats.apply(this, [selector || null]).then(function (stats) {\r\n\t\t\t\tif (browserDetails.version < 53 && !onSucc) {\r\n\t\t\t\t\t// Shim only promise getStats with spec-hyphens in type names\r\n\t\t\t\t\t// Leave callback version alone; misc old uses of forEach before Map\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tstats.forEach(function (stat) {\r\n\t\t\t\t\t\t\tstat.type = modernStatsTypes[stat.type] || stat.type;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tif (e.name !== 'TypeError') {\r\n\t\t\t\t\t\t\tthrow e;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\r\n\t\t\t\t\t\tstats.forEach(function (stat, i) {\r\n\t\t\t\t\t\t\tstats.set(i, Object.assign({}, stat, {\r\n\t\t\t\t\t\t\t\ttype: modernStatsTypes[stat.type] || stat.type\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn stats;\r\n\t\t\t}).then(onSucc, onErr);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimSenderGetStats(window) {\r\n\t\tif (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar origGetSenders = window.RTCPeerConnection.prototype.getSenders;\r\n\t\tif (origGetSenders) {\r\n\t\t\twindow.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n\t\t\t\tvar _this = this;\r\n\t\r\n\t\t\t\tvar senders = origGetSenders.apply(this, []);\r\n\t\t\t\tsenders.forEach(function (sender) {\r\n\t\t\t\t\treturn sender._pc = _this;\r\n\t\t\t\t});\r\n\t\t\t\treturn senders;\r\n\t\t\t};\r\n\t\t}\r\n\t\r\n\t\tvar origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n\t\tif (origAddTrack) {\r\n\t\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack() {\r\n\t\t\t\tvar sender = origAddTrack.apply(this, arguments);\r\n\t\t\t\tsender._pc = this;\r\n\t\t\t\treturn sender;\r\n\t\t\t};\r\n\t\t}\r\n\t\twindow.RTCRtpSender.prototype.getStats = function getStats() {\r\n\t\t\treturn this.track ? this._pc.getStats(this.track) : Promise.resolve(new Map());\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimReceiverGetStats(window) {\r\n\t\tif (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\r\n\t\tif (origGetReceivers) {\r\n\t\t\twindow.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\r\n\t\t\t\tvar _this2 = this;\r\n\t\r\n\t\t\t\tvar receivers = origGetReceivers.apply(this, []);\r\n\t\t\t\treceivers.forEach(function (receiver) {\r\n\t\t\t\t\treturn receiver._pc = _this2;\r\n\t\t\t\t});\r\n\t\t\t\treturn receivers;\r\n\t\t\t};\r\n\t\t}\r\n\t\tutils.wrapPeerConnectionEvent(window, 'track', function (e) {\r\n\t\t\te.receiver._pc = e.srcElement;\r\n\t\t\treturn e;\r\n\t\t});\r\n\t\twindow.RTCRtpReceiver.prototype.getStats = function getStats() {\r\n\t\t\treturn this._pc.getStats(this.track);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimRemoveStream(window) {\r\n\t\tif (!window.RTCPeerConnection || 'removeStream' in window.RTCPeerConnection.prototype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\twindow.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n\t\t\tvar _this3 = this;\r\n\t\r\n\t\t\tutils.deprecated('removeStream', 'removeTrack');\r\n\t\t\tthis.getSenders().forEach(function (sender) {\r\n\t\t\t\tif (sender.track && stream.getTracks().includes(sender.track)) {\r\n\t\t\t\t\t_this3.removeTrack(sender);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimRTCDataChannel(window) {\r\n\t\t// rename DataChannel to RTCDataChannel (native fix in FF60):\r\n\t\t// https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\r\n\t\tif (window.DataChannel && !window.RTCDataChannel) {\r\n\t\t\twindow.RTCDataChannel = window.DataChannel;\r\n\t\t}\r\n\t}\r\n\t\r\n\t},{\"../utils\":15,\"./getdisplaymedia\":12,\"./getusermedia\":13}],12:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = shimGetDisplayMedia;\r\n\tfunction shimGetDisplayMedia(window, preferredMediaSource) {\r\n\t\tif (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\twindow.navigator.mediaDevices.getDisplayMedia = function getDisplayMedia(constraints) {\r\n\t\t\tif (!(constraints && constraints.video)) {\r\n\t\t\t\tvar err = new DOMException('getDisplayMedia without video ' + 'constraints is undefined');\r\n\t\t\t\terr.name = 'NotFoundError';\r\n\t\t\t\t// from https://heycam.github.io/webidl/#idl-DOMException-error-names\r\n\t\t\t\terr.code = 8;\r\n\t\t\t\treturn Promise.reject(err);\r\n\t\t\t}\r\n\t\t\tif (constraints.video === true) {\r\n\t\t\t\tconstraints.video = { mediaSource: preferredMediaSource };\r\n\t\t\t} else {\r\n\t\t\t\tconstraints.video.mediaSource = preferredMediaSource;\r\n\t\t\t}\r\n\t\t\treturn window.navigator.mediaDevices.getUserMedia(constraints);\r\n\t\t};\r\n\t}\r\n\t\r\n\t},{}],13:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\texports.shimGetUserMedia = shimGetUserMedia;\r\n\t\r\n\tvar _utils = require('../utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction shimGetUserMedia(window) {\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\tvar navigator = window && window.navigator;\r\n\t\tvar MediaStreamTrack = window && window.MediaStreamTrack;\r\n\t\r\n\t\tnavigator.getUserMedia = function (constraints, onSuccess, onError) {\r\n\t\t\t// Replace Firefox 44+'s deprecation warning with unprefixed version.\r\n\t\t\tutils.deprecated('navigator.getUserMedia', 'navigator.mediaDevices.getUserMedia');\r\n\t\t\tnavigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\r\n\t\t};\r\n\t\r\n\t\tif (!(browserDetails.version > 55 && 'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\r\n\t\t\tvar remap = function remap(obj, a, b) {\r\n\t\t\t\tif (a in obj && !(b in obj)) {\r\n\t\t\t\t\tobj[b] = obj[a];\r\n\t\t\t\t\tdelete obj[a];\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\r\n\t\t\tvar nativeGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\r\n\t\t\tnavigator.mediaDevices.getUserMedia = function (c) {\r\n\t\t\t\tif ((typeof c === 'undefined' ? 'undefined' : _typeof(c)) === 'object' && _typeof(c.audio) === 'object') {\r\n\t\t\t\t\tc = JSON.parse(JSON.stringify(c));\r\n\t\t\t\t\tremap(c.audio, 'autoGainControl', 'mozAutoGainControl');\r\n\t\t\t\t\tremap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\r\n\t\t\t\t}\r\n\t\t\t\treturn nativeGetUserMedia(c);\r\n\t\t\t};\r\n\t\r\n\t\t\tif (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\r\n\t\t\t\tvar nativeGetSettings = MediaStreamTrack.prototype.getSettings;\r\n\t\t\t\tMediaStreamTrack.prototype.getSettings = function () {\r\n\t\t\t\t\tvar obj = nativeGetSettings.apply(this, arguments);\r\n\t\t\t\t\tremap(obj, 'mozAutoGainControl', 'autoGainControl');\r\n\t\t\t\t\tremap(obj, 'mozNoiseSuppression', 'noiseSuppression');\r\n\t\t\t\t\treturn obj;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\r\n\t\t\tif (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\r\n\t\t\t\tvar nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\r\n\t\t\t\tMediaStreamTrack.prototype.applyConstraints = function (c) {\r\n\t\t\t\t\tif (this.kind === 'audio' && (typeof c === 'undefined' ? 'undefined' : _typeof(c)) === 'object') {\r\n\t\t\t\t\t\tc = JSON.parse(JSON.stringify(c));\r\n\t\t\t\t\t\tremap(c, 'autoGainControl', 'mozAutoGainControl');\r\n\t\t\t\t\t\tremap(c, 'noiseSuppression', 'mozNoiseSuppression');\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn nativeApplyConstraints.apply(this, [c]);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t},{\"../utils\":15}],14:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\texports.shimLocalStreamsAPI = shimLocalStreamsAPI;\r\n\texports.shimRemoteStreamsAPI = shimRemoteStreamsAPI;\r\n\texports.shimCallbacksAPI = shimCallbacksAPI;\r\n\texports.shimGetUserMedia = shimGetUserMedia;\r\n\texports.shimConstraints = shimConstraints;\r\n\texports.shimRTCIceServerUrls = shimRTCIceServerUrls;\r\n\texports.shimTrackEventTransceiver = shimTrackEventTransceiver;\r\n\texports.shimCreateOfferLegacy = shimCreateOfferLegacy;\r\n\t\r\n\tvar _utils = require('../utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction shimLocalStreamsAPI(window) {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\r\n\t\t\twindow.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\r\n\t\t\t\tif (!this._localStreams) {\r\n\t\t\t\t\tthis._localStreams = [];\r\n\t\t\t\t}\r\n\t\t\t\treturn this._localStreams;\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (!('addStream' in window.RTCPeerConnection.prototype)) {\r\n\t\t\tvar _addTrack = window.RTCPeerConnection.prototype.addTrack;\r\n\t\t\twindow.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n\t\t\t\tvar _this = this;\r\n\t\r\n\t\t\t\tif (!this._localStreams) {\r\n\t\t\t\t\tthis._localStreams = [];\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._localStreams.includes(stream)) {\r\n\t\t\t\t\tthis._localStreams.push(stream);\r\n\t\t\t\t}\r\n\t\t\t\t// Try to emulate Chrome's behaviour of adding in audio-video order.\r\n\t\t\t\t// Safari orders by track id.\r\n\t\t\t\tstream.getAudioTracks().forEach(function (track) {\r\n\t\t\t\t\treturn _addTrack.call(_this, track, stream);\r\n\t\t\t\t});\r\n\t\t\t\tstream.getVideoTracks().forEach(function (track) {\r\n\t\t\t\t\treturn _addTrack.call(_this, track, stream);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\r\n\t\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack(track) {\r\n\t\t\t\tvar stream = arguments[1];\r\n\t\t\t\tif (stream) {\r\n\t\t\t\t\tif (!this._localStreams) {\r\n\t\t\t\t\t\tthis._localStreams = [stream];\r\n\t\t\t\t\t} else if (!this._localStreams.includes(stream)) {\r\n\t\t\t\t\t\tthis._localStreams.push(stream);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn _addTrack.apply(this, arguments);\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (!('removeStream' in window.RTCPeerConnection.prototype)) {\r\n\t\t\twindow.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n\t\t\t\tvar _this2 = this;\r\n\t\r\n\t\t\t\tif (!this._localStreams) {\r\n\t\t\t\t\tthis._localStreams = [];\r\n\t\t\t\t}\r\n\t\t\t\tvar index = this._localStreams.indexOf(stream);\r\n\t\t\t\tif (index === -1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis._localStreams.splice(index, 1);\r\n\t\t\t\tvar tracks = stream.getTracks();\r\n\t\t\t\tthis.getSenders().forEach(function (sender) {\r\n\t\t\t\t\tif (tracks.includes(sender.track)) {\r\n\t\t\t\t\t\t_this2.removeTrack(sender);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimRemoteStreamsAPI(window) {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\r\n\t\t\twindow.RTCPeerConnection.prototype.getRemoteStreams = function getRemoteStreams() {\r\n\t\t\t\treturn this._remoteStreams ? this._remoteStreams : [];\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (!('onaddstream' in window.RTCPeerConnection.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn this._onaddstream;\r\n\t\t\t\t},\r\n\t\t\t\tset: function set(f) {\r\n\t\t\t\t\tvar _this3 = this;\r\n\t\r\n\t\t\t\t\tif (this._onaddstream) {\r\n\t\t\t\t\t\tthis.removeEventListener('addstream', this._onaddstream);\r\n\t\t\t\t\t\tthis.removeEventListener('track', this._onaddstreampoly);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.addEventListener('addstream', this._onaddstream = f);\r\n\t\t\t\t\tthis.addEventListener('track', this._onaddstreampoly = function (e) {\r\n\t\t\t\t\t\te.streams.forEach(function (stream) {\r\n\t\t\t\t\t\t\tif (!_this3._remoteStreams) {\r\n\t\t\t\t\t\t\t\t_this3._remoteStreams = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (_this3._remoteStreams.includes(stream)) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t_this3._remoteStreams.push(stream);\r\n\t\t\t\t\t\t\tvar event = new Event('addstream');\r\n\t\t\t\t\t\t\tevent.stream = stream;\r\n\t\t\t\t\t\t\t_this3.dispatchEvent(event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tvar origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n\t\t\twindow.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\r\n\t\t\t\tvar pc = this;\r\n\t\t\t\tif (!this._onaddstreampoly) {\r\n\t\t\t\t\tthis.addEventListener('track', this._onaddstreampoly = function (e) {\r\n\t\t\t\t\t\te.streams.forEach(function (stream) {\r\n\t\t\t\t\t\t\tif (!pc._remoteStreams) {\r\n\t\t\t\t\t\t\t\tpc._remoteStreams = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (pc._remoteStreams.indexOf(stream) >= 0) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tpc._remoteStreams.push(stream);\r\n\t\t\t\t\t\t\tvar event = new Event('addstream');\r\n\t\t\t\t\t\t\tevent.stream = stream;\r\n\t\t\t\t\t\t\tpc.dispatchEvent(event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn origSetRemoteDescription.apply(pc, arguments);\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimCallbacksAPI(window) {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar prototype = window.RTCPeerConnection.prototype;\r\n\t\tvar origCreateOffer = prototype.createOffer;\r\n\t\tvar origCreateAnswer = prototype.createAnswer;\r\n\t\tvar setLocalDescription = prototype.setLocalDescription;\r\n\t\tvar setRemoteDescription = prototype.setRemoteDescription;\r\n\t\tvar addIceCandidate = prototype.addIceCandidate;\r\n\t\r\n\t\tprototype.createOffer = function createOffer(successCallback, failureCallback) {\r\n\t\t\tvar options = arguments.length >= 2 ? arguments[2] : arguments[0];\r\n\t\t\tvar promise = origCreateOffer.apply(this, [options]);\r\n\t\t\tif (!failureCallback) {\r\n\t\t\t\treturn promise;\r\n\t\t\t}\r\n\t\t\tpromise.then(successCallback, failureCallback);\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\r\n\t\tprototype.createAnswer = function createAnswer(successCallback, failureCallback) {\r\n\t\t\tvar options = arguments.length >= 2 ? arguments[2] : arguments[0];\r\n\t\t\tvar promise = origCreateAnswer.apply(this, [options]);\r\n\t\t\tif (!failureCallback) {\r\n\t\t\t\treturn promise;\r\n\t\t\t}\r\n\t\t\tpromise.then(successCallback, failureCallback);\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\r\n\t\tvar withCallback = function withCallback(description, successCallback, failureCallback) {\r\n\t\t\tvar promise = setLocalDescription.apply(this, [description]);\r\n\t\t\tif (!failureCallback) {\r\n\t\t\t\treturn promise;\r\n\t\t\t}\r\n\t\t\tpromise.then(successCallback, failureCallback);\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\tprototype.setLocalDescription = withCallback;\r\n\t\r\n\t\twithCallback = function withCallback(description, successCallback, failureCallback) {\r\n\t\t\tvar promise = setRemoteDescription.apply(this, [description]);\r\n\t\t\tif (!failureCallback) {\r\n\t\t\t\treturn promise;\r\n\t\t\t}\r\n\t\t\tpromise.then(successCallback, failureCallback);\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\tprototype.setRemoteDescription = withCallback;\r\n\t\r\n\t\twithCallback = function withCallback(candidate, successCallback, failureCallback) {\r\n\t\t\tvar promise = addIceCandidate.apply(this, [candidate]);\r\n\t\t\tif (!failureCallback) {\r\n\t\t\t\treturn promise;\r\n\t\t\t}\r\n\t\t\tpromise.then(successCallback, failureCallback);\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\tprototype.addIceCandidate = withCallback;\r\n\t}\r\n\t\r\n\tfunction shimGetUserMedia(window) {\r\n\t\tvar navigator = window && window.navigator;\r\n\t\r\n\t\tif (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n\t\t\t// shim not needed in Safari 12.1\r\n\t\t\tvar mediaDevices = navigator.mediaDevices;\r\n\t\t\tvar _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\r\n\t\t\tnavigator.mediaDevices.getUserMedia = function (constraints) {\r\n\t\t\t\treturn _getUserMedia(shimConstraints(constraints));\r\n\t\t\t};\r\n\t\t}\r\n\t\r\n\t\tif (!navigator.getUserMedia && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n\t\t\tnavigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\r\n\t\t\t\tnavigator.mediaDevices.getUserMedia(constraints).then(cb, errcb);\r\n\t\t\t}.bind(navigator);\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimConstraints(constraints) {\r\n\t\tif (constraints && constraints.video !== undefined) {\r\n\t\t\treturn Object.assign({}, constraints, { video: utils.compactObject(constraints.video) });\r\n\t\t}\r\n\t\r\n\t\treturn constraints;\r\n\t}\r\n\t\r\n\tfunction shimRTCIceServerUrls(window) {\r\n\t\t// migrate from non-spec RTCIceServer.url to RTCIceServer.urls\r\n\t\tvar OrigPeerConnection = window.RTCPeerConnection;\r\n\t\twindow.RTCPeerConnection = function RTCPeerConnection(pcConfig, pcConstraints) {\r\n\t\t\tif (pcConfig && pcConfig.iceServers) {\r\n\t\t\t\tvar newIceServers = [];\r\n\t\t\t\tfor (var i = 0; i < pcConfig.iceServers.length; i++) {\r\n\t\t\t\t\tvar server = pcConfig.iceServers[i];\r\n\t\t\t\t\tif (!server.hasOwnProperty('urls') && server.hasOwnProperty('url')) {\r\n\t\t\t\t\t\tutils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\r\n\t\t\t\t\t\tserver = JSON.parse(JSON.stringify(server));\r\n\t\t\t\t\t\tserver.urls = server.url;\r\n\t\t\t\t\t\tdelete server.url;\r\n\t\t\t\t\t\tnewIceServers.push(server);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnewIceServers.push(pcConfig.iceServers[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpcConfig.iceServers = newIceServers;\r\n\t\t\t}\r\n\t\t\treturn new OrigPeerConnection(pcConfig, pcConstraints);\r\n\t\t};\r\n\t\twindow.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\r\n\t\t// wrap static methods. Currently just generateCertificate.\r\n\t\tif ('generateCertificate' in window.RTCPeerConnection) {\r\n\t\t\tObject.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn OrigPeerConnection.generateCertificate;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimTrackEventTransceiver(window) {\r\n\t\t// Add event.transceiver member over deprecated event.receiver\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCTrackEvent && 'receiver' in window.RTCTrackEvent.prototype && !('transceiver' in window.RTCTrackEvent.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn { receiver: this.receiver };\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimCreateOfferLegacy(window) {\r\n\t\tvar origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\r\n\t\twindow.RTCPeerConnection.prototype.createOffer = function createOffer(offerOptions) {\r\n\t\t\tif (offerOptions) {\r\n\t\t\t\tif (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\r\n\t\t\t\t\t// support bit values\r\n\t\t\t\t\tofferOptions.offerToReceiveAudio = !!offerOptions.offerToReceiveAudio;\r\n\t\t\t\t}\r\n\t\t\t\tvar audioTransceiver = this.getTransceivers().find(function (transceiver) {\r\n\t\t\t\t\treturn transceiver.receiver.track.kind === 'audio';\r\n\t\t\t\t});\r\n\t\t\t\tif (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\r\n\t\t\t\t\tif (audioTransceiver.direction === 'sendrecv') {\r\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\r\n\t\t\t\t\t\t\taudioTransceiver.setDirection('sendonly');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\taudioTransceiver.direction = 'sendonly';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (audioTransceiver.direction === 'recvonly') {\r\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\r\n\t\t\t\t\t\t\taudioTransceiver.setDirection('inactive');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\taudioTransceiver.direction = 'inactive';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (offerOptions.offerToReceiveAudio === true && !audioTransceiver) {\r\n\t\t\t\t\tthis.addTransceiver('audio');\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\r\n\t\t\t\t\t// support bit values\r\n\t\t\t\t\tofferOptions.offerToReceiveVideo = !!offerOptions.offerToReceiveVideo;\r\n\t\t\t\t}\r\n\t\t\t\tvar videoTransceiver = this.getTransceivers().find(function (transceiver) {\r\n\t\t\t\t\treturn transceiver.receiver.track.kind === 'video';\r\n\t\t\t\t});\r\n\t\t\t\tif (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\r\n\t\t\t\t\tif (videoTransceiver.direction === 'sendrecv') {\r\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\r\n\t\t\t\t\t\t\tvideoTransceiver.setDirection('sendonly');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvideoTransceiver.direction = 'sendonly';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (videoTransceiver.direction === 'recvonly') {\r\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\r\n\t\t\t\t\t\t\tvideoTransceiver.setDirection('inactive');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvideoTransceiver.direction = 'inactive';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (offerOptions.offerToReceiveVideo === true && !videoTransceiver) {\r\n\t\t\t\t\tthis.addTransceiver('video');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn origCreateOffer.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\t},{\"../utils\":15}],15:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\texports.extractVersion = extractVersion;\r\n\texports.wrapPeerConnectionEvent = wrapPeerConnectionEvent;\r\n\texports.disableLog = disableLog;\r\n\texports.disableWarnings = disableWarnings;\r\n\texports.log = log;\r\n\texports.deprecated = deprecated;\r\n\texports.detectBrowser = detectBrowser;\r\n\texports.compactObject = compactObject;\r\n\texports.walkStats = walkStats;\r\n\texports.filterStats = filterStats;\r\n\t\r\n\tfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\r\n\t\r\n\tvar logDisabled_ = true;\r\n\tvar deprecationWarnings_ = true;\r\n\t\r\n\t/**\r\n\t * Extract browser version out of the provided user agent string.\r\n\t *\r\n\t * @param {!string} uastring userAgent string.\r\n\t * @param {!string} expr Regular expression used as match criteria.\r\n\t * @param {!number} pos position in the version string to be returned.\r\n\t * @return {!number} browser version.\r\n\t */\r\n\tfunction extractVersion(uastring, expr, pos) {\r\n\t\tvar match = uastring.match(expr);\r\n\t\treturn match && match.length >= pos && parseInt(match[pos], 10);\r\n\t}\r\n\t\r\n\t// Wraps the peerconnection event eventNameToWrap in a function\r\n\t// which returns the modified event object (or false to prevent\r\n\t// the event).\r\n\tfunction wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar proto = window.RTCPeerConnection.prototype;\r\n\t\tvar nativeAddEventListener = proto.addEventListener;\r\n\t\tproto.addEventListener = function (nativeEventName, cb) {\r\n\t\t\tif (nativeEventName !== eventNameToWrap) {\r\n\t\t\t\treturn nativeAddEventListener.apply(this, arguments);\r\n\t\t\t}\r\n\t\t\tvar wrappedCallback = function wrappedCallback(e) {\r\n\t\t\t\tvar modifiedEvent = wrapper(e);\r\n\t\t\t\tif (modifiedEvent) {\r\n\t\t\t\t\tcb(modifiedEvent);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tthis._eventMap = this._eventMap || {};\r\n\t\t\tthis._eventMap[cb] = wrappedCallback;\r\n\t\t\treturn nativeAddEventListener.apply(this, [nativeEventName, wrappedCallback]);\r\n\t\t};\r\n\t\r\n\t\tvar nativeRemoveEventListener = proto.removeEventListener;\r\n\t\tproto.removeEventListener = function (nativeEventName, cb) {\r\n\t\t\tif (nativeEventName !== eventNameToWrap || !this._eventMap || !this._eventMap[cb]) {\r\n\t\t\t\treturn nativeRemoveEventListener.apply(this, arguments);\r\n\t\t\t}\r\n\t\t\tvar unwrappedCb = this._eventMap[cb];\r\n\t\t\tdelete this._eventMap[cb];\r\n\t\t\treturn nativeRemoveEventListener.apply(this, [nativeEventName, unwrappedCb]);\r\n\t\t};\r\n\t\r\n\t\tObject.defineProperty(proto, 'on' + eventNameToWrap, {\r\n\t\t\tget: function get() {\r\n\t\t\t\treturn this['_on' + eventNameToWrap];\r\n\t\t\t},\r\n\t\t\tset: function set(cb) {\r\n\t\t\t\tif (this['_on' + eventNameToWrap]) {\r\n\t\t\t\t\tthis.removeEventListener(eventNameToWrap, this['_on' + eventNameToWrap]);\r\n\t\t\t\t\tdelete this['_on' + eventNameToWrap];\r\n\t\t\t\t}\r\n\t\t\t\tif (cb) {\r\n\t\t\t\t\tthis.addEventListener(eventNameToWrap, this['_on' + eventNameToWrap] = cb);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\r\n\t\t\tenumerable: true,\r\n\t\t\tconfigurable: true\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction disableLog(bool) {\r\n\t\tif (typeof bool !== 'boolean') {\r\n\t\t\treturn new Error('Argument type: ' + (typeof bool === 'undefined' ? 'undefined' : _typeof(bool)) + '. Please use a boolean.');\r\n\t\t}\r\n\t\tlogDisabled_ = bool;\r\n\t\treturn bool ? 'adapter.js logging disabled' : 'adapter.js logging enabled';\r\n\t}\r\n\t\r\n\t/**\r\n\t * Disable or enable deprecation warnings\r\n\t * @param {!boolean} bool set to true to disable warnings.\r\n\t */\r\n\tfunction disableWarnings(bool) {\r\n\t\tif (typeof bool !== 'boolean') {\r\n\t\t\treturn new Error('Argument type: ' + (typeof bool === 'undefined' ? 'undefined' : _typeof(bool)) + '. Please use a boolean.');\r\n\t\t}\r\n\t\tdeprecationWarnings_ = !bool;\r\n\t\treturn 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\r\n\t}\r\n\t\r\n\tfunction log() {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object') {\r\n\t\t\tif (logDisabled_) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (typeof console !== 'undefined' && typeof console.log === 'function') {\r\n\t\t\t\tconsole.log.apply(console, arguments);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Shows a deprecation warning suggesting the modern and spec-compatible API.\r\n\t */\r\n\tfunction deprecated(oldMethod, newMethod) {\r\n\t\tif (!deprecationWarnings_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconsole.warn(oldMethod + ' is deprecated, please use ' + newMethod + ' instead.');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Browser detector.\r\n\t *\r\n\t * @return {object} result containing browser and version\r\n\t *     properties.\r\n\t */\r\n\tfunction detectBrowser(window) {\r\n\t\tvar navigator = window.navigator;\r\n\t\r\n\t\t// Returned result object.\r\n\t\r\n\t\tvar result = { browser: null, version: null };\r\n\t\r\n\t\t// Fail early if it's not a browser\r\n\t\tif (typeof window === 'undefined' || !window.navigator) {\r\n\t\t\tresult.browser = 'Not a browser.';\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\r\n\t\tif (navigator.mozGetUserMedia) {\r\n\t\t\t// Firefox.\r\n\t\t\tresult.browser = 'firefox';\r\n\t\t\tresult.version = extractVersion(navigator.userAgent, /Firefox\\/(\\d+)\\./, 1);\r\n\t\t} else if (navigator.webkitGetUserMedia || window.isSecureContext === false && window.webkitRTCPeerConnection && !window.RTCIceGatherer) {\r\n\t\t\t// Chrome, Chromium, Webview, Opera.\r\n\t\t\t// Version matches Chrome/WebRTC version.\r\n\t\t\t// Chrome 74 removed webkitGetUserMedia on http as well so we need the\r\n\t\t\t// more complicated fallback to webkitRTCPeerConnection.\r\n\t\t\tresult.browser = 'chrome';\r\n\t\t\tresult.version = extractVersion(navigator.userAgent, /Chrom(e|ium)\\/(\\d+)\\./, 2);\r\n\t\t} else if (navigator.mediaDevices && navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) {\r\n\t\t\t// Edge.\r\n\t\t\tresult.browser = 'edge';\r\n\t\t\tresult.version = extractVersion(navigator.userAgent, /Edge\\/(\\d+).(\\d+)$/, 2);\r\n\t\t} else if (window.RTCPeerConnection && navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) {\r\n\t\t\t// Safari.\r\n\t\t\tresult.browser = 'safari';\r\n\t\t\tresult.version = extractVersion(navigator.userAgent, /AppleWebKit\\/(\\d+)\\./, 1);\r\n\t\t\tresult.supportsUnifiedPlan = window.RTCRtpTransceiver && 'currentDirection' in window.RTCRtpTransceiver.prototype;\r\n\t\t} else {\r\n\t\t\t// Default fallthrough: not supported.\r\n\t\t\tresult.browser = 'Not a supported browser.';\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Checks if something is an object.\r\n\t *\r\n\t * @param {*} val The something you want to check.\r\n\t * @return true if val is an object, false otherwise.\r\n\t */\r\n\tfunction isObject(val) {\r\n\t\treturn Object.prototype.toString.call(val) === '[object Object]';\r\n\t}\r\n\t\r\n\t/**\r\n\t * Remove all empty objects and undefined values\r\n\t * from a nested object -- an enhanced and vanilla version\r\n\t * of Lodash's `compact`.\r\n\t */\r\n\tfunction compactObject(data) {\r\n\t\tif (!isObject(data)) {\r\n\t\t\treturn data;\r\n\t\t}\r\n\t\r\n\t\treturn Object.keys(data).reduce(function (accumulator, key) {\r\n\t\t\tvar isObj = isObject(data[key]);\r\n\t\t\tvar value = isObj ? compactObject(data[key]) : data[key];\r\n\t\t\tvar isEmptyObject = isObj && !Object.keys(value).length;\r\n\t\t\tif (value === undefined || isEmptyObject) {\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}\r\n\t\t\treturn Object.assign(accumulator, _defineProperty({}, key, value));\r\n\t\t}, {});\r\n\t}\r\n\t\r\n\t/* iterates the stats graph recursively. */\r\n\tfunction walkStats(stats, base, resultSet) {\r\n\t\tif (!base || resultSet.has(base.id)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tresultSet.set(base.id, base);\r\n\t\tObject.keys(base).forEach(function (name) {\r\n\t\t\tif (name.endsWith('Id')) {\r\n\t\t\t\twalkStats(stats, stats.get(base[name]), resultSet);\r\n\t\t\t} else if (name.endsWith('Ids')) {\r\n\t\t\t\tbase[name].forEach(function (id) {\r\n\t\t\t\t\twalkStats(stats, stats.get(id), resultSet);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/* filter getStats for a sender/receiver track. */\r\n\tfunction filterStats(result, track, outbound) {\r\n\t\tvar streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\r\n\t\tvar filteredResult = new Map();\r\n\t\tif (track === null) {\r\n\t\t\treturn filteredResult;\r\n\t\t}\r\n\t\tvar trackStats = [];\r\n\t\tresult.forEach(function (value) {\r\n\t\t\tif (value.type === 'track' && value.trackIdentifier === track.id) {\r\n\t\t\t\ttrackStats.push(value);\r\n\t\t\t}\r\n\t\t});\r\n\t\ttrackStats.forEach(function (trackStat) {\r\n\t\t\tresult.forEach(function (stats) {\r\n\t\t\t\tif (stats.type === streamStatsType && stats.trackId === trackStat.id) {\r\n\t\t\t\t\twalkStats(result, stats, filteredResult);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn filteredResult;\r\n\t}\r\n\t\r\n\t},{}],16:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t /* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tvar SDPUtils = require('sdp');\r\n\t\r\n\tfunction fixStatsType(stat) {\r\n\t\treturn {\r\n\t\t\tinboundrtp: 'inbound-rtp',\r\n\t\t\toutboundrtp: 'outbound-rtp',\r\n\t\t\tcandidatepair: 'candidate-pair',\r\n\t\t\tlocalcandidate: 'local-candidate',\r\n\t\t\tremotecandidate: 'remote-candidate'\r\n\t\t}[stat.type] || stat.type;\r\n\t}\r\n\t\r\n\tfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\r\n\t\tvar sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\r\n\t\r\n\t\t// Map ICE parameters (ufrag, pwd) to SDP.\r\n\t\tsdp += SDPUtils.writeIceParameters(\r\n\t\t\t\ttransceiver.iceGatherer.getLocalParameters());\r\n\t\r\n\t\t// Map DTLS parameters to SDP.\r\n\t\tsdp += SDPUtils.writeDtlsParameters(\r\n\t\t\t\ttransceiver.dtlsTransport.getLocalParameters(),\r\n\t\t\t\ttype === 'offer' ? 'actpass' : dtlsRole || 'active');\r\n\t\r\n\t\tsdp += 'a=mid:' + transceiver.mid + '\\r\\n';\r\n\t\r\n\t\tif (transceiver.rtpSender && transceiver.rtpReceiver) {\r\n\t\t\tsdp += 'a=sendrecv\\r\\n';\r\n\t\t} else if (transceiver.rtpSender) {\r\n\t\t\tsdp += 'a=sendonly\\r\\n';\r\n\t\t} else if (transceiver.rtpReceiver) {\r\n\t\t\tsdp += 'a=recvonly\\r\\n';\r\n\t\t} else {\r\n\t\t\tsdp += 'a=inactive\\r\\n';\r\n\t\t}\r\n\t\r\n\t\tif (transceiver.rtpSender) {\r\n\t\t\tvar trackId = transceiver.rtpSender._initialTrackId ||\r\n\t\t\t\t\ttransceiver.rtpSender.track.id;\r\n\t\t\ttransceiver.rtpSender._initialTrackId = trackId;\r\n\t\t\t// spec.\r\n\t\t\tvar msid = 'msid:' + (stream ? stream.id : '-') + ' ' +\r\n\t\t\t\t\ttrackId + '\\r\\n';\r\n\t\t\tsdp += 'a=' + msid;\r\n\t\t\t// for Chrome. Legacy should no longer be required.\r\n\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\r\n\t\t\t\t\t' ' + msid;\r\n\t\r\n\t\t\t// RTX\r\n\t\t\tif (transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t\t' ' + msid;\r\n\t\t\t\tsdp += 'a=ssrc-group:FID ' +\r\n\t\t\t\t\t\ttransceiver.sendEncodingParameters[0].ssrc + ' ' +\r\n\t\t\t\t\t\ttransceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t\t'\\r\\n';\r\n\t\t\t}\r\n\t\t}\r\n\t\t// FIXME: this should be written by writeRtpDescription.\r\n\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\r\n\t\t\t\t' cname:' + SDPUtils.localCName + '\\r\\n';\r\n\t\tif (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t' cname:' + SDPUtils.localCName + '\\r\\n';\r\n\t\t}\r\n\t\treturn sdp;\r\n\t}\r\n\t\r\n\t// Edge does not like\r\n\t// 1) stun: filtered after 14393 unless ?transport=udp is present\r\n\t// 2) turn: that does not have all of turn:host:port?transport=udp\r\n\t// 3) turn: with ipv6 addresses\r\n\t// 4) turn: occurring muliple times\r\n\tfunction filterIceServers(iceServers, edgeVersion) {\r\n\t\tvar hasTurn = false;\r\n\t\ticeServers = JSON.parse(JSON.stringify(iceServers));\r\n\t\treturn iceServers.filter(function(server) {\r\n\t\t\tif (server && (server.urls || server.url)) {\r\n\t\t\t\tvar urls = server.urls || server.url;\r\n\t\t\t\tif (server.url && !server.urls) {\r\n\t\t\t\t\tconsole.warn('RTCIceServer.url is deprecated! Use urls instead.');\r\n\t\t\t\t}\r\n\t\t\t\tvar isString = typeof urls === 'string';\r\n\t\t\t\tif (isString) {\r\n\t\t\t\t\turls = [urls];\r\n\t\t\t\t}\r\n\t\t\t\turls = urls.filter(function(url) {\r\n\t\t\t\t\tvar validTurn = url.indexOf('turn:') === 0 &&\r\n\t\t\t\t\t\t\turl.indexOf('transport=udp') !== -1 &&\r\n\t\t\t\t\t\t\turl.indexOf('turn:[') === -1 &&\r\n\t\t\t\t\t\t\t!hasTurn;\r\n\t\r\n\t\t\t\t\tif (validTurn) {\r\n\t\t\t\t\t\thasTurn = true;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\r\n\t\t\t\t\t\t\turl.indexOf('?transport=udp') === -1;\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\tdelete server.url;\r\n\t\t\t\tserver.urls = isString ? urls[0] : urls;\r\n\t\t\t\treturn !!urls.length;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t// Determines the intersection of local and remote capabilities.\r\n\tfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\r\n\t\tvar commonCapabilities = {\r\n\t\t\tcodecs: [],\r\n\t\t\theaderExtensions: [],\r\n\t\t\tfecMechanisms: []\r\n\t\t};\r\n\t\r\n\t\tvar findCodecByPayloadType = function(pt, codecs) {\r\n\t\t\tpt = parseInt(pt, 10);\r\n\t\t\tfor (var i = 0; i < codecs.length; i++) {\r\n\t\t\t\tif (codecs[i].payloadType === pt ||\r\n\t\t\t\t\t\tcodecs[i].preferredPayloadType === pt) {\r\n\t\t\t\t\treturn codecs[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\tvar rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\r\n\t\t\tvar lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\r\n\t\t\tvar rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\r\n\t\t\treturn lCodec && rCodec &&\r\n\t\t\t\t\tlCodec.name.toLowerCase() === rCodec.name.toLowerCase();\r\n\t\t};\r\n\t\r\n\t\tlocalCapabilities.codecs.forEach(function(lCodec) {\r\n\t\t\tfor (var i = 0; i < remoteCapabilities.codecs.length; i++) {\r\n\t\t\t\tvar rCodec = remoteCapabilities.codecs[i];\r\n\t\t\t\tif (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\r\n\t\t\t\t\t\tlCodec.clockRate === rCodec.clockRate) {\r\n\t\t\t\t\tif (lCodec.name.toLowerCase() === 'rtx' &&\r\n\t\t\t\t\t\t\tlCodec.parameters && rCodec.parameters.apt) {\r\n\t\t\t\t\t\t// for RTX we need to find the local rtx that has a apt\r\n\t\t\t\t\t\t// which points to the same local codec as the remote one.\r\n\t\t\t\t\t\tif (!rtxCapabilityMatches(lCodec, rCodec,\r\n\t\t\t\t\t\t\t\tlocalCapabilities.codecs, remoteCapabilities.codecs)) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\trCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\r\n\t\t\t\t\t// number of channels is the highest common number of channels\r\n\t\t\t\t\trCodec.numChannels = Math.min(lCodec.numChannels,\r\n\t\t\t\t\t\t\trCodec.numChannels);\r\n\t\t\t\t\t// push rCodec so we reply with offerer payload type\r\n\t\t\t\t\tcommonCapabilities.codecs.push(rCodec);\r\n\t\r\n\t\t\t\t\t// determine common feedback mechanisms\r\n\t\t\t\t\trCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\r\n\t\t\t\t\t\tfor (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\r\n\t\t\t\t\t\t\tif (lCodec.rtcpFeedback[j].type === fb.type &&\r\n\t\t\t\t\t\t\t\t\tlCodec.rtcpFeedback[j].parameter === fb.parameter) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// FIXME: also need to determine .parameters\r\n\t\t\t\t\t//  see https://github.com/openpeer/ortc/issues/569\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\r\n\t\tlocalCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\r\n\t\t\tfor (var i = 0; i < remoteCapabilities.headerExtensions.length;\r\n\t\t\t\t\t i++) {\r\n\t\t\t\tvar rHeaderExtension = remoteCapabilities.headerExtensions[i];\r\n\t\t\t\tif (lHeaderExtension.uri === rHeaderExtension.uri) {\r\n\t\t\t\t\tcommonCapabilities.headerExtensions.push(rHeaderExtension);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\r\n\t\t// FIXME: fecMechanisms\r\n\t\treturn commonCapabilities;\r\n\t}\r\n\t\r\n\t// is action=setLocalDescription with type allowed in signalingState\r\n\tfunction isActionAllowedInSignalingState(action, type, signalingState) {\r\n\t\treturn {\r\n\t\t\toffer: {\r\n\t\t\t\tsetLocalDescription: ['stable', 'have-local-offer'],\r\n\t\t\t\tsetRemoteDescription: ['stable', 'have-remote-offer']\r\n\t\t\t},\r\n\t\t\tanswer: {\r\n\t\t\t\tsetLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\r\n\t\t\t\tsetRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\r\n\t\t\t}\r\n\t\t}[type][action].indexOf(signalingState) !== -1;\r\n\t}\r\n\t\r\n\tfunction maybeAddCandidate(iceTransport, candidate) {\r\n\t\t// Edge's internal representation adds some fields therefore\r\n\t\t// not all fieldѕ are taken into account.\r\n\t\tvar alreadyAdded = iceTransport.getRemoteCandidates()\r\n\t\t\t\t.find(function(remoteCandidate) {\r\n\t\t\t\t\treturn candidate.foundation === remoteCandidate.foundation &&\r\n\t\t\t\t\t\t\tcandidate.ip === remoteCandidate.ip &&\r\n\t\t\t\t\t\t\tcandidate.port === remoteCandidate.port &&\r\n\t\t\t\t\t\t\tcandidate.priority === remoteCandidate.priority &&\r\n\t\t\t\t\t\t\tcandidate.protocol === remoteCandidate.protocol &&\r\n\t\t\t\t\t\t\tcandidate.type === remoteCandidate.type;\r\n\t\t\t\t});\r\n\t\tif (!alreadyAdded) {\r\n\t\t\ticeTransport.addRemoteCandidate(candidate);\r\n\t\t}\r\n\t\treturn !alreadyAdded;\r\n\t}\r\n\t\r\n\t\r\n\tfunction makeError(name, description) {\r\n\t\tvar e = new Error(description);\r\n\t\te.name = name;\r\n\t\t// legacy error codes from https://heycam.github.io/webidl/#idl-DOMException-error-names\r\n\t\te.code = {\r\n\t\t\tNotSupportedError: 9,\r\n\t\t\tInvalidStateError: 11,\r\n\t\t\tInvalidAccessError: 15,\r\n\t\t\tTypeError: undefined,\r\n\t\t\tOperationError: undefined\r\n\t\t}[name];\r\n\t\treturn e;\r\n\t}\r\n\t\r\n\tmodule.exports = function(window, edgeVersion) {\r\n\t\t// https://w3c.github.io/mediacapture-main/#mediastream\r\n\t\t// Helper function to add the track to the stream and\r\n\t\t// dispatch the event ourselves.\r\n\t\tfunction addTrackToStreamAndFireEvent(track, stream) {\r\n\t\t\tstream.addTrack(track);\r\n\t\t\tstream.dispatchEvent(new window.MediaStreamTrackEvent('addtrack',\r\n\t\t\t\t\t{track: track}));\r\n\t\t}\r\n\t\r\n\t\tfunction removeTrackFromStreamAndFireEvent(track, stream) {\r\n\t\t\tstream.removeTrack(track);\r\n\t\t\tstream.dispatchEvent(new window.MediaStreamTrackEvent('removetrack',\r\n\t\t\t\t\t{track: track}));\r\n\t\t}\r\n\t\r\n\t\tfunction fireAddTrack(pc, track, receiver, streams) {\r\n\t\t\tvar trackEvent = new Event('track');\r\n\t\t\ttrackEvent.track = track;\r\n\t\t\ttrackEvent.receiver = receiver;\r\n\t\t\ttrackEvent.transceiver = {receiver: receiver};\r\n\t\t\ttrackEvent.streams = streams;\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tpc._dispatchEvent('track', trackEvent);\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\tvar RTCPeerConnection = function(config) {\r\n\t\t\tvar pc = this;\r\n\t\r\n\t\t\tvar _eventTarget = document.createDocumentFragment();\r\n\t\t\t['addEventListener', 'removeEventListener', 'dispatchEvent']\r\n\t\t\t\t\t.forEach(function(method) {\r\n\t\t\t\t\t\tpc[method] = _eventTarget[method].bind(_eventTarget);\r\n\t\t\t\t\t});\r\n\t\r\n\t\t\tthis.canTrickleIceCandidates = null;\r\n\t\r\n\t\t\tthis.needNegotiation = false;\r\n\t\r\n\t\t\tthis.localStreams = [];\r\n\t\t\tthis.remoteStreams = [];\r\n\t\r\n\t\t\tthis._localDescription = null;\r\n\t\t\tthis._remoteDescription = null;\r\n\t\r\n\t\t\tthis.signalingState = 'stable';\r\n\t\t\tthis.iceConnectionState = 'new';\r\n\t\t\tthis.connectionState = 'new';\r\n\t\t\tthis.iceGatheringState = 'new';\r\n\t\r\n\t\t\tconfig = JSON.parse(JSON.stringify(config || {}));\r\n\t\r\n\t\t\tthis.usingBundle = config.bundlePolicy === 'max-bundle';\r\n\t\t\tif (config.rtcpMuxPolicy === 'negotiate') {\r\n\t\t\t\tthrow(makeError('NotSupportedError',\r\n\t\t\t\t\t\t'rtcpMuxPolicy \\'negotiate\\' is not supported'));\r\n\t\t\t} else if (!config.rtcpMuxPolicy) {\r\n\t\t\t\tconfig.rtcpMuxPolicy = 'require';\r\n\t\t\t}\r\n\t\r\n\t\t\tswitch (config.iceTransportPolicy) {\r\n\t\t\t\tcase 'all':\r\n\t\t\t\tcase 'relay':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconfig.iceTransportPolicy = 'all';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\r\n\t\t\tswitch (config.bundlePolicy) {\r\n\t\t\t\tcase 'balanced':\r\n\t\t\t\tcase 'max-compat':\r\n\t\t\t\tcase 'max-bundle':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconfig.bundlePolicy = 'balanced';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\r\n\t\t\tconfig.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\r\n\t\r\n\t\t\tthis._iceGatherers = [];\r\n\t\t\tif (config.iceCandidatePoolSize) {\r\n\t\t\t\tfor (var i = config.iceCandidatePoolSize; i > 0; i--) {\r\n\t\t\t\t\tthis._iceGatherers.push(new window.RTCIceGatherer({\r\n\t\t\t\t\t\ticeServers: config.iceServers,\r\n\t\t\t\t\t\tgatherPolicy: config.iceTransportPolicy\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconfig.iceCandidatePoolSize = 0;\r\n\t\t\t}\r\n\t\r\n\t\t\tthis._config = config;\r\n\t\r\n\t\t\t// per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\r\n\t\t\t// everything that is needed to describe a SDP m-line.\r\n\t\t\tthis.transceivers = [];\r\n\t\r\n\t\t\tthis._sdpSessionId = SDPUtils.generateSessionId();\r\n\t\t\tthis._sdpSessionVersion = 0;\r\n\t\r\n\t\t\tthis._dtlsRole = undefined; // role for a=setup to use in answers.\r\n\t\r\n\t\t\tthis._isClosed = false;\r\n\t\t};\r\n\t\r\n\t\tObject.defineProperty(RTCPeerConnection.prototype, 'localDescription', {\r\n\t\t\tconfigurable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn this._localDescription;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(RTCPeerConnection.prototype, 'remoteDescription', {\r\n\t\t\tconfigurable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn this._remoteDescription;\r\n\t\t\t}\r\n\t\t});\r\n\t\r\n\t\t// set up event handlers on prototype\r\n\t\tRTCPeerConnection.prototype.onicecandidate = null;\r\n\t\tRTCPeerConnection.prototype.onaddstream = null;\r\n\t\tRTCPeerConnection.prototype.ontrack = null;\r\n\t\tRTCPeerConnection.prototype.onremovestream = null;\r\n\t\tRTCPeerConnection.prototype.onsignalingstatechange = null;\r\n\t\tRTCPeerConnection.prototype.oniceconnectionstatechange = null;\r\n\t\tRTCPeerConnection.prototype.onconnectionstatechange = null;\r\n\t\tRTCPeerConnection.prototype.onicegatheringstatechange = null;\r\n\t\tRTCPeerConnection.prototype.onnegotiationneeded = null;\r\n\t\tRTCPeerConnection.prototype.ondatachannel = null;\r\n\t\r\n\t\tRTCPeerConnection.prototype._dispatchEvent = function(name, event) {\r\n\t\t\tif (this._isClosed) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.dispatchEvent(event);\r\n\t\t\tif (typeof this['on' + name] === 'function') {\r\n\t\t\t\tthis['on' + name](event);\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype._emitGatheringStateChange = function() {\r\n\t\t\tvar event = new Event('icegatheringstatechange');\r\n\t\t\tthis._dispatchEvent('icegatheringstatechange', event);\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getConfiguration = function() {\r\n\t\t\treturn this._config;\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getLocalStreams = function() {\r\n\t\t\treturn this.localStreams;\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getRemoteStreams = function() {\r\n\t\t\treturn this.remoteStreams;\r\n\t\t};\r\n\t\r\n\t\t// internal helper to create a transceiver object.\r\n\t\t// (which is not yet the same as the WebRTC 1.0 transceiver)\r\n\t\tRTCPeerConnection.prototype._createTransceiver = function(kind, doNotAdd) {\r\n\t\t\tvar hasBundleTransport = this.transceivers.length > 0;\r\n\t\t\tvar transceiver = {\r\n\t\t\t\ttrack: null,\r\n\t\t\t\ticeGatherer: null,\r\n\t\t\t\ticeTransport: null,\r\n\t\t\t\tdtlsTransport: null,\r\n\t\t\t\tlocalCapabilities: null,\r\n\t\t\t\tremoteCapabilities: null,\r\n\t\t\t\trtpSender: null,\r\n\t\t\t\trtpReceiver: null,\r\n\t\t\t\tkind: kind,\r\n\t\t\t\tmid: null,\r\n\t\t\t\tsendEncodingParameters: null,\r\n\t\t\t\trecvEncodingParameters: null,\r\n\t\t\t\tstream: null,\r\n\t\t\t\tassociatedRemoteMediaStreams: [],\r\n\t\t\t\twantReceive: true\r\n\t\t\t};\r\n\t\t\tif (this.usingBundle && hasBundleTransport) {\r\n\t\t\t\ttransceiver.iceTransport = this.transceivers[0].iceTransport;\r\n\t\t\t\ttransceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\r\n\t\t\t} else {\r\n\t\t\t\tvar transports = this._createIceAndDtlsTransports();\r\n\t\t\t\ttransceiver.iceTransport = transports.iceTransport;\r\n\t\t\t\ttransceiver.dtlsTransport = transports.dtlsTransport;\r\n\t\t\t}\r\n\t\t\tif (!doNotAdd) {\r\n\t\t\t\tthis.transceivers.push(transceiver);\r\n\t\t\t}\r\n\t\t\treturn transceiver;\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.addTrack = function(track, stream) {\r\n\t\t\tif (this._isClosed) {\r\n\t\t\t\tthrow makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Attempted to call addTrack on a closed peerconnection.');\r\n\t\t\t}\r\n\t\r\n\t\t\tvar alreadyExists = this.transceivers.find(function(s) {\r\n\t\t\t\treturn s.track === track;\r\n\t\t\t});\r\n\t\r\n\t\t\tif (alreadyExists) {\r\n\t\t\t\tthrow makeError('InvalidAccessError', 'Track already exists.');\r\n\t\t\t}\r\n\t\r\n\t\t\tvar transceiver;\r\n\t\t\tfor (var i = 0; i < this.transceivers.length; i++) {\r\n\t\t\t\tif (!this.transceivers[i].track &&\r\n\t\t\t\t\t\tthis.transceivers[i].kind === track.kind) {\r\n\t\t\t\t\ttransceiver = this.transceivers[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!transceiver) {\r\n\t\t\t\ttransceiver = this._createTransceiver(track.kind);\r\n\t\t\t}\r\n\t\r\n\t\t\tthis._maybeFireNegotiationNeeded();\r\n\t\r\n\t\t\tif (this.localStreams.indexOf(stream) === -1) {\r\n\t\t\t\tthis.localStreams.push(stream);\r\n\t\t\t}\r\n\t\r\n\t\t\ttransceiver.track = track;\r\n\t\t\ttransceiver.stream = stream;\r\n\t\t\ttransceiver.rtpSender = new window.RTCRtpSender(track,\r\n\t\t\t\t\ttransceiver.dtlsTransport);\r\n\t\t\treturn transceiver.rtpSender;\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.addStream = function(stream) {\r\n\t\t\tvar pc = this;\r\n\t\t\tif (edgeVersion >= 15025) {\r\n\t\t\t\tstream.getTracks().forEach(function(track) {\r\n\t\t\t\t\tpc.addTrack(track, stream);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Clone is necessary for local demos mostly, attaching directly\r\n\t\t\t\t// to two different senders does not work (build 10547).\r\n\t\t\t\t// Fixed in 15025 (or earlier)\r\n\t\t\t\tvar clonedStream = stream.clone();\r\n\t\t\t\tstream.getTracks().forEach(function(track, idx) {\r\n\t\t\t\t\tvar clonedTrack = clonedStream.getTracks()[idx];\r\n\t\t\t\t\ttrack.addEventListener('enabled', function(event) {\r\n\t\t\t\t\t\tclonedTrack.enabled = event.enabled;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tclonedStream.getTracks().forEach(function(track) {\r\n\t\t\t\t\tpc.addTrack(track, clonedStream);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.removeTrack = function(sender) {\r\n\t\t\tif (this._isClosed) {\r\n\t\t\t\tthrow makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Attempted to call removeTrack on a closed peerconnection.');\r\n\t\t\t}\r\n\t\r\n\t\t\tif (!(sender instanceof window.RTCRtpSender)) {\r\n\t\t\t\tthrow new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\r\n\t\t\t\t\t\t'does not implement interface RTCRtpSender.');\r\n\t\t\t}\r\n\t\r\n\t\t\tvar transceiver = this.transceivers.find(function(t) {\r\n\t\t\t\treturn t.rtpSender === sender;\r\n\t\t\t});\r\n\t\r\n\t\t\tif (!transceiver) {\r\n\t\t\t\tthrow makeError('InvalidAccessError',\r\n\t\t\t\t\t\t'Sender was not created by this connection.');\r\n\t\t\t}\r\n\t\t\tvar stream = transceiver.stream;\r\n\t\r\n\t\t\ttransceiver.rtpSender.stop();\r\n\t\t\ttransceiver.rtpSender = null;\r\n\t\t\ttransceiver.track = null;\r\n\t\t\ttransceiver.stream = null;\r\n\t\r\n\t\t\t// remove the stream from the set of local streams\r\n\t\t\tvar localStreams = this.transceivers.map(function(t) {\r\n\t\t\t\treturn t.stream;\r\n\t\t\t});\r\n\t\t\tif (localStreams.indexOf(stream) === -1 &&\r\n\t\t\t\t\tthis.localStreams.indexOf(stream) > -1) {\r\n\t\t\t\tthis.localStreams.splice(this.localStreams.indexOf(stream), 1);\r\n\t\t\t}\r\n\t\r\n\t\t\tthis._maybeFireNegotiationNeeded();\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.removeStream = function(stream) {\r\n\t\t\tvar pc = this;\r\n\t\t\tstream.getTracks().forEach(function(track) {\r\n\t\t\t\tvar sender = pc.getSenders().find(function(s) {\r\n\t\t\t\t\treturn s.track === track;\r\n\t\t\t\t});\r\n\t\t\t\tif (sender) {\r\n\t\t\t\t\tpc.removeTrack(sender);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getSenders = function() {\r\n\t\t\treturn this.transceivers.filter(function(transceiver) {\r\n\t\t\t\treturn !!transceiver.rtpSender;\r\n\t\t\t})\r\n\t\t\t.map(function(transceiver) {\r\n\t\t\t\treturn transceiver.rtpSender;\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getReceivers = function() {\r\n\t\t\treturn this.transceivers.filter(function(transceiver) {\r\n\t\t\t\treturn !!transceiver.rtpReceiver;\r\n\t\t\t})\r\n\t\t\t.map(function(transceiver) {\r\n\t\t\t\treturn transceiver.rtpReceiver;\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\r\n\t\tRTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\r\n\t\t\t\tusingBundle) {\r\n\t\t\tvar pc = this;\r\n\t\t\tif (usingBundle && sdpMLineIndex > 0) {\r\n\t\t\t\treturn this.transceivers[0].iceGatherer;\r\n\t\t\t} else if (this._iceGatherers.length) {\r\n\t\t\t\treturn this._iceGatherers.shift();\r\n\t\t\t}\r\n\t\t\tvar iceGatherer = new window.RTCIceGatherer({\r\n\t\t\t\ticeServers: this._config.iceServers,\r\n\t\t\t\tgatherPolicy: this._config.iceTransportPolicy\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(iceGatherer, 'state',\r\n\t\t\t\t\t{value: 'new', writable: true}\r\n\t\t\t);\r\n\t\r\n\t\t\tthis.transceivers[sdpMLineIndex].bufferedCandidateEvents = [];\r\n\t\t\tthis.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\r\n\t\t\t\tvar end = !event.candidate || Object.keys(event.candidate).length === 0;\r\n\t\t\t\t// polyfill since RTCIceGatherer.state is not implemented in\r\n\t\t\t\t// Edge 10547 yet.\r\n\t\t\t\ticeGatherer.state = end ? 'completed' : 'gathering';\r\n\t\t\t\tif (pc.transceivers[sdpMLineIndex].bufferedCandidateEvents !== null) {\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\ticeGatherer.addEventListener('localcandidate',\r\n\t\t\t\tthis.transceivers[sdpMLineIndex].bufferCandidates);\r\n\t\t\treturn iceGatherer;\r\n\t\t};\r\n\t\r\n\t\t// start gathering from an RTCIceGatherer.\r\n\t\tRTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\r\n\t\t\tvar pc = this;\r\n\t\t\tvar iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\r\n\t\t\tif (iceGatherer.onlocalcandidate) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar bufferedCandidateEvents =\r\n\t\t\t\tthis.transceivers[sdpMLineIndex].bufferedCandidateEvents;\r\n\t\t\tthis.transceivers[sdpMLineIndex].bufferedCandidateEvents = null;\r\n\t\t\ticeGatherer.removeEventListener('localcandidate',\r\n\t\t\t\tthis.transceivers[sdpMLineIndex].bufferCandidates);\r\n\t\t\ticeGatherer.onlocalcandidate = function(evt) {\r\n\t\t\t\tif (pc.usingBundle && sdpMLineIndex > 0) {\r\n\t\t\t\t\t// if we know that we use bundle we can drop candidates with\r\n\t\t\t\t\t// ѕdpMLineIndex > 0. If we don't do this then our state gets\r\n\t\t\t\t\t// confused since we dispose the extra ice gatherer.\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar event = new Event('icecandidate');\r\n\t\t\t\tevent.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\r\n\t\r\n\t\t\t\tvar cand = evt.candidate;\r\n\t\t\t\t// Edge emits an empty object for RTCIceCandidateComplete‥\r\n\t\t\t\tvar end = !cand || Object.keys(cand).length === 0;\r\n\t\t\t\tif (end) {\r\n\t\t\t\t\t// polyfill since RTCIceGatherer.state is not implemented in\r\n\t\t\t\t\t// Edge 10547 yet.\r\n\t\t\t\t\tif (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\r\n\t\t\t\t\t\ticeGatherer.state = 'completed';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (iceGatherer.state === 'new') {\r\n\t\t\t\t\t\ticeGatherer.state = 'gathering';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// RTCIceCandidate doesn't have a component, needs to be added\r\n\t\t\t\t\tcand.component = 1;\r\n\t\t\t\t\t// also the usernameFragment. TODO: update SDP to take both variants.\r\n\t\t\t\t\tcand.ufrag = iceGatherer.getLocalParameters().usernameFragment;\r\n\t\r\n\t\t\t\t\tvar serializedCandidate = SDPUtils.writeCandidate(cand);\r\n\t\t\t\t\tevent.candidate = Object.assign(event.candidate,\r\n\t\t\t\t\t\t\tSDPUtils.parseCandidate(serializedCandidate));\r\n\t\r\n\t\t\t\t\tevent.candidate.candidate = serializedCandidate;\r\n\t\t\t\t\tevent.candidate.toJSON = function() {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tcandidate: event.candidate.candidate,\r\n\t\t\t\t\t\t\tsdpMid: event.candidate.sdpMid,\r\n\t\t\t\t\t\t\tsdpMLineIndex: event.candidate.sdpMLineIndex,\r\n\t\t\t\t\t\t\tusernameFragment: event.candidate.usernameFragment\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t// update local description.\r\n\t\t\t\tvar sections = SDPUtils.getMediaSections(pc._localDescription.sdp);\r\n\t\t\t\tif (!end) {\r\n\t\t\t\t\tsections[event.candidate.sdpMLineIndex] +=\r\n\t\t\t\t\t\t\t'a=' + event.candidate.candidate + '\\r\\n';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsections[event.candidate.sdpMLineIndex] +=\r\n\t\t\t\t\t\t\t'a=end-of-candidates\\r\\n';\r\n\t\t\t\t}\r\n\t\t\t\tpc._localDescription.sdp =\r\n\t\t\t\t\t\tSDPUtils.getDescription(pc._localDescription.sdp) +\r\n\t\t\t\t\t\tsections.join('');\r\n\t\t\t\tvar complete = pc.transceivers.every(function(transceiver) {\r\n\t\t\t\t\treturn transceiver.iceGatherer &&\r\n\t\t\t\t\t\t\ttransceiver.iceGatherer.state === 'completed';\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\tif (pc.iceGatheringState !== 'gathering') {\r\n\t\t\t\t\tpc.iceGatheringState = 'gathering';\r\n\t\t\t\t\tpc._emitGatheringStateChange();\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t// Emit candidate. Also emit null candidate when all gatherers are\r\n\t\t\t\t// complete.\r\n\t\t\t\tif (!end) {\r\n\t\t\t\t\tpc._dispatchEvent('icecandidate', event);\r\n\t\t\t\t}\r\n\t\t\t\tif (complete) {\r\n\t\t\t\t\tpc._dispatchEvent('icecandidate', new Event('icecandidate'));\r\n\t\t\t\t\tpc.iceGatheringState = 'complete';\r\n\t\t\t\t\tpc._emitGatheringStateChange();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\r\n\t\t\t// emit already gathered candidates.\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tbufferedCandidateEvents.forEach(function(e) {\r\n\t\t\t\t\ticeGatherer.onlocalcandidate(e);\r\n\t\t\t\t});\r\n\t\t\t}, 0);\r\n\t\t};\r\n\t\r\n\t\t// Create ICE transport and DTLS transport.\r\n\t\tRTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\r\n\t\t\tvar pc = this;\r\n\t\t\tvar iceTransport = new window.RTCIceTransport(null);\r\n\t\t\ticeTransport.onicestatechange = function() {\r\n\t\t\t\tpc._updateIceConnectionState();\r\n\t\t\t\tpc._updateConnectionState();\r\n\t\t\t};\r\n\t\r\n\t\t\tvar dtlsTransport = new window.RTCDtlsTransport(iceTransport);\r\n\t\t\tdtlsTransport.ondtlsstatechange = function() {\r\n\t\t\t\tpc._updateConnectionState();\r\n\t\t\t};\r\n\t\t\tdtlsTransport.onerror = function() {\r\n\t\t\t\t// onerror does not set state to failed by itself.\r\n\t\t\t\tObject.defineProperty(dtlsTransport, 'state',\r\n\t\t\t\t\t\t{value: 'failed', writable: true});\r\n\t\t\t\tpc._updateConnectionState();\r\n\t\t\t};\r\n\t\r\n\t\t\treturn {\r\n\t\t\t\ticeTransport: iceTransport,\r\n\t\t\t\tdtlsTransport: dtlsTransport\r\n\t\t\t};\r\n\t\t};\r\n\t\r\n\t\t// Destroy ICE gatherer, ICE transport and DTLS transport.\r\n\t\t// Without triggering the callbacks.\r\n\t\tRTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\r\n\t\t\t\tsdpMLineIndex) {\r\n\t\t\tvar iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\r\n\t\t\tif (iceGatherer) {\r\n\t\t\t\tdelete iceGatherer.onlocalcandidate;\r\n\t\t\t\tdelete this.transceivers[sdpMLineIndex].iceGatherer;\r\n\t\t\t}\r\n\t\t\tvar iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\r\n\t\t\tif (iceTransport) {\r\n\t\t\t\tdelete iceTransport.onicestatechange;\r\n\t\t\t\tdelete this.transceivers[sdpMLineIndex].iceTransport;\r\n\t\t\t}\r\n\t\t\tvar dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\r\n\t\t\tif (dtlsTransport) {\r\n\t\t\t\tdelete dtlsTransport.ondtlsstatechange;\r\n\t\t\t\tdelete dtlsTransport.onerror;\r\n\t\t\t\tdelete this.transceivers[sdpMLineIndex].dtlsTransport;\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\t// Start the RTP Sender and Receiver for a transceiver.\r\n\t\tRTCPeerConnection.prototype._transceive = function(transceiver,\r\n\t\t\t\tsend, recv) {\r\n\t\t\tvar params = getCommonCapabilities(transceiver.localCapabilities,\r\n\t\t\t\t\ttransceiver.remoteCapabilities);\r\n\t\t\tif (send && transceiver.rtpSender) {\r\n\t\t\t\tparams.encodings = transceiver.sendEncodingParameters;\r\n\t\t\t\tparams.rtcp = {\r\n\t\t\t\t\tcname: SDPUtils.localCName,\r\n\t\t\t\t\tcompound: transceiver.rtcpParameters.compound\r\n\t\t\t\t};\r\n\t\t\t\tif (transceiver.recvEncodingParameters.length) {\r\n\t\t\t\t\tparams.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\r\n\t\t\t\t}\r\n\t\t\t\ttransceiver.rtpSender.send(params);\r\n\t\t\t}\r\n\t\t\tif (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\r\n\t\t\t\t// remove RTX field in Edge 14942\r\n\t\t\t\tif (transceiver.kind === 'video'\r\n\t\t\t\t\t\t&& transceiver.recvEncodingParameters\r\n\t\t\t\t\t\t&& edgeVersion < 15019) {\r\n\t\t\t\t\ttransceiver.recvEncodingParameters.forEach(function(p) {\r\n\t\t\t\t\t\tdelete p.rtx;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.recvEncodingParameters.length) {\r\n\t\t\t\t\tparams.encodings = transceiver.recvEncodingParameters;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparams.encodings = [{}];\r\n\t\t\t\t}\r\n\t\t\t\tparams.rtcp = {\r\n\t\t\t\t\tcompound: transceiver.rtcpParameters.compound\r\n\t\t\t\t};\r\n\t\t\t\tif (transceiver.rtcpParameters.cname) {\r\n\t\t\t\t\tparams.rtcp.cname = transceiver.rtcpParameters.cname;\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.sendEncodingParameters.length) {\r\n\t\t\t\t\tparams.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\r\n\t\t\t\t}\r\n\t\t\t\ttransceiver.rtpReceiver.receive(params);\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.setLocalDescription = function(description) {\r\n\t\t\tvar pc = this;\r\n\t\r\n\t\t\t// Note: pranswer is not supported.\r\n\t\t\tif (['offer', 'answer'].indexOf(description.type) === -1) {\r\n\t\t\t\treturn Promise.reject(makeError('TypeError',\r\n\t\t\t\t\t\t'Unsupported type \"' + description.type + '\"'));\r\n\t\t\t}\r\n\t\r\n\t\t\tif (!isActionAllowedInSignalingState('setLocalDescription',\r\n\t\t\t\t\tdescription.type, pc.signalingState) || pc._isClosed) {\r\n\t\t\t\treturn Promise.reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Can not set local ' + description.type +\r\n\t\t\t\t\t\t' in state ' + pc.signalingState));\r\n\t\t\t}\r\n\t\r\n\t\t\tvar sections;\r\n\t\t\tvar sessionpart;\r\n\t\t\tif (description.type === 'offer') {\r\n\t\t\t\t// VERY limited support for SDP munging. Limited to:\r\n\t\t\t\t// * changing the order of codecs\r\n\t\t\t\tsections = SDPUtils.splitSections(description.sdp);\r\n\t\t\t\tsessionpart = sections.shift();\r\n\t\t\t\tsections.forEach(function(mediaSection, sdpMLineIndex) {\r\n\t\t\t\t\tvar caps = SDPUtils.parseRtpParameters(mediaSection);\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].localCapabilities = caps;\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\tpc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\r\n\t\t\t\t\tpc._gather(transceiver.mid, sdpMLineIndex);\r\n\t\t\t\t});\r\n\t\t\t} else if (description.type === 'answer') {\r\n\t\t\t\tsections = SDPUtils.splitSections(pc._remoteDescription.sdp);\r\n\t\t\t\tsessionpart = sections.shift();\r\n\t\t\t\tvar isIceLite = SDPUtils.matchPrefix(sessionpart,\r\n\t\t\t\t\t\t'a=ice-lite').length > 0;\r\n\t\t\t\tsections.forEach(function(mediaSection, sdpMLineIndex) {\r\n\t\t\t\t\tvar transceiver = pc.transceivers[sdpMLineIndex];\r\n\t\t\t\t\tvar iceGatherer = transceiver.iceGatherer;\r\n\t\t\t\t\tvar iceTransport = transceiver.iceTransport;\r\n\t\t\t\t\tvar dtlsTransport = transceiver.dtlsTransport;\r\n\t\t\t\t\tvar localCapabilities = transceiver.localCapabilities;\r\n\t\t\t\t\tvar remoteCapabilities = transceiver.remoteCapabilities;\r\n\t\r\n\t\t\t\t\t// treat bundle-only as not-rejected.\r\n\t\t\t\t\tvar rejected = SDPUtils.isRejected(mediaSection) &&\r\n\t\t\t\t\t\t\tSDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\r\n\t\r\n\t\t\t\t\tif (!rejected && !transceiver.rejected) {\r\n\t\t\t\t\t\tvar remoteIceParameters = SDPUtils.getIceParameters(\r\n\t\t\t\t\t\t\t\tmediaSection, sessionpart);\r\n\t\t\t\t\t\tvar remoteDtlsParameters = SDPUtils.getDtlsParameters(\r\n\t\t\t\t\t\t\t\tmediaSection, sessionpart);\r\n\t\t\t\t\t\tif (isIceLite) {\r\n\t\t\t\t\t\t\tremoteDtlsParameters.role = 'server';\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\tif (!pc.usingBundle || sdpMLineIndex === 0) {\r\n\t\t\t\t\t\t\tpc._gather(transceiver.mid, sdpMLineIndex);\r\n\t\t\t\t\t\t\tif (iceTransport.state === 'new') {\r\n\t\t\t\t\t\t\t\ticeTransport.start(iceGatherer, remoteIceParameters,\r\n\t\t\t\t\t\t\t\t\t\tisIceLite ? 'controlling' : 'controlled');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (dtlsTransport.state === 'new') {\r\n\t\t\t\t\t\t\t\tdtlsTransport.start(remoteDtlsParameters);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t// Calculate intersection of capabilities.\r\n\t\t\t\t\t\tvar params = getCommonCapabilities(localCapabilities,\r\n\t\t\t\t\t\t\t\tremoteCapabilities);\r\n\t\r\n\t\t\t\t\t\t// Start the RTCRtpSender. The RTCRtpReceiver for this\r\n\t\t\t\t\t\t// transceiver has already been started in setRemoteDescription.\r\n\t\t\t\t\t\tpc._transceive(transceiver,\r\n\t\t\t\t\t\t\t\tparams.codecs.length > 0,\r\n\t\t\t\t\t\t\t\tfalse);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\r\n\t\t\tpc._localDescription = {\r\n\t\t\t\ttype: description.type,\r\n\t\t\t\tsdp: description.sdp\r\n\t\t\t};\r\n\t\t\tif (description.type === 'offer') {\r\n\t\t\t\tpc._updateSignalingState('have-local-offer');\r\n\t\t\t} else {\r\n\t\t\t\tpc._updateSignalingState('stable');\r\n\t\t\t}\r\n\t\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.setRemoteDescription = function(description) {\r\n\t\t\tvar pc = this;\r\n\t\r\n\t\t\t// Note: pranswer is not supported.\r\n\t\t\tif (['offer', 'answer'].indexOf(description.type) === -1) {\r\n\t\t\t\treturn Promise.reject(makeError('TypeError',\r\n\t\t\t\t\t\t'Unsupported type \"' + description.type + '\"'));\r\n\t\t\t}\r\n\t\r\n\t\t\tif (!isActionAllowedInSignalingState('setRemoteDescription',\r\n\t\t\t\t\tdescription.type, pc.signalingState) || pc._isClosed) {\r\n\t\t\t\treturn Promise.reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Can not set remote ' + description.type +\r\n\t\t\t\t\t\t' in state ' + pc.signalingState));\r\n\t\t\t}\r\n\t\r\n\t\t\tvar streams = {};\r\n\t\t\tpc.remoteStreams.forEach(function(stream) {\r\n\t\t\t\tstreams[stream.id] = stream;\r\n\t\t\t});\r\n\t\t\tvar receiverList = [];\r\n\t\t\tvar sections = SDPUtils.splitSections(description.sdp);\r\n\t\t\tvar sessionpart = sections.shift();\r\n\t\t\tvar isIceLite = SDPUtils.matchPrefix(sessionpart,\r\n\t\t\t\t\t'a=ice-lite').length > 0;\r\n\t\t\tvar usingBundle = SDPUtils.matchPrefix(sessionpart,\r\n\t\t\t\t\t'a=group:BUNDLE ').length > 0;\r\n\t\t\tpc.usingBundle = usingBundle;\r\n\t\t\tvar iceOptions = SDPUtils.matchPrefix(sessionpart,\r\n\t\t\t\t\t'a=ice-options:')[0];\r\n\t\t\tif (iceOptions) {\r\n\t\t\t\tpc.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\r\n\t\t\t\t\t\t.indexOf('trickle') >= 0;\r\n\t\t\t} else {\r\n\t\t\t\tpc.canTrickleIceCandidates = false;\r\n\t\t\t}\r\n\t\r\n\t\t\tsections.forEach(function(mediaSection, sdpMLineIndex) {\r\n\t\t\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\t\t\tvar kind = SDPUtils.getKind(mediaSection);\r\n\t\t\t\t// treat bundle-only as not-rejected.\r\n\t\t\t\tvar rejected = SDPUtils.isRejected(mediaSection) &&\r\n\t\t\t\t\t\tSDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\r\n\t\t\t\tvar protocol = lines[0].substr(2).split(' ')[2];\r\n\t\r\n\t\t\t\tvar direction = SDPUtils.getDirection(mediaSection, sessionpart);\r\n\t\t\t\tvar remoteMsid = SDPUtils.parseMsid(mediaSection);\r\n\t\r\n\t\t\t\tvar mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\r\n\t\r\n\t\t\t\t// Reject datachannels which are not implemented yet.\r\n\t\t\t\tif (rejected || (kind === 'application' && (protocol === 'DTLS/SCTP' ||\r\n\t\t\t\t\t\tprotocol === 'UDP/DTLS/SCTP'))) {\r\n\t\t\t\t\t// TODO: this is dangerous in the case where a non-rejected m-line\r\n\t\t\t\t\t//     becomes rejected.\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex] = {\r\n\t\t\t\t\t\tmid: mid,\r\n\t\t\t\t\t\tkind: kind,\r\n\t\t\t\t\t\tprotocol: protocol,\r\n\t\t\t\t\t\trejected: true\r\n\t\t\t\t\t};\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif (!rejected && pc.transceivers[sdpMLineIndex] &&\r\n\t\t\t\t\t\tpc.transceivers[sdpMLineIndex].rejected) {\r\n\t\t\t\t\t// recycle a rejected transceiver.\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex] = pc._createTransceiver(kind, true);\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tvar transceiver;\r\n\t\t\t\tvar iceGatherer;\r\n\t\t\t\tvar iceTransport;\r\n\t\t\t\tvar dtlsTransport;\r\n\t\t\t\tvar rtpReceiver;\r\n\t\t\t\tvar sendEncodingParameters;\r\n\t\t\t\tvar recvEncodingParameters;\r\n\t\t\t\tvar localCapabilities;\r\n\t\r\n\t\t\t\tvar track;\r\n\t\t\t\t// FIXME: ensure the mediaSection has rtcp-mux set.\r\n\t\t\t\tvar remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\r\n\t\t\t\tvar remoteIceParameters;\r\n\t\t\t\tvar remoteDtlsParameters;\r\n\t\t\t\tif (!rejected) {\r\n\t\t\t\t\tremoteIceParameters = SDPUtils.getIceParameters(mediaSection,\r\n\t\t\t\t\t\t\tsessionpart);\r\n\t\t\t\t\tremoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\r\n\t\t\t\t\t\t\tsessionpart);\r\n\t\t\t\t\tremoteDtlsParameters.role = 'client';\r\n\t\t\t\t}\r\n\t\t\t\trecvEncodingParameters =\r\n\t\t\t\t\t\tSDPUtils.parseRtpEncodingParameters(mediaSection);\r\n\t\r\n\t\t\t\tvar rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\r\n\t\r\n\t\t\t\tvar isComplete = SDPUtils.matchPrefix(mediaSection,\r\n\t\t\t\t\t\t'a=end-of-candidates', sessionpart).length > 0;\r\n\t\t\t\tvar cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\r\n\t\t\t\t\t\t.map(function(cand) {\r\n\t\t\t\t\t\t\treturn SDPUtils.parseCandidate(cand);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.filter(function(cand) {\r\n\t\t\t\t\t\t\treturn cand.component === 1;\r\n\t\t\t\t\t\t});\r\n\t\r\n\t\t\t\t// Check if we can use BUNDLE and dispose transports.\r\n\t\t\t\tif ((description.type === 'offer' || description.type === 'answer') &&\r\n\t\t\t\t\t\t!rejected && usingBundle && sdpMLineIndex > 0 &&\r\n\t\t\t\t\t\tpc.transceivers[sdpMLineIndex]) {\r\n\t\t\t\t\tpc._disposeIceAndDtlsTransports(sdpMLineIndex);\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].iceGatherer =\r\n\t\t\t\t\t\t\tpc.transceivers[0].iceGatherer;\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].iceTransport =\r\n\t\t\t\t\t\t\tpc.transceivers[0].iceTransport;\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].dtlsTransport =\r\n\t\t\t\t\t\t\tpc.transceivers[0].dtlsTransport;\r\n\t\t\t\t\tif (pc.transceivers[sdpMLineIndex].rtpSender) {\r\n\t\t\t\t\t\tpc.transceivers[sdpMLineIndex].rtpSender.setTransport(\r\n\t\t\t\t\t\t\t\tpc.transceivers[0].dtlsTransport);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (pc.transceivers[sdpMLineIndex].rtpReceiver) {\r\n\t\t\t\t\t\tpc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\r\n\t\t\t\t\t\t\t\tpc.transceivers[0].dtlsTransport);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (description.type === 'offer' && !rejected) {\r\n\t\t\t\t\ttransceiver = pc.transceivers[sdpMLineIndex] ||\r\n\t\t\t\t\t\t\tpc._createTransceiver(kind);\r\n\t\t\t\t\ttransceiver.mid = mid;\r\n\t\r\n\t\t\t\t\tif (!transceiver.iceGatherer) {\r\n\t\t\t\t\t\ttransceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\r\n\t\t\t\t\t\t\t\tusingBundle);\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tif (cands.length && transceiver.iceTransport.state === 'new') {\r\n\t\t\t\t\t\tif (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\r\n\t\t\t\t\t\t\ttransceiver.iceTransport.setRemoteCandidates(cands);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcands.forEach(function(candidate) {\r\n\t\t\t\t\t\t\t\tmaybeAddCandidate(transceiver.iceTransport, candidate);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tlocalCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\r\n\t\r\n\t\t\t\t\t// filter RTX until additional stuff needed for RTX is implemented\r\n\t\t\t\t\t// in adapter.js\r\n\t\t\t\t\tif (edgeVersion < 15019) {\r\n\t\t\t\t\t\tlocalCapabilities.codecs = localCapabilities.codecs.filter(\r\n\t\t\t\t\t\t\t\tfunction(codec) {\r\n\t\t\t\t\t\t\t\t\treturn codec.name !== 'rtx';\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tsendEncodingParameters = transceiver.sendEncodingParameters || [{\r\n\t\t\t\t\t\tssrc: (2 * sdpMLineIndex + 2) * 1001\r\n\t\t\t\t\t}];\r\n\t\r\n\t\t\t\t\t// TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\r\n\t\t\t\t\tvar isNewTrack = false;\r\n\t\t\t\t\tif (direction === 'sendrecv' || direction === 'sendonly') {\r\n\t\t\t\t\t\tisNewTrack = !transceiver.rtpReceiver;\r\n\t\t\t\t\t\trtpReceiver = transceiver.rtpReceiver ||\r\n\t\t\t\t\t\t\t\tnew window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\r\n\t\r\n\t\t\t\t\t\tif (isNewTrack) {\r\n\t\t\t\t\t\t\tvar stream;\r\n\t\t\t\t\t\t\ttrack = rtpReceiver.track;\r\n\t\t\t\t\t\t\t// FIXME: does not work with Plan B.\r\n\t\t\t\t\t\t\tif (remoteMsid && remoteMsid.stream === '-') {\r\n\t\t\t\t\t\t\t\t// no-op. a stream id of '-' means: no associated stream.\r\n\t\t\t\t\t\t\t} else if (remoteMsid) {\r\n\t\t\t\t\t\t\t\tif (!streams[remoteMsid.stream]) {\r\n\t\t\t\t\t\t\t\t\tstreams[remoteMsid.stream] = new window.MediaStream();\r\n\t\t\t\t\t\t\t\t\tObject.defineProperty(streams[remoteMsid.stream], 'id', {\r\n\t\t\t\t\t\t\t\t\t\tget: function() {\r\n\t\t\t\t\t\t\t\t\t\t\treturn remoteMsid.stream;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tObject.defineProperty(track, 'id', {\r\n\t\t\t\t\t\t\t\t\tget: function() {\r\n\t\t\t\t\t\t\t\t\t\treturn remoteMsid.track;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tstream = streams[remoteMsid.stream];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (!streams.default) {\r\n\t\t\t\t\t\t\t\t\tstreams.default = new window.MediaStream();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tstream = streams.default;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (stream) {\r\n\t\t\t\t\t\t\t\taddTrackToStreamAndFireEvent(track, stream);\r\n\t\t\t\t\t\t\t\ttransceiver.associatedRemoteMediaStreams.push(stream);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treceiverList.push([track, rtpReceiver, stream]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\r\n\t\t\t\t\t\ttransceiver.associatedRemoteMediaStreams.forEach(function(s) {\r\n\t\t\t\t\t\t\tvar nativeTrack = s.getTracks().find(function(t) {\r\n\t\t\t\t\t\t\t\treturn t.id === transceiver.rtpReceiver.track.id;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tif (nativeTrack) {\r\n\t\t\t\t\t\t\t\tremoveTrackFromStreamAndFireEvent(nativeTrack, s);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\ttransceiver.associatedRemoteMediaStreams = [];\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\ttransceiver.localCapabilities = localCapabilities;\r\n\t\t\t\t\ttransceiver.remoteCapabilities = remoteCapabilities;\r\n\t\t\t\t\ttransceiver.rtpReceiver = rtpReceiver;\r\n\t\t\t\t\ttransceiver.rtcpParameters = rtcpParameters;\r\n\t\t\t\t\ttransceiver.sendEncodingParameters = sendEncodingParameters;\r\n\t\t\t\t\ttransceiver.recvEncodingParameters = recvEncodingParameters;\r\n\t\r\n\t\t\t\t\t// Start the RTCRtpReceiver now. The RTPSender is started in\r\n\t\t\t\t\t// setLocalDescription.\r\n\t\t\t\t\tpc._transceive(pc.transceivers[sdpMLineIndex],\r\n\t\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\t\tisNewTrack);\r\n\t\t\t\t} else if (description.type === 'answer' && !rejected) {\r\n\t\t\t\t\ttransceiver = pc.transceivers[sdpMLineIndex];\r\n\t\t\t\t\ticeGatherer = transceiver.iceGatherer;\r\n\t\t\t\t\ticeTransport = transceiver.iceTransport;\r\n\t\t\t\t\tdtlsTransport = transceiver.dtlsTransport;\r\n\t\t\t\t\trtpReceiver = transceiver.rtpReceiver;\r\n\t\t\t\t\tsendEncodingParameters = transceiver.sendEncodingParameters;\r\n\t\t\t\t\tlocalCapabilities = transceiver.localCapabilities;\r\n\t\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].recvEncodingParameters =\r\n\t\t\t\t\t\t\trecvEncodingParameters;\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].remoteCapabilities =\r\n\t\t\t\t\t\t\tremoteCapabilities;\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\r\n\t\r\n\t\t\t\t\tif (cands.length && iceTransport.state === 'new') {\r\n\t\t\t\t\t\tif ((isIceLite || isComplete) &&\r\n\t\t\t\t\t\t\t\t(!usingBundle || sdpMLineIndex === 0)) {\r\n\t\t\t\t\t\t\ticeTransport.setRemoteCandidates(cands);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcands.forEach(function(candidate) {\r\n\t\t\t\t\t\t\t\tmaybeAddCandidate(transceiver.iceTransport, candidate);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tif (!usingBundle || sdpMLineIndex === 0) {\r\n\t\t\t\t\t\tif (iceTransport.state === 'new') {\r\n\t\t\t\t\t\t\ticeTransport.start(iceGatherer, remoteIceParameters,\r\n\t\t\t\t\t\t\t\t\t'controlling');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (dtlsTransport.state === 'new') {\r\n\t\t\t\t\t\t\tdtlsTransport.start(remoteDtlsParameters);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t// If the offer contained RTX but the answer did not,\r\n\t\t\t\t\t// remove RTX from sendEncodingParameters.\r\n\t\t\t\t\tvar commonCapabilities = getCommonCapabilities(\r\n\t\t\t\t\t\ttransceiver.localCapabilities,\r\n\t\t\t\t\t\ttransceiver.remoteCapabilities);\r\n\t\r\n\t\t\t\t\tvar hasRtx = commonCapabilities.codecs.filter(function(c) {\r\n\t\t\t\t\t\treturn c.name.toLowerCase() === 'rtx';\r\n\t\t\t\t\t}).length;\r\n\t\t\t\t\tif (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\t\t\t\tdelete transceiver.sendEncodingParameters[0].rtx;\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tpc._transceive(transceiver,\r\n\t\t\t\t\t\t\tdirection === 'sendrecv' || direction === 'recvonly',\r\n\t\t\t\t\t\t\tdirection === 'sendrecv' || direction === 'sendonly');\r\n\t\r\n\t\t\t\t\t// TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\r\n\t\t\t\t\tif (rtpReceiver &&\r\n\t\t\t\t\t\t\t(direction === 'sendrecv' || direction === 'sendonly')) {\r\n\t\t\t\t\t\ttrack = rtpReceiver.track;\r\n\t\t\t\t\t\tif (remoteMsid) {\r\n\t\t\t\t\t\t\tif (!streams[remoteMsid.stream]) {\r\n\t\t\t\t\t\t\t\tstreams[remoteMsid.stream] = new window.MediaStream();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\taddTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\r\n\t\t\t\t\t\t\treceiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (!streams.default) {\r\n\t\t\t\t\t\t\t\tstreams.default = new window.MediaStream();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\taddTrackToStreamAndFireEvent(track, streams.default);\r\n\t\t\t\t\t\t\treceiverList.push([track, rtpReceiver, streams.default]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// FIXME: actually the receiver should be created later.\r\n\t\t\t\t\t\tdelete transceiver.rtpReceiver;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tif (pc._dtlsRole === undefined) {\r\n\t\t\t\tpc._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\r\n\t\t\t}\r\n\t\r\n\t\t\tpc._remoteDescription = {\r\n\t\t\t\ttype: description.type,\r\n\t\t\t\tsdp: description.sdp\r\n\t\t\t};\r\n\t\t\tif (description.type === 'offer') {\r\n\t\t\t\tpc._updateSignalingState('have-remote-offer');\r\n\t\t\t} else {\r\n\t\t\t\tpc._updateSignalingState('stable');\r\n\t\t\t}\r\n\t\t\tObject.keys(streams).forEach(function(sid) {\r\n\t\t\t\tvar stream = streams[sid];\r\n\t\t\t\tif (stream.getTracks().length) {\r\n\t\t\t\t\tif (pc.remoteStreams.indexOf(stream) === -1) {\r\n\t\t\t\t\t\tpc.remoteStreams.push(stream);\r\n\t\t\t\t\t\tvar event = new Event('addstream');\r\n\t\t\t\t\t\tevent.stream = stream;\r\n\t\t\t\t\t\twindow.setTimeout(function() {\r\n\t\t\t\t\t\t\tpc._dispatchEvent('addstream', event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\treceiverList.forEach(function(item) {\r\n\t\t\t\t\t\tvar track = item[0];\r\n\t\t\t\t\t\tvar receiver = item[1];\r\n\t\t\t\t\t\tif (stream.id !== item[2].id) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfireAddTrack(pc, track, receiver, [stream]);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treceiverList.forEach(function(item) {\r\n\t\t\t\tif (item[2]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tfireAddTrack(pc, item[0], item[1], []);\r\n\t\t\t});\r\n\t\r\n\t\t\t// check whether addIceCandidate({}) was called within four seconds after\r\n\t\t\t// setRemoteDescription.\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tif (!(pc && pc.transceivers)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tpc.transceivers.forEach(function(transceiver) {\r\n\t\t\t\t\tif (transceiver.iceTransport &&\r\n\t\t\t\t\t\t\ttransceiver.iceTransport.state === 'new' &&\r\n\t\t\t\t\t\t\ttransceiver.iceTransport.getRemoteCandidates().length > 0) {\r\n\t\t\t\t\t\tconsole.warn('Timeout for addRemoteCandidate. Consider sending ' +\r\n\t\t\t\t\t\t\t\t'an end-of-candidates notification');\r\n\t\t\t\t\t\ttransceiver.iceTransport.addRemoteCandidate({});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}, 4000);\r\n\t\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.close = function() {\r\n\t\t\tthis.transceivers.forEach(function(transceiver) {\r\n\t\t\t\t/* not yet\r\n\t\t\t\tif (transceiver.iceGatherer) {\r\n\t\t\t\t\ttransceiver.iceGatherer.close();\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\tif (transceiver.iceTransport) {\r\n\t\t\t\t\ttransceiver.iceTransport.stop();\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.dtlsTransport) {\r\n\t\t\t\t\ttransceiver.dtlsTransport.stop();\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.rtpSender) {\r\n\t\t\t\t\ttransceiver.rtpSender.stop();\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.rtpReceiver) {\r\n\t\t\t\t\ttransceiver.rtpReceiver.stop();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// FIXME: clean up tracks, local streams, remote streams, etc\r\n\t\t\tthis._isClosed = true;\r\n\t\t\tthis._updateSignalingState('closed');\r\n\t\t};\r\n\t\r\n\t\t// Update the signaling state.\r\n\t\tRTCPeerConnection.prototype._updateSignalingState = function(newState) {\r\n\t\t\tthis.signalingState = newState;\r\n\t\t\tvar event = new Event('signalingstatechange');\r\n\t\t\tthis._dispatchEvent('signalingstatechange', event);\r\n\t\t};\r\n\t\r\n\t\t// Determine whether to fire the negotiationneeded event.\r\n\t\tRTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\r\n\t\t\tvar pc = this;\r\n\t\t\tif (this.signalingState !== 'stable' || this.needNegotiation === true) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.needNegotiation = true;\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tif (pc.needNegotiation) {\r\n\t\t\t\t\tpc.needNegotiation = false;\r\n\t\t\t\t\tvar event = new Event('negotiationneeded');\r\n\t\t\t\t\tpc._dispatchEvent('negotiationneeded', event);\r\n\t\t\t\t}\r\n\t\t\t}, 0);\r\n\t\t};\r\n\t\r\n\t\t// Update the ice connection state.\r\n\t\tRTCPeerConnection.prototype._updateIceConnectionState = function() {\r\n\t\t\tvar newState;\r\n\t\t\tvar states = {\r\n\t\t\t\t'new': 0,\r\n\t\t\t\tclosed: 0,\r\n\t\t\t\tchecking: 0,\r\n\t\t\t\tconnected: 0,\r\n\t\t\t\tcompleted: 0,\r\n\t\t\t\tdisconnected: 0,\r\n\t\t\t\tfailed: 0\r\n\t\t\t};\r\n\t\t\tthis.transceivers.forEach(function(transceiver) {\r\n\t\t\t\tif (transceiver.iceTransport && !transceiver.rejected) {\r\n\t\t\t\t\tstates[transceiver.iceTransport.state]++;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tnewState = 'new';\r\n\t\t\tif (states.failed > 0) {\r\n\t\t\t\tnewState = 'failed';\r\n\t\t\t} else if (states.checking > 0) {\r\n\t\t\t\tnewState = 'checking';\r\n\t\t\t} else if (states.disconnected > 0) {\r\n\t\t\t\tnewState = 'disconnected';\r\n\t\t\t} else if (states.new > 0) {\r\n\t\t\t\tnewState = 'new';\r\n\t\t\t} else if (states.connected > 0) {\r\n\t\t\t\tnewState = 'connected';\r\n\t\t\t} else if (states.completed > 0) {\r\n\t\t\t\tnewState = 'completed';\r\n\t\t\t}\r\n\t\r\n\t\t\tif (newState !== this.iceConnectionState) {\r\n\t\t\t\tthis.iceConnectionState = newState;\r\n\t\t\t\tvar event = new Event('iceconnectionstatechange');\r\n\t\t\t\tthis._dispatchEvent('iceconnectionstatechange', event);\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\t// Update the connection state.\r\n\t\tRTCPeerConnection.prototype._updateConnectionState = function() {\r\n\t\t\tvar newState;\r\n\t\t\tvar states = {\r\n\t\t\t\t'new': 0,\r\n\t\t\t\tclosed: 0,\r\n\t\t\t\tconnecting: 0,\r\n\t\t\t\tconnected: 0,\r\n\t\t\t\tcompleted: 0,\r\n\t\t\t\tdisconnected: 0,\r\n\t\t\t\tfailed: 0\r\n\t\t\t};\r\n\t\t\tthis.transceivers.forEach(function(transceiver) {\r\n\t\t\t\tif (transceiver.iceTransport && transceiver.dtlsTransport &&\r\n\t\t\t\t\t\t!transceiver.rejected) {\r\n\t\t\t\t\tstates[transceiver.iceTransport.state]++;\r\n\t\t\t\t\tstates[transceiver.dtlsTransport.state]++;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// ICETransport.completed and connected are the same for this purpose.\r\n\t\t\tstates.connected += states.completed;\r\n\t\r\n\t\t\tnewState = 'new';\r\n\t\t\tif (states.failed > 0) {\r\n\t\t\t\tnewState = 'failed';\r\n\t\t\t} else if (states.connecting > 0) {\r\n\t\t\t\tnewState = 'connecting';\r\n\t\t\t} else if (states.disconnected > 0) {\r\n\t\t\t\tnewState = 'disconnected';\r\n\t\t\t} else if (states.new > 0) {\r\n\t\t\t\tnewState = 'new';\r\n\t\t\t} else if (states.connected > 0) {\r\n\t\t\t\tnewState = 'connected';\r\n\t\t\t}\r\n\t\r\n\t\t\tif (newState !== this.connectionState) {\r\n\t\t\t\tthis.connectionState = newState;\r\n\t\t\t\tvar event = new Event('connectionstatechange');\r\n\t\t\t\tthis._dispatchEvent('connectionstatechange', event);\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.createOffer = function() {\r\n\t\t\tvar pc = this;\r\n\t\r\n\t\t\tif (pc._isClosed) {\r\n\t\t\t\treturn Promise.reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Can not call createOffer after close'));\r\n\t\t\t}\r\n\t\r\n\t\t\tvar numAudioTracks = pc.transceivers.filter(function(t) {\r\n\t\t\t\treturn t.kind === 'audio';\r\n\t\t\t}).length;\r\n\t\t\tvar numVideoTracks = pc.transceivers.filter(function(t) {\r\n\t\t\t\treturn t.kind === 'video';\r\n\t\t\t}).length;\r\n\t\r\n\t\t\t// Determine number of audio and video tracks we need to send/recv.\r\n\t\t\tvar offerOptions = arguments[0];\r\n\t\t\tif (offerOptions) {\r\n\t\t\t\t// Reject Chrome legacy constraints.\r\n\t\t\t\tif (offerOptions.mandatory || offerOptions.optional) {\r\n\t\t\t\t\tthrow new TypeError(\r\n\t\t\t\t\t\t\t'Legacy mandatory/optional constraints not supported.');\r\n\t\t\t\t}\r\n\t\t\t\tif (offerOptions.offerToReceiveAudio !== undefined) {\r\n\t\t\t\t\tif (offerOptions.offerToReceiveAudio === true) {\r\n\t\t\t\t\t\tnumAudioTracks = 1;\r\n\t\t\t\t\t} else if (offerOptions.offerToReceiveAudio === false) {\r\n\t\t\t\t\t\tnumAudioTracks = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnumAudioTracks = offerOptions.offerToReceiveAudio;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (offerOptions.offerToReceiveVideo !== undefined) {\r\n\t\t\t\t\tif (offerOptions.offerToReceiveVideo === true) {\r\n\t\t\t\t\t\tnumVideoTracks = 1;\r\n\t\t\t\t\t} else if (offerOptions.offerToReceiveVideo === false) {\r\n\t\t\t\t\t\tnumVideoTracks = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnumVideoTracks = offerOptions.offerToReceiveVideo;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\tpc.transceivers.forEach(function(transceiver) {\r\n\t\t\t\tif (transceiver.kind === 'audio') {\r\n\t\t\t\t\tnumAudioTracks--;\r\n\t\t\t\t\tif (numAudioTracks < 0) {\r\n\t\t\t\t\t\ttransceiver.wantReceive = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (transceiver.kind === 'video') {\r\n\t\t\t\t\tnumVideoTracks--;\r\n\t\t\t\t\tif (numVideoTracks < 0) {\r\n\t\t\t\t\t\ttransceiver.wantReceive = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\t// Create M-lines for recvonly streams.\r\n\t\t\twhile (numAudioTracks > 0 || numVideoTracks > 0) {\r\n\t\t\t\tif (numAudioTracks > 0) {\r\n\t\t\t\t\tpc._createTransceiver('audio');\r\n\t\t\t\t\tnumAudioTracks--;\r\n\t\t\t\t}\r\n\t\t\t\tif (numVideoTracks > 0) {\r\n\t\t\t\t\tpc._createTransceiver('video');\r\n\t\t\t\t\tnumVideoTracks--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\tvar sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\r\n\t\t\t\t\tpc._sdpSessionVersion++);\r\n\t\t\tpc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\r\n\t\t\t\t// For each track, create an ice gatherer, ice transport,\r\n\t\t\t\t// dtls transport, potentially rtpsender and rtpreceiver.\r\n\t\t\t\tvar track = transceiver.track;\r\n\t\t\t\tvar kind = transceiver.kind;\r\n\t\t\t\tvar mid = transceiver.mid || SDPUtils.generateIdentifier();\r\n\t\t\t\ttransceiver.mid = mid;\r\n\t\r\n\t\t\t\tif (!transceiver.iceGatherer) {\r\n\t\t\t\t\ttransceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\r\n\t\t\t\t\t\t\tpc.usingBundle);\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tvar localCapabilities = window.RTCRtpSender.getCapabilities(kind);\r\n\t\t\t\t// filter RTX until additional stuff needed for RTX is implemented\r\n\t\t\t\t// in adapter.js\r\n\t\t\t\tif (edgeVersion < 15019) {\r\n\t\t\t\t\tlocalCapabilities.codecs = localCapabilities.codecs.filter(\r\n\t\t\t\t\t\t\tfunction(codec) {\r\n\t\t\t\t\t\t\t\treturn codec.name !== 'rtx';\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tlocalCapabilities.codecs.forEach(function(codec) {\r\n\t\t\t\t\t// work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\r\n\t\t\t\t\t// by adding level-asymmetry-allowed=1\r\n\t\t\t\t\tif (codec.name === 'H264' &&\r\n\t\t\t\t\t\t\tcodec.parameters['level-asymmetry-allowed'] === undefined) {\r\n\t\t\t\t\t\tcodec.parameters['level-asymmetry-allowed'] = '1';\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t// for subsequent offers, we might have to re-use the payload\r\n\t\t\t\t\t// type of the last offer.\r\n\t\t\t\t\tif (transceiver.remoteCapabilities &&\r\n\t\t\t\t\t\t\ttransceiver.remoteCapabilities.codecs) {\r\n\t\t\t\t\t\ttransceiver.remoteCapabilities.codecs.forEach(function(remoteCodec) {\r\n\t\t\t\t\t\t\tif (codec.name.toLowerCase() === remoteCodec.name.toLowerCase() &&\r\n\t\t\t\t\t\t\t\t\tcodec.clockRate === remoteCodec.clockRate) {\r\n\t\t\t\t\t\t\t\tcodec.preferredPayloadType = remoteCodec.payloadType;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlocalCapabilities.headerExtensions.forEach(function(hdrExt) {\r\n\t\t\t\t\tvar remoteExtensions = transceiver.remoteCapabilities &&\r\n\t\t\t\t\t\t\ttransceiver.remoteCapabilities.headerExtensions || [];\r\n\t\t\t\t\tremoteExtensions.forEach(function(rHdrExt) {\r\n\t\t\t\t\t\tif (hdrExt.uri === rHdrExt.uri) {\r\n\t\t\t\t\t\t\thdrExt.id = rHdrExt.id;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\t// generate an ssrc now, to be used later in rtpSender.send\r\n\t\t\t\tvar sendEncodingParameters = transceiver.sendEncodingParameters || [{\r\n\t\t\t\t\tssrc: (2 * sdpMLineIndex + 1) * 1001\r\n\t\t\t\t}];\r\n\t\t\t\tif (track) {\r\n\t\t\t\t\t// add RTX\r\n\t\t\t\t\tif (edgeVersion >= 15019 && kind === 'video' &&\r\n\t\t\t\t\t\t\t!sendEncodingParameters[0].rtx) {\r\n\t\t\t\t\t\tsendEncodingParameters[0].rtx = {\r\n\t\t\t\t\t\t\tssrc: sendEncodingParameters[0].ssrc + 1\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif (transceiver.wantReceive) {\r\n\t\t\t\t\ttransceiver.rtpReceiver = new window.RTCRtpReceiver(\r\n\t\t\t\t\t\t\ttransceiver.dtlsTransport, kind);\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\ttransceiver.localCapabilities = localCapabilities;\r\n\t\t\t\ttransceiver.sendEncodingParameters = sendEncodingParameters;\r\n\t\t\t});\r\n\t\r\n\t\t\t// always offer BUNDLE and dispose on return if not supported.\r\n\t\t\tif (pc._config.bundlePolicy !== 'max-compat') {\r\n\t\t\t\tsdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\r\n\t\t\t\t\treturn t.mid;\r\n\t\t\t\t}).join(' ') + '\\r\\n';\r\n\t\t\t}\r\n\t\t\tsdp += 'a=ice-options:trickle\\r\\n';\r\n\t\r\n\t\t\tpc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\r\n\t\t\t\tsdp += writeMediaSection(transceiver, transceiver.localCapabilities,\r\n\t\t\t\t\t\t'offer', transceiver.stream, pc._dtlsRole);\r\n\t\t\t\tsdp += 'a=rtcp-rsize\\r\\n';\r\n\t\r\n\t\t\t\tif (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\r\n\t\t\t\t\t\t(sdpMLineIndex === 0 || !pc.usingBundle)) {\r\n\t\t\t\t\ttransceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\r\n\t\t\t\t\t\tcand.component = 1;\r\n\t\t\t\t\t\tsdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\r\n\t\t\t\t\t});\r\n\t\r\n\t\t\t\t\tif (transceiver.iceGatherer.state === 'completed') {\r\n\t\t\t\t\t\tsdp += 'a=end-of-candidates\\r\\n';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tvar desc = new window.RTCSessionDescription({\r\n\t\t\t\ttype: 'offer',\r\n\t\t\t\tsdp: sdp\r\n\t\t\t});\r\n\t\t\treturn Promise.resolve(desc);\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.createAnswer = function() {\r\n\t\t\tvar pc = this;\r\n\t\r\n\t\t\tif (pc._isClosed) {\r\n\t\t\t\treturn Promise.reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Can not call createAnswer after close'));\r\n\t\t\t}\r\n\t\r\n\t\t\tif (!(pc.signalingState === 'have-remote-offer' ||\r\n\t\t\t\t\tpc.signalingState === 'have-local-pranswer')) {\r\n\t\t\t\treturn Promise.reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Can not call createAnswer in signalingState ' + pc.signalingState));\r\n\t\t\t}\r\n\t\r\n\t\t\tvar sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\r\n\t\t\t\t\tpc._sdpSessionVersion++);\r\n\t\t\tif (pc.usingBundle) {\r\n\t\t\t\tsdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\r\n\t\t\t\t\treturn t.mid;\r\n\t\t\t\t}).join(' ') + '\\r\\n';\r\n\t\t\t}\r\n\t\t\tsdp += 'a=ice-options:trickle\\r\\n';\r\n\t\r\n\t\t\tvar mediaSectionsInOffer = SDPUtils.getMediaSections(\r\n\t\t\t\t\tpc._remoteDescription.sdp).length;\r\n\t\t\tpc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\r\n\t\t\t\tif (sdpMLineIndex + 1 > mediaSectionsInOffer) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.rejected) {\r\n\t\t\t\t\tif (transceiver.kind === 'application') {\r\n\t\t\t\t\t\tif (transceiver.protocol === 'DTLS/SCTP') { // legacy fmt\r\n\t\t\t\t\t\t\tsdp += 'm=application 0 DTLS/SCTP 5000\\r\\n';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsdp += 'm=application 0 ' + transceiver.protocol +\r\n\t\t\t\t\t\t\t\t\t' webrtc-datachannel\\r\\n';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (transceiver.kind === 'audio') {\r\n\t\t\t\t\t\tsdp += 'm=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\n' +\r\n\t\t\t\t\t\t\t\t'a=rtpmap:0 PCMU/8000\\r\\n';\r\n\t\t\t\t\t} else if (transceiver.kind === 'video') {\r\n\t\t\t\t\t\tsdp += 'm=video 0 UDP/TLS/RTP/SAVPF 120\\r\\n' +\r\n\t\t\t\t\t\t\t\t'a=rtpmap:120 VP8/90000\\r\\n';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsdp += 'c=IN IP4 0.0.0.0\\r\\n' +\r\n\t\t\t\t\t\t\t'a=inactive\\r\\n' +\r\n\t\t\t\t\t\t\t'a=mid:' + transceiver.mid + '\\r\\n';\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t// FIXME: look at direction.\r\n\t\t\t\tif (transceiver.stream) {\r\n\t\t\t\t\tvar localTrack;\r\n\t\t\t\t\tif (transceiver.kind === 'audio') {\r\n\t\t\t\t\t\tlocalTrack = transceiver.stream.getAudioTracks()[0];\r\n\t\t\t\t\t} else if (transceiver.kind === 'video') {\r\n\t\t\t\t\t\tlocalTrack = transceiver.stream.getVideoTracks()[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (localTrack) {\r\n\t\t\t\t\t\t// add RTX\r\n\t\t\t\t\t\tif (edgeVersion >= 15019 && transceiver.kind === 'video' &&\r\n\t\t\t\t\t\t\t\t!transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\t\t\t\t\ttransceiver.sendEncodingParameters[0].rtx = {\r\n\t\t\t\t\t\t\t\tssrc: transceiver.sendEncodingParameters[0].ssrc + 1\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t// Calculate intersection of capabilities.\r\n\t\t\t\tvar commonCapabilities = getCommonCapabilities(\r\n\t\t\t\t\t\ttransceiver.localCapabilities,\r\n\t\t\t\t\t\ttransceiver.remoteCapabilities);\r\n\t\r\n\t\t\t\tvar hasRtx = commonCapabilities.codecs.filter(function(c) {\r\n\t\t\t\t\treturn c.name.toLowerCase() === 'rtx';\r\n\t\t\t\t}).length;\r\n\t\t\t\tif (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\t\t\tdelete transceiver.sendEncodingParameters[0].rtx;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tsdp += writeMediaSection(transceiver, commonCapabilities,\r\n\t\t\t\t\t\t'answer', transceiver.stream, pc._dtlsRole);\r\n\t\t\t\tif (transceiver.rtcpParameters &&\r\n\t\t\t\t\t\ttransceiver.rtcpParameters.reducedSize) {\r\n\t\t\t\t\tsdp += 'a=rtcp-rsize\\r\\n';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tvar desc = new window.RTCSessionDescription({\r\n\t\t\t\ttype: 'answer',\r\n\t\t\t\tsdp: sdp\r\n\t\t\t});\r\n\t\t\treturn Promise.resolve(desc);\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.addIceCandidate = function(candidate) {\r\n\t\t\tvar pc = this;\r\n\t\t\tvar sections;\r\n\t\t\tif (candidate && !(candidate.sdpMLineIndex !== undefined ||\r\n\t\t\t\t\tcandidate.sdpMid)) {\r\n\t\t\t\treturn Promise.reject(new TypeError('sdpMLineIndex or sdpMid required'));\r\n\t\t\t}\r\n\t\r\n\t\t\t// TODO: needs to go into ops queue.\r\n\t\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\t\tif (!pc._remoteDescription) {\r\n\t\t\t\t\treturn reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t\t'Can not add ICE candidate without a remote description'));\r\n\t\t\t\t} else if (!candidate || candidate.candidate === '') {\r\n\t\t\t\t\tfor (var j = 0; j < pc.transceivers.length; j++) {\r\n\t\t\t\t\t\tif (pc.transceivers[j].rejected) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tpc.transceivers[j].iceTransport.addRemoteCandidate({});\r\n\t\t\t\t\t\tsections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\r\n\t\t\t\t\t\tsections[j] += 'a=end-of-candidates\\r\\n';\r\n\t\t\t\t\t\tpc._remoteDescription.sdp =\r\n\t\t\t\t\t\t\t\tSDPUtils.getDescription(pc._remoteDescription.sdp) +\r\n\t\t\t\t\t\t\t\tsections.join('');\r\n\t\t\t\t\t\tif (pc.usingBundle) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar sdpMLineIndex = candidate.sdpMLineIndex;\r\n\t\t\t\t\tif (candidate.sdpMid) {\r\n\t\t\t\t\t\tfor (var i = 0; i < pc.transceivers.length; i++) {\r\n\t\t\t\t\t\t\tif (pc.transceivers[i].mid === candidate.sdpMid) {\r\n\t\t\t\t\t\t\t\tsdpMLineIndex = i;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar transceiver = pc.transceivers[sdpMLineIndex];\r\n\t\t\t\t\tif (transceiver) {\r\n\t\t\t\t\t\tif (transceiver.rejected) {\r\n\t\t\t\t\t\t\treturn resolve();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar cand = Object.keys(candidate.candidate).length > 0 ?\r\n\t\t\t\t\t\t\t\tSDPUtils.parseCandidate(candidate.candidate) : {};\r\n\t\t\t\t\t\t// Ignore Chrome's invalid candidates since Edge does not like them.\r\n\t\t\t\t\t\tif (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\r\n\t\t\t\t\t\t\treturn resolve();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Ignore RTCP candidates, we assume RTCP-MUX.\r\n\t\t\t\t\t\tif (cand.component && cand.component !== 1) {\r\n\t\t\t\t\t\t\treturn resolve();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// when using bundle, avoid adding candidates to the wrong\r\n\t\t\t\t\t\t// ice transport. And avoid adding candidates added in the SDP.\r\n\t\t\t\t\t\tif (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\r\n\t\t\t\t\t\t\t\ttransceiver.iceTransport !== pc.transceivers[0].iceTransport)) {\r\n\t\t\t\t\t\t\tif (!maybeAddCandidate(transceiver.iceTransport, cand)) {\r\n\t\t\t\t\t\t\t\treturn reject(makeError('OperationError',\r\n\t\t\t\t\t\t\t\t\t\t'Can not add ICE candidate'));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t// update the remoteDescription.\r\n\t\t\t\t\t\tvar candidateString = candidate.candidate.trim();\r\n\t\t\t\t\t\tif (candidateString.indexOf('a=') === 0) {\r\n\t\t\t\t\t\t\tcandidateString = candidateString.substr(2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\r\n\t\t\t\t\t\tsections[sdpMLineIndex] += 'a=' +\r\n\t\t\t\t\t\t\t\t(cand.type ? candidateString : 'end-of-candidates')\r\n\t\t\t\t\t\t\t\t+ '\\r\\n';\r\n\t\t\t\t\t\tpc._remoteDescription.sdp =\r\n\t\t\t\t\t\t\t\tSDPUtils.getDescription(pc._remoteDescription.sdp) +\r\n\t\t\t\t\t\t\t\tsections.join('');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn reject(makeError('OperationError',\r\n\t\t\t\t\t\t\t\t'Can not add ICE candidate'));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tresolve();\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getStats = function(selector) {\r\n\t\t\tif (selector && selector instanceof window.MediaStreamTrack) {\r\n\t\t\t\tvar senderOrReceiver = null;\r\n\t\t\t\tthis.transceivers.forEach(function(transceiver) {\r\n\t\t\t\t\tif (transceiver.rtpSender &&\r\n\t\t\t\t\t\t\ttransceiver.rtpSender.track === selector) {\r\n\t\t\t\t\t\tsenderOrReceiver = transceiver.rtpSender;\r\n\t\t\t\t\t} else if (transceiver.rtpReceiver &&\r\n\t\t\t\t\t\t\ttransceiver.rtpReceiver.track === selector) {\r\n\t\t\t\t\t\tsenderOrReceiver = transceiver.rtpReceiver;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (!senderOrReceiver) {\r\n\t\t\t\t\tthrow makeError('InvalidAccessError', 'Invalid selector.');\r\n\t\t\t\t}\r\n\t\t\t\treturn senderOrReceiver.getStats();\r\n\t\t\t}\r\n\t\r\n\t\t\tvar promises = [];\r\n\t\t\tthis.transceivers.forEach(function(transceiver) {\r\n\t\t\t\t['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\r\n\t\t\t\t\t\t'dtlsTransport'].forEach(function(method) {\r\n\t\t\t\t\t\t\tif (transceiver[method]) {\r\n\t\t\t\t\t\t\t\tpromises.push(transceiver[method].getStats());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn Promise.all(promises).then(function(allStats) {\r\n\t\t\t\tvar results = new Map();\r\n\t\t\t\tallStats.forEach(function(stats) {\r\n\t\t\t\t\tstats.forEach(function(stat) {\r\n\t\t\t\t\t\tresults.set(stat.id, stat);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\treturn results;\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\t// fix low-level stat names and return Map instead of object.\r\n\t\tvar ortcObjects = ['RTCRtpSender', 'RTCRtpReceiver', 'RTCIceGatherer',\r\n\t\t\t'RTCIceTransport', 'RTCDtlsTransport'];\r\n\t\tortcObjects.forEach(function(ortcObjectName) {\r\n\t\t\tvar obj = window[ortcObjectName];\r\n\t\t\tif (obj && obj.prototype && obj.prototype.getStats) {\r\n\t\t\t\tvar nativeGetstats = obj.prototype.getStats;\r\n\t\t\t\tobj.prototype.getStats = function() {\r\n\t\t\t\t\treturn nativeGetstats.apply(this)\r\n\t\t\t\t\t.then(function(nativeStats) {\r\n\t\t\t\t\t\tvar mapStats = new Map();\r\n\t\t\t\t\t\tObject.keys(nativeStats).forEach(function(id) {\r\n\t\t\t\t\t\t\tnativeStats[id].type = fixStatsType(nativeStats[id]);\r\n\t\t\t\t\t\t\tmapStats.set(id, nativeStats[id]);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn mapStats;\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t});\r\n\t\r\n\t\t// legacy callback shims. Should be moved to adapter.js some days.\r\n\t\tvar methods = ['createOffer', 'createAnswer'];\r\n\t\tmethods.forEach(function(method) {\r\n\t\t\tvar nativeMethod = RTCPeerConnection.prototype[method];\r\n\t\t\tRTCPeerConnection.prototype[method] = function() {\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\tif (typeof args[0] === 'function' ||\r\n\t\t\t\t\t\ttypeof args[1] === 'function') { // legacy\r\n\t\t\t\t\treturn nativeMethod.apply(this, [arguments[2]])\r\n\t\t\t\t\t.then(function(description) {\r\n\t\t\t\t\t\tif (typeof args[0] === 'function') {\r\n\t\t\t\t\t\t\targs[0].apply(null, [description]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, function(error) {\r\n\t\t\t\t\t\tif (typeof args[1] === 'function') {\r\n\t\t\t\t\t\t\targs[1].apply(null, [error]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn nativeMethod.apply(this, arguments);\r\n\t\t\t};\r\n\t\t});\r\n\t\r\n\t\tmethods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\r\n\t\tmethods.forEach(function(method) {\r\n\t\t\tvar nativeMethod = RTCPeerConnection.prototype[method];\r\n\t\t\tRTCPeerConnection.prototype[method] = function() {\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\tif (typeof args[1] === 'function' ||\r\n\t\t\t\t\t\ttypeof args[2] === 'function') { // legacy\r\n\t\t\t\t\treturn nativeMethod.apply(this, arguments)\r\n\t\t\t\t\t.then(function() {\r\n\t\t\t\t\t\tif (typeof args[1] === 'function') {\r\n\t\t\t\t\t\t\targs[1].apply(null);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, function(error) {\r\n\t\t\t\t\t\tif (typeof args[2] === 'function') {\r\n\t\t\t\t\t\t\targs[2].apply(null, [error]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn nativeMethod.apply(this, arguments);\r\n\t\t\t};\r\n\t\t});\r\n\t\r\n\t\t// getStats is special. It doesn't have a spec legacy method yet we support\r\n\t\t// getStats(something, cb) without error callbacks.\r\n\t\t['getStats'].forEach(function(method) {\r\n\t\t\tvar nativeMethod = RTCPeerConnection.prototype[method];\r\n\t\t\tRTCPeerConnection.prototype[method] = function() {\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\tif (typeof args[1] === 'function') {\r\n\t\t\t\t\treturn nativeMethod.apply(this, arguments)\r\n\t\t\t\t\t.then(function() {\r\n\t\t\t\t\t\tif (typeof args[1] === 'function') {\r\n\t\t\t\t\t\t\targs[1].apply(null);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn nativeMethod.apply(this, arguments);\r\n\t\t\t};\r\n\t\t});\r\n\t\r\n\t\treturn RTCPeerConnection;\r\n\t};\r\n\t\r\n\t},{\"sdp\":17}],17:[function(require,module,exports){\r\n\t /* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\t// SDP helpers.\r\n\tvar SDPUtils = {};\r\n\t\r\n\t// Generate an alphanumeric identifier for cname or mids.\r\n\t// TODO: use UUIDs instead? https://gist.github.com/jed/982883\r\n\tSDPUtils.generateIdentifier = function() {\r\n\t\treturn Math.random().toString(36).substr(2, 10);\r\n\t};\r\n\t\r\n\t// The RTCP CNAME used by all peerconnections from the same JS.\r\n\tSDPUtils.localCName = SDPUtils.generateIdentifier();\r\n\t\r\n\t// Splits SDP into lines, dealing with both CRLF and LF.\r\n\tSDPUtils.splitLines = function(blob) {\r\n\t\treturn blob.trim().split('\\n').map(function(line) {\r\n\t\t\treturn line.trim();\r\n\t\t});\r\n\t};\r\n\t// Splits SDP into sessionpart and mediasections. Ensures CRLF.\r\n\tSDPUtils.splitSections = function(blob) {\r\n\t\tvar parts = blob.split('\\nm=');\r\n\t\treturn parts.map(function(part, index) {\r\n\t\t\treturn (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\r\n\t\t});\r\n\t};\r\n\t\r\n\t// returns the session description.\r\n\tSDPUtils.getDescription = function(blob) {\r\n\t\tvar sections = SDPUtils.splitSections(blob);\r\n\t\treturn sections && sections[0];\r\n\t};\r\n\t\r\n\t// returns the individual media sections.\r\n\tSDPUtils.getMediaSections = function(blob) {\r\n\t\tvar sections = SDPUtils.splitSections(blob);\r\n\t\tsections.shift();\r\n\t\treturn sections;\r\n\t};\r\n\t\r\n\t// Returns lines that start with a certain prefix.\r\n\tSDPUtils.matchPrefix = function(blob, prefix) {\r\n\t\treturn SDPUtils.splitLines(blob).filter(function(line) {\r\n\t\t\treturn line.indexOf(prefix) === 0;\r\n\t\t});\r\n\t};\r\n\t\r\n\t// Parses an ICE candidate line. Sample input:\r\n\t// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\r\n\t// rport 55996\"\r\n\tSDPUtils.parseCandidate = function(line) {\r\n\t\tvar parts;\r\n\t\t// Parse both variants.\r\n\t\tif (line.indexOf('a=candidate:') === 0) {\r\n\t\t\tparts = line.substring(12).split(' ');\r\n\t\t} else {\r\n\t\t\tparts = line.substring(10).split(' ');\r\n\t\t}\r\n\t\r\n\t\tvar candidate = {\r\n\t\t\tfoundation: parts[0],\r\n\t\t\tcomponent: parseInt(parts[1], 10),\r\n\t\t\tprotocol: parts[2].toLowerCase(),\r\n\t\t\tpriority: parseInt(parts[3], 10),\r\n\t\t\tip: parts[4],\r\n\t\t\taddress: parts[4], // address is an alias for ip.\r\n\t\t\tport: parseInt(parts[5], 10),\r\n\t\t\t// skip parts[6] == 'typ'\r\n\t\t\ttype: parts[7]\r\n\t\t};\r\n\t\r\n\t\tfor (var i = 8; i < parts.length; i += 2) {\r\n\t\t\tswitch (parts[i]) {\r\n\t\t\t\tcase 'raddr':\r\n\t\t\t\t\tcandidate.relatedAddress = parts[i + 1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'rport':\r\n\t\t\t\t\tcandidate.relatedPort = parseInt(parts[i + 1], 10);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'tcptype':\r\n\t\t\t\t\tcandidate.tcpType = parts[i + 1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'ufrag':\r\n\t\t\t\t\tcandidate.ufrag = parts[i + 1]; // for backward compability.\r\n\t\t\t\t\tcandidate.usernameFragment = parts[i + 1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault: // extension handling, in particular ufrag\r\n\t\t\t\t\tcandidate[parts[i]] = parts[i + 1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn candidate;\r\n\t};\r\n\t\r\n\t// Translates a candidate object into SDP candidate attribute.\r\n\tSDPUtils.writeCandidate = function(candidate) {\r\n\t\tvar sdp = [];\r\n\t\tsdp.push(candidate.foundation);\r\n\t\tsdp.push(candidate.component);\r\n\t\tsdp.push(candidate.protocol.toUpperCase());\r\n\t\tsdp.push(candidate.priority);\r\n\t\tsdp.push(candidate.address || candidate.ip);\r\n\t\tsdp.push(candidate.port);\r\n\t\r\n\t\tvar type = candidate.type;\r\n\t\tsdp.push('typ');\r\n\t\tsdp.push(type);\r\n\t\tif (type !== 'host' && candidate.relatedAddress &&\r\n\t\t\t\tcandidate.relatedPort) {\r\n\t\t\tsdp.push('raddr');\r\n\t\t\tsdp.push(candidate.relatedAddress);\r\n\t\t\tsdp.push('rport');\r\n\t\t\tsdp.push(candidate.relatedPort);\r\n\t\t}\r\n\t\tif (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\r\n\t\t\tsdp.push('tcptype');\r\n\t\t\tsdp.push(candidate.tcpType);\r\n\t\t}\r\n\t\tif (candidate.usernameFragment || candidate.ufrag) {\r\n\t\t\tsdp.push('ufrag');\r\n\t\t\tsdp.push(candidate.usernameFragment || candidate.ufrag);\r\n\t\t}\r\n\t\treturn 'candidate:' + sdp.join(' ');\r\n\t};\r\n\t\r\n\t// Parses an ice-options line, returns an array of option tags.\r\n\t// a=ice-options:foo bar\r\n\tSDPUtils.parseIceOptions = function(line) {\r\n\t\treturn line.substr(14).split(' ');\r\n\t};\r\n\t\r\n\t// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\r\n\t// a=rtpmap:111 opus/48000/2\r\n\tSDPUtils.parseRtpMap = function(line) {\r\n\t\tvar parts = line.substr(9).split(' ');\r\n\t\tvar parsed = {\r\n\t\t\tpayloadType: parseInt(parts.shift(), 10) // was: id\r\n\t\t};\r\n\t\r\n\t\tparts = parts[0].split('/');\r\n\t\r\n\t\tparsed.name = parts[0];\r\n\t\tparsed.clockRate = parseInt(parts[1], 10); // was: clockrate\r\n\t\tparsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\r\n\t\t// legacy alias, got renamed back to channels in ORTC.\r\n\t\tparsed.numChannels = parsed.channels;\r\n\t\treturn parsed;\r\n\t};\r\n\t\r\n\t// Generate an a=rtpmap line from RTCRtpCodecCapability or\r\n\t// RTCRtpCodecParameters.\r\n\tSDPUtils.writeRtpMap = function(codec) {\r\n\t\tvar pt = codec.payloadType;\r\n\t\tif (codec.preferredPayloadType !== undefined) {\r\n\t\t\tpt = codec.preferredPayloadType;\r\n\t\t}\r\n\t\tvar channels = codec.channels || codec.numChannels || 1;\r\n\t\treturn 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\r\n\t\t\t\t(channels !== 1 ? '/' + channels : '') + '\\r\\n';\r\n\t};\r\n\t\r\n\t// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\r\n\t// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\r\n\t// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\r\n\tSDPUtils.parseExtmap = function(line) {\r\n\t\tvar parts = line.substr(9).split(' ');\r\n\t\treturn {\r\n\t\t\tid: parseInt(parts[0], 10),\r\n\t\t\tdirection: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\r\n\t\t\turi: parts[1]\r\n\t\t};\r\n\t};\r\n\t\r\n\t// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\r\n\t// RTCRtpHeaderExtension.\r\n\tSDPUtils.writeExtmap = function(headerExtension) {\r\n\t\treturn 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\r\n\t\t\t\t(headerExtension.direction && headerExtension.direction !== 'sendrecv'\r\n\t\t\t\t\t\t? '/' + headerExtension.direction\r\n\t\t\t\t\t\t: '') +\r\n\t\t\t\t' ' + headerExtension.uri + '\\r\\n';\r\n\t};\r\n\t\r\n\t// Parses an ftmp line, returns dictionary. Sample input:\r\n\t// a=fmtp:96 vbr=on;cng=on\r\n\t// Also deals with vbr=on; cng=on\r\n\tSDPUtils.parseFmtp = function(line) {\r\n\t\tvar parsed = {};\r\n\t\tvar kv;\r\n\t\tvar parts = line.substr(line.indexOf(' ') + 1).split(';');\r\n\t\tfor (var j = 0; j < parts.length; j++) {\r\n\t\t\tkv = parts[j].trim().split('=');\r\n\t\t\tparsed[kv[0].trim()] = kv[1];\r\n\t\t}\r\n\t\treturn parsed;\r\n\t};\r\n\t\r\n\t// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\r\n\tSDPUtils.writeFmtp = function(codec) {\r\n\t\tvar line = '';\r\n\t\tvar pt = codec.payloadType;\r\n\t\tif (codec.preferredPayloadType !== undefined) {\r\n\t\t\tpt = codec.preferredPayloadType;\r\n\t\t}\r\n\t\tif (codec.parameters && Object.keys(codec.parameters).length) {\r\n\t\t\tvar params = [];\r\n\t\t\tObject.keys(codec.parameters).forEach(function(param) {\r\n\t\t\t\tif (codec.parameters[param]) {\r\n\t\t\t\t\tparams.push(param + '=' + codec.parameters[param]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparams.push(param);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tline += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\r\n\t\t}\r\n\t\treturn line;\r\n\t};\r\n\t\r\n\t// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\r\n\t// a=rtcp-fb:98 nack rpsi\r\n\tSDPUtils.parseRtcpFb = function(line) {\r\n\t\tvar parts = line.substr(line.indexOf(' ') + 1).split(' ');\r\n\t\treturn {\r\n\t\t\ttype: parts.shift(),\r\n\t\t\tparameter: parts.join(' ')\r\n\t\t};\r\n\t};\r\n\t// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\r\n\tSDPUtils.writeRtcpFb = function(codec) {\r\n\t\tvar lines = '';\r\n\t\tvar pt = codec.payloadType;\r\n\t\tif (codec.preferredPayloadType !== undefined) {\r\n\t\t\tpt = codec.preferredPayloadType;\r\n\t\t}\r\n\t\tif (codec.rtcpFeedback && codec.rtcpFeedback.length) {\r\n\t\t\t// FIXME: special handling for trr-int?\r\n\t\t\tcodec.rtcpFeedback.forEach(function(fb) {\r\n\t\t\t\tlines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\r\n\t\t\t\t(fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\r\n\t\t\t\t\t\t'\\r\\n';\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn lines;\r\n\t};\r\n\t\r\n\t// Parses an RFC 5576 ssrc media attribute. Sample input:\r\n\t// a=ssrc:3735928559 cname:something\r\n\tSDPUtils.parseSsrcMedia = function(line) {\r\n\t\tvar sp = line.indexOf(' ');\r\n\t\tvar parts = {\r\n\t\t\tssrc: parseInt(line.substr(7, sp - 7), 10)\r\n\t\t};\r\n\t\tvar colon = line.indexOf(':', sp);\r\n\t\tif (colon > -1) {\r\n\t\t\tparts.attribute = line.substr(sp + 1, colon - sp - 1);\r\n\t\t\tparts.value = line.substr(colon + 1);\r\n\t\t} else {\r\n\t\t\tparts.attribute = line.substr(sp + 1);\r\n\t\t}\r\n\t\treturn parts;\r\n\t};\r\n\t\r\n\tSDPUtils.parseSsrcGroup = function(line) {\r\n\t\tvar parts = line.substr(13).split(' ');\r\n\t\treturn {\r\n\t\t\tsemantics: parts.shift(),\r\n\t\t\tssrcs: parts.map(function(ssrc) {\r\n\t\t\t\treturn parseInt(ssrc, 10);\r\n\t\t\t})\r\n\t\t};\r\n\t};\r\n\t\r\n\t// Extracts the MID (RFC 5888) from a media section.\r\n\t// returns the MID or undefined if no mid line was found.\r\n\tSDPUtils.getMid = function(mediaSection) {\r\n\t\tvar mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\r\n\t\tif (mid) {\r\n\t\t\treturn mid.substr(6);\r\n\t\t}\r\n\t};\r\n\t\r\n\tSDPUtils.parseFingerprint = function(line) {\r\n\t\tvar parts = line.substr(14).split(' ');\r\n\t\treturn {\r\n\t\t\talgorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\r\n\t\t\tvalue: parts[1]\r\n\t\t};\r\n\t};\r\n\t\r\n\t// Extracts DTLS parameters from SDP media section or sessionpart.\r\n\t// FIXME: for consistency with other functions this should only\r\n\t//   get the fingerprint line as input. See also getIceParameters.\r\n\tSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\r\n\t\tvar lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\r\n\t\t\t\t'a=fingerprint:');\r\n\t\t// Note: a=setup line is ignored since we use the 'auto' role.\r\n\t\t// Note2: 'algorithm' is not case sensitive except in Edge.\r\n\t\treturn {\r\n\t\t\trole: 'auto',\r\n\t\t\tfingerprints: lines.map(SDPUtils.parseFingerprint)\r\n\t\t};\r\n\t};\r\n\t\r\n\t// Serializes DTLS parameters to SDP.\r\n\tSDPUtils.writeDtlsParameters = function(params, setupType) {\r\n\t\tvar sdp = 'a=setup:' + setupType + '\\r\\n';\r\n\t\tparams.fingerprints.forEach(function(fp) {\r\n\t\t\tsdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\r\n\t\t});\r\n\t\treturn sdp;\r\n\t};\r\n\t// Parses ICE information from SDP media section or sessionpart.\r\n\t// FIXME: for consistency with other functions this should only\r\n\t//   get the ice-ufrag and ice-pwd lines as input.\r\n\tSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\r\n\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\t// Search in session part, too.\r\n\t\tlines = lines.concat(SDPUtils.splitLines(sessionpart));\r\n\t\tvar iceParameters = {\r\n\t\t\tusernameFragment: lines.filter(function(line) {\r\n\t\t\t\treturn line.indexOf('a=ice-ufrag:') === 0;\r\n\t\t\t})[0].substr(12),\r\n\t\t\tpassword: lines.filter(function(line) {\r\n\t\t\t\treturn line.indexOf('a=ice-pwd:') === 0;\r\n\t\t\t})[0].substr(10)\r\n\t\t};\r\n\t\treturn iceParameters;\r\n\t};\r\n\t\r\n\t// Serializes ICE parameters to SDP.\r\n\tSDPUtils.writeIceParameters = function(params) {\r\n\t\treturn 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\r\n\t\t\t\t'a=ice-pwd:' + params.password + '\\r\\n';\r\n\t};\r\n\t\r\n\t// Parses the SDP media section and returns RTCRtpParameters.\r\n\tSDPUtils.parseRtpParameters = function(mediaSection) {\r\n\t\tvar description = {\r\n\t\t\tcodecs: [],\r\n\t\t\theaderExtensions: [],\r\n\t\t\tfecMechanisms: [],\r\n\t\t\trtcp: []\r\n\t\t};\r\n\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\tvar mline = lines[0].split(' ');\r\n\t\tfor (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\r\n\t\t\tvar pt = mline[i];\r\n\t\t\tvar rtpmapline = SDPUtils.matchPrefix(\r\n\t\t\t\t\tmediaSection, 'a=rtpmap:' + pt + ' ')[0];\r\n\t\t\tif (rtpmapline) {\r\n\t\t\t\tvar codec = SDPUtils.parseRtpMap(rtpmapline);\r\n\t\t\t\tvar fmtps = SDPUtils.matchPrefix(\r\n\t\t\t\t\t\tmediaSection, 'a=fmtp:' + pt + ' ');\r\n\t\t\t\t// Only the first a=fmtp:<pt> is considered.\r\n\t\t\t\tcodec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\r\n\t\t\t\tcodec.rtcpFeedback = SDPUtils.matchPrefix(\r\n\t\t\t\t\t\tmediaSection, 'a=rtcp-fb:' + pt + ' ')\r\n\t\t\t\t\t.map(SDPUtils.parseRtcpFb);\r\n\t\t\t\tdescription.codecs.push(codec);\r\n\t\t\t\t// parse FEC mechanisms from rtpmap lines.\r\n\t\t\t\tswitch (codec.name.toUpperCase()) {\r\n\t\t\t\t\tcase 'RED':\r\n\t\t\t\t\tcase 'ULPFEC':\r\n\t\t\t\t\t\tdescription.fecMechanisms.push(codec.name.toUpperCase());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault: // only RED and ULPFEC are recognized as FEC mechanisms.\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tSDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\r\n\t\t\tdescription.headerExtensions.push(SDPUtils.parseExtmap(line));\r\n\t\t});\r\n\t\t// FIXME: parse rtcp.\r\n\t\treturn description;\r\n\t};\r\n\t\r\n\t// Generates parts of the SDP media section describing the capabilities /\r\n\t// parameters.\r\n\tSDPUtils.writeRtpDescription = function(kind, caps) {\r\n\t\tvar sdp = '';\r\n\t\r\n\t\t// Build the mline.\r\n\t\tsdp += 'm=' + kind + ' ';\r\n\t\tsdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\r\n\t\tsdp += ' UDP/TLS/RTP/SAVPF ';\r\n\t\tsdp += caps.codecs.map(function(codec) {\r\n\t\t\tif (codec.preferredPayloadType !== undefined) {\r\n\t\t\t\treturn codec.preferredPayloadType;\r\n\t\t\t}\r\n\t\t\treturn codec.payloadType;\r\n\t\t}).join(' ') + '\\r\\n';\r\n\t\r\n\t\tsdp += 'c=IN IP4 0.0.0.0\\r\\n';\r\n\t\tsdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\r\n\t\r\n\t\t// Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\r\n\t\tcaps.codecs.forEach(function(codec) {\r\n\t\t\tsdp += SDPUtils.writeRtpMap(codec);\r\n\t\t\tsdp += SDPUtils.writeFmtp(codec);\r\n\t\t\tsdp += SDPUtils.writeRtcpFb(codec);\r\n\t\t});\r\n\t\tvar maxptime = 0;\r\n\t\tcaps.codecs.forEach(function(codec) {\r\n\t\t\tif (codec.maxptime > maxptime) {\r\n\t\t\t\tmaxptime = codec.maxptime;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (maxptime > 0) {\r\n\t\t\tsdp += 'a=maxptime:' + maxptime + '\\r\\n';\r\n\t\t}\r\n\t\tsdp += 'a=rtcp-mux\\r\\n';\r\n\t\r\n\t\tif (caps.headerExtensions) {\r\n\t\t\tcaps.headerExtensions.forEach(function(extension) {\r\n\t\t\t\tsdp += SDPUtils.writeExtmap(extension);\r\n\t\t\t});\r\n\t\t}\r\n\t\t// FIXME: write fecMechanisms.\r\n\t\treturn sdp;\r\n\t};\r\n\t\r\n\t// Parses the SDP media section and returns an array of\r\n\t// RTCRtpEncodingParameters.\r\n\tSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\r\n\t\tvar encodingParameters = [];\r\n\t\tvar description = SDPUtils.parseRtpParameters(mediaSection);\r\n\t\tvar hasRed = description.fecMechanisms.indexOf('RED') !== -1;\r\n\t\tvar hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\r\n\t\r\n\t\t// filter a=ssrc:... cname:, ignore PlanB-msid\r\n\t\tvar ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n\t\t.map(function(line) {\r\n\t\t\treturn SDPUtils.parseSsrcMedia(line);\r\n\t\t})\r\n\t\t.filter(function(parts) {\r\n\t\t\treturn parts.attribute === 'cname';\r\n\t\t});\r\n\t\tvar primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\r\n\t\tvar secondarySsrc;\r\n\t\r\n\t\tvar flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\r\n\t\t.map(function(line) {\r\n\t\t\tvar parts = line.substr(17).split(' ');\r\n\t\t\treturn parts.map(function(part) {\r\n\t\t\t\treturn parseInt(part, 10);\r\n\t\t\t});\r\n\t\t});\r\n\t\tif (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\r\n\t\t\tsecondarySsrc = flows[0][1];\r\n\t\t}\r\n\t\r\n\t\tdescription.codecs.forEach(function(codec) {\r\n\t\t\tif (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\r\n\t\t\t\tvar encParam = {\r\n\t\t\t\t\tssrc: primarySsrc,\r\n\t\t\t\t\tcodecPayloadType: parseInt(codec.parameters.apt, 10)\r\n\t\t\t\t};\r\n\t\t\t\tif (primarySsrc && secondarySsrc) {\r\n\t\t\t\t\tencParam.rtx = {ssrc: secondarySsrc};\r\n\t\t\t\t}\r\n\t\t\t\tencodingParameters.push(encParam);\r\n\t\t\t\tif (hasRed) {\r\n\t\t\t\t\tencParam = JSON.parse(JSON.stringify(encParam));\r\n\t\t\t\t\tencParam.fec = {\r\n\t\t\t\t\t\tssrc: primarySsrc,\r\n\t\t\t\t\t\tmechanism: hasUlpfec ? 'red+ulpfec' : 'red'\r\n\t\t\t\t\t};\r\n\t\t\t\t\tencodingParameters.push(encParam);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (encodingParameters.length === 0 && primarySsrc) {\r\n\t\t\tencodingParameters.push({\r\n\t\t\t\tssrc: primarySsrc\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\t// we support both b=AS and b=TIAS but interpret AS as TIAS.\r\n\t\tvar bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\r\n\t\tif (bandwidth.length) {\r\n\t\t\tif (bandwidth[0].indexOf('b=TIAS:') === 0) {\r\n\t\t\t\tbandwidth = parseInt(bandwidth[0].substr(7), 10);\r\n\t\t\t} else if (bandwidth[0].indexOf('b=AS:') === 0) {\r\n\t\t\t\t// use formula from JSEP to convert b=AS to TIAS value.\r\n\t\t\t\tbandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\r\n\t\t\t\t\t\t- (50 * 40 * 8);\r\n\t\t\t} else {\r\n\t\t\t\tbandwidth = undefined;\r\n\t\t\t}\r\n\t\t\tencodingParameters.forEach(function(params) {\r\n\t\t\t\tparams.maxBitrate = bandwidth;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn encodingParameters;\r\n\t};\r\n\t\r\n\t// parses http://draft.ortc.org/#rtcrtcpparameters*\r\n\tSDPUtils.parseRtcpParameters = function(mediaSection) {\r\n\t\tvar rtcpParameters = {};\r\n\t\r\n\t\t// Gets the first SSRC. Note tha with RTX there might be multiple\r\n\t\t// SSRCs.\r\n\t\tvar remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n\t\t\t\t.map(function(line) {\r\n\t\t\t\t\treturn SDPUtils.parseSsrcMedia(line);\r\n\t\t\t\t})\r\n\t\t\t\t.filter(function(obj) {\r\n\t\t\t\t\treturn obj.attribute === 'cname';\r\n\t\t\t\t})[0];\r\n\t\tif (remoteSsrc) {\r\n\t\t\trtcpParameters.cname = remoteSsrc.value;\r\n\t\t\trtcpParameters.ssrc = remoteSsrc.ssrc;\r\n\t\t}\r\n\t\r\n\t\t// Edge uses the compound attribute instead of reducedSize\r\n\t\t// compound is !reducedSize\r\n\t\tvar rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\r\n\t\trtcpParameters.reducedSize = rsize.length > 0;\r\n\t\trtcpParameters.compound = rsize.length === 0;\r\n\t\r\n\t\t// parses the rtcp-mux attrіbute.\r\n\t\t// Note that Edge does not support unmuxed RTCP.\r\n\t\tvar mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\r\n\t\trtcpParameters.mux = mux.length > 0;\r\n\t\r\n\t\treturn rtcpParameters;\r\n\t};\r\n\t\r\n\t// parses either a=msid: or a=ssrc:... msid lines and returns\r\n\t// the id of the MediaStream and MediaStreamTrack.\r\n\tSDPUtils.parseMsid = function(mediaSection) {\r\n\t\tvar parts;\r\n\t\tvar spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\r\n\t\tif (spec.length === 1) {\r\n\t\t\tparts = spec[0].substr(7).split(' ');\r\n\t\t\treturn {stream: parts[0], track: parts[1]};\r\n\t\t}\r\n\t\tvar planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n\t\t.map(function(line) {\r\n\t\t\treturn SDPUtils.parseSsrcMedia(line);\r\n\t\t})\r\n\t\t.filter(function(msidParts) {\r\n\t\t\treturn msidParts.attribute === 'msid';\r\n\t\t});\r\n\t\tif (planB.length > 0) {\r\n\t\t\tparts = planB[0].value.split(' ');\r\n\t\t\treturn {stream: parts[0], track: parts[1]};\r\n\t\t}\r\n\t};\r\n\t\r\n\t// Generate a session ID for SDP.\r\n\t// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\r\n\t// recommends using a cryptographically random +ve 64-bit value\r\n\t// but right now this should be acceptable and within the right range\r\n\tSDPUtils.generateSessionId = function() {\r\n\t\treturn Math.random().toString().substr(2, 21);\r\n\t};\r\n\t\r\n\t// Write boilder plate for start of SDP\r\n\t// sessId argument is optional - if not supplied it will\r\n\t// be generated randomly\r\n\t// sessVersion is optional and defaults to 2\r\n\t// sessUser is optional and defaults to 'thisisadapterortc'\r\n\tSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\r\n\t\tvar sessionId;\r\n\t\tvar version = sessVer !== undefined ? sessVer : 2;\r\n\t\tif (sessId) {\r\n\t\t\tsessionId = sessId;\r\n\t\t} else {\r\n\t\t\tsessionId = SDPUtils.generateSessionId();\r\n\t\t}\r\n\t\tvar user = sessUser || 'thisisadapterortc';\r\n\t\t// FIXME: sess-id should be an NTP timestamp.\r\n\t\treturn 'v=0\\r\\n' +\r\n\t\t\t\t'o=' + user + ' ' + sessionId + ' ' + version +\r\n\t\t\t\t\t' IN IP4 127.0.0.1\\r\\n' +\r\n\t\t\t\t's=-\\r\\n' +\r\n\t\t\t\t't=0 0\\r\\n';\r\n\t};\r\n\t\r\n\tSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\r\n\t\tvar sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\r\n\t\r\n\t\t// Map ICE parameters (ufrag, pwd) to SDP.\r\n\t\tsdp += SDPUtils.writeIceParameters(\r\n\t\t\t\ttransceiver.iceGatherer.getLocalParameters());\r\n\t\r\n\t\t// Map DTLS parameters to SDP.\r\n\t\tsdp += SDPUtils.writeDtlsParameters(\r\n\t\t\t\ttransceiver.dtlsTransport.getLocalParameters(),\r\n\t\t\t\ttype === 'offer' ? 'actpass' : 'active');\r\n\t\r\n\t\tsdp += 'a=mid:' + transceiver.mid + '\\r\\n';\r\n\t\r\n\t\tif (transceiver.direction) {\r\n\t\t\tsdp += 'a=' + transceiver.direction + '\\r\\n';\r\n\t\t} else if (transceiver.rtpSender && transceiver.rtpReceiver) {\r\n\t\t\tsdp += 'a=sendrecv\\r\\n';\r\n\t\t} else if (transceiver.rtpSender) {\r\n\t\t\tsdp += 'a=sendonly\\r\\n';\r\n\t\t} else if (transceiver.rtpReceiver) {\r\n\t\t\tsdp += 'a=recvonly\\r\\n';\r\n\t\t} else {\r\n\t\t\tsdp += 'a=inactive\\r\\n';\r\n\t\t}\r\n\t\r\n\t\tif (transceiver.rtpSender) {\r\n\t\t\t// spec.\r\n\t\t\tvar msid = 'msid:' + stream.id + ' ' +\r\n\t\t\t\t\ttransceiver.rtpSender.track.id + '\\r\\n';\r\n\t\t\tsdp += 'a=' + msid;\r\n\t\r\n\t\t\t// for Chrome.\r\n\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\r\n\t\t\t\t\t' ' + msid;\r\n\t\t\tif (transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t\t' ' + msid;\r\n\t\t\t\tsdp += 'a=ssrc-group:FID ' +\r\n\t\t\t\t\t\ttransceiver.sendEncodingParameters[0].ssrc + ' ' +\r\n\t\t\t\t\t\ttransceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t\t'\\r\\n';\r\n\t\t\t}\r\n\t\t}\r\n\t\t// FIXME: this should be written by writeRtpDescription.\r\n\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\r\n\t\t\t\t' cname:' + SDPUtils.localCName + '\\r\\n';\r\n\t\tif (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t' cname:' + SDPUtils.localCName + '\\r\\n';\r\n\t\t}\r\n\t\treturn sdp;\r\n\t};\r\n\t\r\n\t// Gets the direction from the mediaSection or the sessionpart.\r\n\tSDPUtils.getDirection = function(mediaSection, sessionpart) {\r\n\t\t// Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\r\n\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\tfor (var i = 0; i < lines.length; i++) {\r\n\t\t\tswitch (lines[i]) {\r\n\t\t\t\tcase 'a=sendrecv':\r\n\t\t\t\tcase 'a=sendonly':\r\n\t\t\t\tcase 'a=recvonly':\r\n\t\t\t\tcase 'a=inactive':\r\n\t\t\t\t\treturn lines[i].substr(2);\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t// FIXME: What should happen here?\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sessionpart) {\r\n\t\t\treturn SDPUtils.getDirection(sessionpart);\r\n\t\t}\r\n\t\treturn 'sendrecv';\r\n\t};\r\n\t\r\n\tSDPUtils.getKind = function(mediaSection) {\r\n\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\tvar mline = lines[0].split(' ');\r\n\t\treturn mline[0].substr(2);\r\n\t};\r\n\t\r\n\tSDPUtils.isRejected = function(mediaSection) {\r\n\t\treturn mediaSection.split(' ', 2)[1] === '0';\r\n\t};\r\n\t\r\n\tSDPUtils.parseMLine = function(mediaSection) {\r\n\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\tvar parts = lines[0].substr(2).split(' ');\r\n\t\treturn {\r\n\t\t\tkind: parts[0],\r\n\t\t\tport: parseInt(parts[1], 10),\r\n\t\t\tprotocol: parts[2],\r\n\t\t\tfmt: parts.slice(3).join(' ')\r\n\t\t};\r\n\t};\r\n\t\r\n\tSDPUtils.parseOLine = function(mediaSection) {\r\n\t\tvar line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\r\n\t\tvar parts = line.substr(2).split(' ');\r\n\t\treturn {\r\n\t\t\tusername: parts[0],\r\n\t\t\tsessionId: parts[1],\r\n\t\t\tsessionVersion: parseInt(parts[2], 10),\r\n\t\t\tnetType: parts[3],\r\n\t\t\taddressType: parts[4],\r\n\t\t\taddress: parts[5]\r\n\t\t};\r\n\t};\r\n\t\r\n\t// a very naive interpretation of a valid SDP.\r\n\tSDPUtils.isValidSDP = function(blob) {\r\n\t\tif (typeof blob !== 'string' || blob.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar lines = SDPUtils.splitLines(blob);\r\n\t\tfor (var i = 0; i < lines.length; i++) {\r\n\t\t\tif (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t// TODO: check the modifier a bit more.\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\t\r\n\t// Expose public methods.\r\n\tif (typeof module === 'object') {\r\n\t\tmodule.exports = SDPUtils;\r\n\t}\r\n\t\r\n\t},{}]},{},[1])(1)\r\n\t});","(function() {\r\n  if (!navigator.mediaDevices) navigator.mediaDevices = {};\r\n  if (!navigator.mediaDevices.getUserMedia) {\r\n    var getUserMedia =\r\n      navigator.webkitGetUserMedia ||\r\n      navigator.mozGetUserMedia ||\r\n      navigator.msGetUserMedia ||\r\n      navigator.getUserMedia;\r\n\r\n    if (getUserMedia) {\r\n      navigator.mediaDevices.getUserMedia = function(constraints) {\r\n        return new Promise(function(resolve, reject) {\r\n          getUserMedia(\r\n            constraints,\r\n            function(stream) {\r\n              resolve(stream);\r\n            },\r\n            function(error) {\r\n              reject(error);\r\n            }\r\n          );\r\n        });\r\n      };\r\n    } else {\r\n      navigator.mediaDevices.getUserMedia = function() {\r\n        // A missing `getUserMedia` seemingly can mean one of two things:\r\n        //\r\n        // 1) WebRTC is unsupported or disabled on this browser\r\n        // 2) This is an insecure connection\r\n        //   * This handling of insecure connections happens only on certain browsers.\r\n        //     It was observed in Chromium 80 and Firefox 75, but not Firefox 68. I suspect it's the new behavior.\r\n        //   * In other browsers, it handles insecure connections by throwing `NotAllowedError`.\r\n        //     We still handle this case in the calling function.\r\n        //   * See: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\r\n        //     As of this writing, this claims that the browser does *both* of these things for\r\n        //     insecure connections, which is of course impossible and thus confusing.\r\n        //\r\n        // We will attempt to distinguish these two cases by checking for various webrtc-related fields on\r\n        // `window` (inspired by github.com/muaz-khan/DetectRTC). If none of those fields exist, we assume\r\n        // that WebRTC is not supported on this browser.\r\n        return new Promise(function(resolve, reject) {\r\n          if (!(window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection || window.RTCIceGatherer)) {\r\n            var e = new Error(\"getUserMedia is not supported in this browser.\");\r\n            // I'd use NotSupportedError but I'm afraid they'll change the spec on us again\r\n            e.name = 'CustomNotSupportedError';\r\n            reject(e);\r\n          } else {\r\n            var e = new Error(\"insecure connection\");\r\n            // I'd use NotAllowedError but I'm afraid they'll change the spec on us again\r\n            e.name = 'CustomSecureConnectionError';\r\n            reject(e);\r\n          }\r\n        });\r\n      };\r\n    }\r\n  }\r\n})();","(function(a){var r=a.fn.domManip,d=\"_tmplitem\",q=/^[^<]*(<[\\w\\W]+>)[^>]*$|\\{\\{\\! /,b={},f={},e,p={key:0,data:{}},h=0,c=0,l=[];function g(e,d,g,i){var c={data:i||(d?d.data:{}),_wrap:d?d._wrap:null,tmpl:null,parent:d||null,nodes:[],calls:u,nest:w,wrap:x,html:v,update:t};e&&a.extend(c,e,{nodes:[],parent:d});if(g){c.tmpl=g;c._ctnt=c._ctnt||c.tmpl(a,c);c.key=++h;(l.length?f:b)[h]=c}return c}a.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(f,d){a.fn[f]=function(n){var g=[],i=a(n),k,h,m,l,j=this.length===1&&this[0].parentNode;e=b||{};if(j&&j.nodeType===11&&j.childNodes.length===1&&i.length===1){i[d](this[0]);g=this}else{for(h=0,m=i.length;h<m;h++){c=h;k=(h>0?this.clone(true):this).get();a.fn[d].apply(a(i[h]),k);g=g.concat(k)}c=0;g=this.pushStack(g,f,i.selector)}l=e;e=null;a.tmpl.complete(l);return g}});a.fn.extend({tmpl:function(d,c,b){return a.tmpl(this[0],d,c,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(d,l,j){if(d[0]&&d[0].nodeType){var f=a.makeArray(arguments),g=d.length,i=0,h;while(i<g&&!(h=a.data(d[i++],\"tmplItem\")));if(g>1)f[0]=[a.makeArray(d)];if(h&&c)f[2]=function(b){a.tmpl.afterManip(this,b,j)};r.apply(this,f)}else r.apply(this,arguments);c=0;!e&&a.tmpl.complete(b);return this}});a.extend({tmpl:function(d,h,e,c){var j,k=!c;if(k){c=p;d=a.template[d]||a.template(null,d);f={}}else if(!d){d=c.tmpl;b[c.key]=c;c.nodes=[];c.wrapped&&n(c,c.wrapped);return a(i(c,null,c.tmpl(a,c)))}if(!d)return[];if(typeof h===\"function\")h=h.call(c||{});e&&e.wrapped&&n(e,e.wrapped);j=a.isArray(h)?a.map(h,function(a){return a?g(e,c,d,a):null}):[g(e,c,d,h)];return k?a(i(c,null,j)):j},tmplItem:function(b){var c;if(b instanceof a)b=b[0];while(b&&b.nodeType===1&&!(c=a.data(b,\"tmplItem\"))&&(b=b.parentNode));return c||p},template:function(c,b){if(b){if(typeof b===\"string\")b=o(b);else if(b instanceof a)b=b[0]||{};if(b.nodeType)b=a.data(b,\"tmpl\")||a.data(b,\"tmpl\",o(b.innerHTML));return typeof c===\"string\"?(a.template[c]=b):b}return c?typeof c!==\"string\"?a.template(null,c):a.template[c]||a.template(null,q.test(c)?c:a(c)):null},encode:function(a){return(\"\"+a).split(\"<\").join(\"&lt;\").split(\">\").join(\"&gt;\").split('\"').join(\"&#34;\").split(\"'\").join(\"&#39;\")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:\"null\"},open:\"if($notnull_1){_=_.concat($item.nest($1,$2));}\"},wrap:{_default:{$2:\"null\"},open:\"$item.calls(_,$1,$2);_=[];\",close:\"call=$item.calls();_=call._.concat($item.wrap(call,_));\"},each:{_default:{$2:\"$index, $value\"},open:\"if($notnull_1){$.each($1a,function($2){with(this){\",close:\"}});}\"},\"if\":{open:\"if(($notnull_1) && $1a){\",close:\"}\"},\"else\":{_default:{$1:\"true\"},open:\"}else if(($notnull_1) && $1a){\"},html:{open:\"if($notnull_1){_.push($1a);}\"},\"=\":{_default:{$1:\"$data\"},open:\"if($notnull_1){_.push($.encode($1a));}\"},\"!\":{open:\"\"}},complete:function(){b={}},afterManip:function(f,b,d){var e=b.nodeType===11?a.makeArray(b.childNodes):b.nodeType===1?[b]:[];d.call(f,b);m(e);c++}});function i(e,g,f){var b,c=f?a.map(f,function(a){return typeof a===\"string\"?e.key?a.replace(/(<\\w+)(?=[\\s>])(?![^>]*_tmplitem)([^>]*)/g,\"$1 \"+d+'=\"'+e.key+'\" $2'):a:i(a,e,a._ctnt)}):e;if(g)return c;c=c.join(\"\");c.replace(/^\\s*([^<\\s][^<]*)?(<[\\w\\W]+>)([^>]*[^>\\s])?\\s*$/,function(f,c,e,d){b=a(e).get();m(b);if(c)b=j(c).concat(b);if(d)b=b.concat(j(d))});return b?b:j(c)}function j(c){var b=document.createElement(\"div\");b.innerHTML=c;return a.makeArray(b.childNodes)}function o(b){return new Function(\"jQuery\",\"$item\",\"var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('\"+a.trim(b).replace(/([\\\\'])/g,\"\\\\$1\").replace(/[\\r\\t\\n]/g,\" \").replace(/\\$\\{([^\\}]*)\\}/g,\"{{= $1}}\").replace(/\\{\\{(\\/?)(\\w+|.)(?:\\(((?:[^\\}]|\\}(?!\\}))*?)?\\))?(?:\\s+(.*?)?)?(\\(((?:[^\\}]|\\}(?!\\}))*?)\\))?\\s*\\}\\}/g,function(m,l,j,d,b,c,e){var i=a.tmpl.tag[j],h,f,g;if(!i)throw\"Template command not found: \"+j;h=i._default||[];if(c&&!/\\w$/.test(b)){b+=c;c=\"\"}if(b){b=k(b);e=e?\",\"+k(e)+\")\":c?\")\":\"\";f=c?b.indexOf(\".\")>-1?b+c:\"(\"+b+\").call($item\"+e:b;g=c?f:\"(typeof(\"+b+\")==='function'?(\"+b+\").call($item):(\"+b+\"))\"}else g=f=h.$1||\"null\";d=k(d);return\"');\"+i[l?\"close\":\"open\"].split(\"$notnull_1\").join(b?\"typeof(\"+b+\")!=='undefined' && (\"+b+\")!=null\":\"true\").split(\"$1a\").join(g).split(\"$1\").join(f).split(\"$2\").join(d?d.replace(/\\s*([^\\(]+)\\s*(\\((.*?)\\))?/g,function(d,c,b,a){a=a?\",\"+a+\")\":b?\")\":\"\";return a?\"(\"+c+\").call($item\"+a:d}):h.$2||\"\")+\"_.push('\"})+\"');}return _;\")}function n(c,b){c._wrap=i(c,true,a.isArray(b)?b:[q.test(b)?b:a(b).html()]).join(\"\")}function k(a){return a?a.replace(/\\\\'/g,\"'\").replace(/\\\\\\\\/g,\"\\\\\"):null}function s(b){var a=document.createElement(\"div\");a.appendChild(b.cloneNode(true));return a.innerHTML}function m(o){var n=\"_\"+c,k,j,l={},e,p,i;for(e=0,p=o.length;e<p;e++){if((k=o[e]).nodeType!==1)continue;j=k.getElementsByTagName(\"*\");for(i=j.length-1;i>=0;i--)m(j[i]);m(k)}function m(j){var p,i=j,k,e,m;if(m=j.getAttribute(d)){while(i.parentNode&&(i=i.parentNode).nodeType===1&&!(p=i.getAttribute(d)));if(p!==m){i=i.parentNode?i.nodeType===11?0:i.getAttribute(d)||0:0;if(!(e=b[m])){e=f[m];e=g(e,b[i]||f[i],null,true);e.key=++h;b[h]=e}c&&o(m)}j.removeAttribute(d)}else if(c&&(e=a.data(j,\"tmplItem\"))){o(e.key);b[e.key]=e;i=a.data(j.parentNode,\"tmplItem\");i=i?i.key:0}if(e){k=e;while(k&&k.key!=i){k.nodes.push(j);k=k.parent}delete e._ctnt;delete e._wrap;a.data(j,\"tmplItem\",e)}function o(a){a=a+n;e=l[a]=l[a]||g(e,b[e.parent.key+n]||e.parent,null,true)}}}function u(a,d,c,b){if(!a)return l.pop();l.push({_:a,tmpl:d,item:this,data:c,options:b})}function w(d,c,b){return a.tmpl(a.template(d),c,b,this)}function x(b,d){var c=b.options||{};c.wrapped=d;return a.tmpl(a.template(b.tmpl),b.data,c,b.item)}function v(d,c){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(\"\"):b).filter(d||\"*\"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function t(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}})(jQuery)","'use strict';\r\n\r\n// Last time updated: 2019-02-20 3:31:30 PM UTC\r\n\r\n// _______________\r\n// getStats v1.2.0\r\n\r\n// Open-Sourced: https://github.com/muaz-khan/getStats\r\n\r\n// --------------------------------------------------\r\n// Muaz Khan     - www.MuazKhan.com\r\n// MIT License   - www.WebRTC-Experiment.com/licence\r\n// --------------------------------------------------\r\n\r\n\"use strict\";var getStats=function(mediaStreamTrack,callback,interval){function getStatsLooper(){getStatsWrapper(function(results){if(results&&results.forEach){results.forEach(function(result){Object.keys(getStatsParser).forEach(function(key){if(\"function\"==typeof getStatsParser[key])try{getStatsParser[key](result)}catch(e){console.error(e.message,e.stack,e)}})});try{peer.iceConnectionState.search(/failed|closed|disconnected/gi)!==-1&&(nomore=!0)}catch(e){nomore=!0}nomore===!0&&(getStatsResult.datachannel&&(getStatsResult.datachannel.state=\"close\"),getStatsResult.ended=!0),getStatsResult.results=results,getStatsResult.audio&&getStatsResult.video&&(getStatsResult.bandwidth.speed=getStatsResult.audio.bytesSent-getStatsResult.bandwidth.helper.audioBytesSent+(getStatsResult.video.bytesSent-getStatsResult.bandwidth.helper.videoBytesSent),getStatsResult.bandwidth.helper.audioBytesSent=getStatsResult.audio.bytesSent,getStatsResult.bandwidth.helper.videoBytesSent=getStatsResult.video.bytesSent),callback(getStatsResult),nomore||void 0!=typeof interval&&interval&&setTimeout(getStatsLooper,interval||1e3)}})}function getStatsWrapper(cb){\"undefined\"!=typeof window.InstallTrigger||isSafari?peer.getStats(window.mediaStreamTrack||null).then(function(res){var items=[];res.forEach(function(r){items.push(r)}),cb(items)})[\"catch\"](cb):peer.getStats(function(res){var items=[];res.result().forEach(function(res){var item={};res.names().forEach(function(name){item[name]=res.stat(name)}),item.id=res.id,item.type=res.type,item.timestamp=res.timestamp,items.push(item)}),cb(items)})}var browserFakeUserAgent=\"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45\";!function(that){that&&\"undefined\"==typeof window&&\"undefined\"!=typeof global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},global.console||(global.console={}),\"undefined\"!=typeof global.console.log&&\"undefined\"!=typeof global.console.error||(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),\"undefined\"==typeof document&&(that.document={documentElement:{appendChild:function(){return\"\"}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var obj={getContext:function(){return obj},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return\"\"}};return obj},that.HTMLVideoElement=function(){}),\"undefined\"==typeof location&&(that.location={protocol:\"file:\",href:\"\",hash:\"\"}),\"undefined\"==typeof screen&&(that.screen={width:0,height:0}),\"undefined\"==typeof URL&&(that.URL={createObjectURL:function(){return\"\"},revokeObjectURL:function(){return\"\"}}),\"undefined\"==typeof MediaStreamTrack&&(that.MediaStreamTrack=function(){}),\"undefined\"==typeof RTCPeerConnection&&(that.RTCPeerConnection=function(){}),that.window=global)}(\"undefined\"!=typeof global?global:null);var RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;\"undefined\"==typeof MediaStreamTrack&&(MediaStreamTrack={});var systemNetworkType=((navigator.connection||{}).type||\"unknown\").toString().toLowerCase(),getStatsResult={encryption:\"sha-256\",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{audioBytesSent:0,videoBytestSent:0},speed:0},results:{},connectionType:{systemNetworkType:systemNetworkType,systemIpAddress:\"192.168.1.2\",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(){nomore=!0}},getStatsParser={checkIfOfferer:function(result){\"googLibjingleSession\"===result.type&&(getStatsResult.isOfferer=result.googInitiator)}},isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),peer=this;if(!(arguments[0]instanceof RTCPeerConnection))throw\"1st argument is not instance of RTCPeerConnection.\";peer=arguments[0],arguments[1]instanceof MediaStreamTrack&&(mediaStreamTrack=arguments[1],callback=arguments[2],interval=arguments[3]);var nomore=!1;getStatsParser.datachannel=function(result){\"datachannel\"===result.type&&(getStatsResult.datachannel={state:result.state})},getStatsParser.googCertificate=function(result){\"googCertificate\"==result.type&&(getStatsResult.encryption=result.googFingerprintAlgorithm),\"certificate\"==result.type&&(getStatsResult.encryption=result.fingerprintAlgorithm)},getStatsParser.checkAudioTracks=function(result){if(\"audio\"===result.mediaType){var sendrecvType=result.id.split(\"_\").pop();if(result.isRemote===!0&&(sendrecvType=\"recv\"),result.isRemote===!1&&(sendrecvType=\"send\"),sendrecvType){if(getStatsResult.audio[sendrecvType].codecs.indexOf(result.googCodecName||\"opus\")===-1&&getStatsResult.audio[sendrecvType].codecs.push(result.googCodecName||\"opus\"),result.bytesSent){var kilobytes=0;getStatsResult.internal.audio[sendrecvType].prevBytesSent||(getStatsResult.internal.audio[sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal.audio[sendrecvType].prevBytesSent;getStatsResult.internal.audio[sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult.audio[sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult.audio.bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal.audio[sendrecvType].prevBytesReceived||(getStatsResult.internal.audio[sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal.audio[sendrecvType].prevBytesReceived;getStatsResult.internal.audio[sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult.audio.bytesReceived=kilobytes.toFixed(1)}if(result.googTrackId&&getStatsResult.audio[sendrecvType].tracks.indexOf(result.googTrackId)===-1&&getStatsResult.audio[sendrecvType].tracks.push(result.googTrackId),result.googCurrentDelayMs){var kilobytes=0;getStatsResult.internal.audio.prevGoogCurrentDelayMs||(getStatsResult.internal.audio.prevGoogCurrentDelayMs=result.googCurrentDelayMs);var bytes=result.googCurrentDelayMs-getStatsResult.internal.audio.prevGoogCurrentDelayMs;getStatsResult.internal.audio.prevGoogCurrentDelayMs=result.googCurrentDelayMs,getStatsResult.audio.latency=bytes.toFixed(1),getStatsResult.audio.latency<0&&(getStatsResult.audio.latency=0)}if(result.packetsLost){var kilobytes=0;getStatsResult.internal.audio.prevPacketsLost||(getStatsResult.internal.audio.prevPacketsLost=result.packetsLost);var bytes=result.packetsLost-getStatsResult.internal.audio.prevPacketsLost;getStatsResult.internal.audio.prevPacketsLost=result.packetsLost,getStatsResult.audio.packetsLost=bytes.toFixed(1),getStatsResult.audio.packetsLost<0&&(getStatsResult.audio.packetsLost=0)}}}},getStatsParser.checkVideoTracks=function(result){if(\"video\"===result.mediaType){var sendrecvType=result.id.split(\"_\").pop();if(result.isRemote===!0&&(sendrecvType=\"recv\"),result.isRemote===!1&&(sendrecvType=\"send\"),sendrecvType){if(getStatsResult.video[sendrecvType].codecs.indexOf(result.googCodecName||\"VP8\")===-1&&getStatsResult.video[sendrecvType].codecs.push(result.googCodecName||\"VP8\"),result.bytesSent){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesSent||(getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevBytesSent;getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult.video.bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesReceived||(getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal.video[sendrecvType].prevBytesReceived;getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult.video.bytesReceived=kilobytes.toFixed(1)}if(result.googFrameHeightReceived&&result.googFrameWidthReceived&&(getStatsResult.resolutions[sendrecvType].width=result.googFrameWidthReceived,getStatsResult.resolutions[sendrecvType].height=result.googFrameHeightReceived),result.googFrameHeightSent&&result.googFrameWidthSent&&(getStatsResult.resolutions[sendrecvType].width=result.googFrameWidthSent,getStatsResult.resolutions[sendrecvType].height=result.googFrameHeightSent),result.googTrackId&&getStatsResult.video[sendrecvType].tracks.indexOf(result.googTrackId)===-1&&getStatsResult.video[sendrecvType].tracks.push(result.googTrackId),result.framerateMean){getStatsResult.bandwidth.framerateMean=result.framerateMean;var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevFramerateMean||(getStatsResult.internal.video[sendrecvType].prevFramerateMean=result.bitrateMean);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevFramerateMean;getStatsResult.internal.video[sendrecvType].prevFramerateMean=result.framerateMean,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].framerateMean=bytes.toFixed(1)}if(result.bitrateMean){getStatsResult.bandwidth.bitrateMean=result.bitrateMean;var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBitrateMean||(getStatsResult.internal.video[sendrecvType].prevBitrateMean=result.bitrateMean);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevBitrateMean;getStatsResult.internal.video[sendrecvType].prevBitrateMean=result.bitrateMean,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].bitrateMean=bytes.toFixed(1)}if(result.googCurrentDelayMs){var kilobytes=0;getStatsResult.internal.video.prevGoogCurrentDelayMs||(getStatsResult.internal.video.prevGoogCurrentDelayMs=result.googCurrentDelayMs);var bytes=result.googCurrentDelayMs-getStatsResult.internal.video.prevGoogCurrentDelayMs;getStatsResult.internal.video.prevGoogCurrentDelayMs=result.googCurrentDelayMs,getStatsResult.video.latency=bytes.toFixed(1),getStatsResult.video.latency<0&&(getStatsResult.video.latency=0)}if(result.packetsLost){var kilobytes=0;getStatsResult.internal.video.prevPacketsLost||(getStatsResult.internal.video.prevPacketsLost=result.packetsLost);var bytes=result.packetsLost-getStatsResult.internal.video.prevPacketsLost;getStatsResult.internal.video.prevPacketsLost=result.packetsLost,getStatsResult.video.packetsLost=bytes.toFixed(1),getStatsResult.video.packetsLost<0&&(getStatsResult.video.packetsLost=0)}}}},getStatsParser.bweforvideo=function(result){\"VideoBwe\"===result.type&&(getStatsResult.bandwidth.availableSendBandwidth=result.googAvailableSendBandwidth,getStatsResult.bandwidth.googActualEncBitrate=result.googActualEncBitrate,getStatsResult.bandwidth.googAvailableSendBandwidth=result.googAvailableSendBandwidth,getStatsResult.bandwidth.googAvailableReceiveBandwidth=result.googAvailableReceiveBandwidth,getStatsResult.bandwidth.googRetransmitBitrate=result.googRetransmitBitrate,getStatsResult.bandwidth.googTargetEncBitrate=result.googTargetEncBitrate,getStatsResult.bandwidth.googBucketDelay=result.googBucketDelay,getStatsResult.bandwidth.googTransmitBitrate=result.googTransmitBitrate)},getStatsParser.candidatePair=function(result){if(\"googCandidatePair\"===result.type||\"candidate-pair\"===result.type||\"local-candidate\"===result.type||\"remote-candidate\"===result.type){if(\"true\"==result.googActiveConnection){Object.keys(getStatsResult.internal.candidates).forEach(function(cid){var candidate=getStatsResult.internal.candidates[cid];candidate.ipAddress.indexOf(result.googLocalAddress)!==-1&&(getStatsResult.connectionType.local.candidateType=candidate.candidateType,getStatsResult.connectionType.local.ipAddress=candidate.ipAddress,getStatsResult.connectionType.local.networkType=candidate.networkType,getStatsResult.connectionType.local.transport=candidate.transport),candidate.ipAddress.indexOf(result.googRemoteAddress)!==-1&&(getStatsResult.connectionType.remote.candidateType=candidate.candidateType,getStatsResult.connectionType.remote.ipAddress=candidate.ipAddress,getStatsResult.connectionType.remote.networkType=candidate.networkType,getStatsResult.connectionType.remote.transport=candidate.transport)}),getStatsResult.connectionType.transport=result.googTransportType;var localCandidate=getStatsResult.internal.candidates[result.localCandidateId];localCandidate&&localCandidate.ipAddress&&(getStatsResult.connectionType.systemIpAddress=localCandidate.ipAddress);var remoteCandidate=getStatsResult.internal.candidates[result.remoteCandidateId];remoteCandidate&&remoteCandidate.ipAddress&&(getStatsResult.connectionType.systemIpAddress=remoteCandidate.ipAddress)}if(\"candidate-pair\"===result.type&&result.selected===!0&&result.nominated===!0&&\"succeeded\"===result.state)var localCandidate=getStatsResult.internal.candidates[result.remoteCandidateId],remoteCandidate=getStatsResult.internal.candidates[result.remoteCandidateId];if(\"local-candidate\"===result.type&&(getStatsResult.connectionType.local.candidateType=result.candidateType,getStatsResult.connectionType.local.ipAddress=result.ipAddress,getStatsResult.connectionType.local.networkType=result.networkType,getStatsResult.connectionType.local.transport=result.mozLocalTransport||result.transport),\"remote-candidate\"===result.type&&(getStatsResult.connectionType.remote.candidateType=result.candidateType,getStatsResult.connectionType.remote.ipAddress=result.ipAddress,getStatsResult.connectionType.remote.networkType=result.networkType,getStatsResult.connectionType.remote.transport=result.mozRemoteTransport||result.transport),isSafari){var sendrecvType=result.localCandidateId?\"send\":\"recv\";if(!sendrecvType)return;if(result.bytesSent){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesSent||(getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevBytesSent;getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult.video.bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesReceived||(getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal.video[sendrecvType].prevBytesReceived;getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult.video.bytesReceived=kilobytes.toFixed(1)}if(result.availableOutgoingBitrate){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate||(getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate=result.availableOutgoingBitrate);var bytes=result.availableOutgoingBitrate-getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate;getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate=result.availableOutgoingBitrate,kilobytes=bytes/1024,getStatsResult.video.availableOutgoingBitrate=kilobytes.toFixed(1)}if(result.availableIncomingBitrate){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate||(getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate=result.availableIncomingBitrate);var bytes=result.availableIncomingBitrate-getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate;getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate=result.availableIncomingBitrate,kilobytes=bytes/1024,getStatsResult.video.availableIncomingBitrate=kilobytes.toFixed(1)}}}};var LOCAL_candidateType={},LOCAL_transport={},LOCAL_ipAddress={},LOCAL_networkType={};getStatsParser.localcandidate=function(result){\"localcandidate\"!==result.type&&\"local-candidate\"!==result.type||result.id&&(LOCAL_candidateType[result.id]||(LOCAL_candidateType[result.id]=[]),LOCAL_transport[result.id]||(LOCAL_transport[result.id]=[]),LOCAL_ipAddress[result.id]||(LOCAL_ipAddress[result.id]=[]),LOCAL_networkType[result.id]||(LOCAL_networkType[result.id]=[]),result.candidateType&&LOCAL_candidateType[result.id].indexOf(result.candidateType)===-1&&LOCAL_candidateType[result.id].push(result.candidateType),result.transport&&LOCAL_transport[result.id].indexOf(result.transport)===-1&&LOCAL_transport[result.id].push(result.transport),result.ipAddress&&LOCAL_ipAddress[result.id].indexOf(result.ipAddress+\":\"+result.portNumber)===-1&&LOCAL_ipAddress[result.id].push(result.ipAddress+\":\"+result.portNumber),result.networkType&&LOCAL_networkType[result.id].indexOf(result.networkType)===-1&&LOCAL_networkType[result.id].push(result.networkType),getStatsResult.internal.candidates[result.id]={candidateType:LOCAL_candidateType[result.id],ipAddress:LOCAL_ipAddress[result.id],portNumber:result.portNumber,networkType:LOCAL_networkType[result.id],priority:result.priority,transport:LOCAL_transport[result.id],timestamp:result.timestamp,id:result.id,type:result.type},getStatsResult.connectionType.local.candidateType=LOCAL_candidateType[result.id],getStatsResult.connectionType.local.ipAddress=LOCAL_ipAddress[result.id],getStatsResult.connectionType.local.networkType=LOCAL_networkType[result.id],getStatsResult.connectionType.local.transport=LOCAL_transport[result.id])};var REMOTE_candidateType={},REMOTE_transport={},REMOTE_ipAddress={},REMOTE_networkType={};getStatsParser.remotecandidate=function(result){\"remotecandidate\"!==result.type&&\"remote-candidate\"!==result.type||result.id&&(REMOTE_candidateType[result.id]||(REMOTE_candidateType[result.id]=[]),REMOTE_transport[result.id]||(REMOTE_transport[result.id]=[]),REMOTE_ipAddress[result.id]||(REMOTE_ipAddress[result.id]=[]),REMOTE_networkType[result.id]||(REMOTE_networkType[result.id]=[]),result.candidateType&&REMOTE_candidateType[result.id].indexOf(result.candidateType)===-1&&REMOTE_candidateType[result.id].push(result.candidateType),result.transport&&REMOTE_transport[result.id].indexOf(result.transport)===-1&&REMOTE_transport[result.id].push(result.transport),result.ipAddress&&REMOTE_ipAddress[result.id].indexOf(result.ipAddress+\":\"+result.portNumber)===-1&&REMOTE_ipAddress[result.id].push(result.ipAddress+\":\"+result.portNumber),result.networkType&&REMOTE_networkType[result.id].indexOf(result.networkType)===-1&&REMOTE_networkType[result.id].push(result.networkType),getStatsResult.internal.candidates[result.id]={candidateType:REMOTE_candidateType[result.id],ipAddress:REMOTE_ipAddress[result.id],portNumber:result.portNumber,networkType:REMOTE_networkType[result.id],priority:result.priority,transport:REMOTE_transport[result.id],timestamp:result.timestamp,id:result.id,type:result.type},getStatsResult.connectionType.remote.candidateType=REMOTE_candidateType[result.id],getStatsResult.connectionType.remote.ipAddress=REMOTE_ipAddress[result.id],getStatsResult.connectionType.remote.networkType=REMOTE_networkType[result.id],getStatsResult.connectionType.remote.transport=REMOTE_transport[result.id])},getStatsParser.dataSentReceived=function(result){!result.googCodecName||\"video\"!==result.mediaType&&\"audio\"!==result.mediaType||(result.bytesSent&&(getStatsResult[result.mediaType].bytesSent=parseInt(result.bytesSent)),result.bytesReceived&&(getStatsResult[result.mediaType].bytesReceived=parseInt(result.bytesReceived)))},getStatsParser.inboundrtp=function(result){if(isSafari&&\"inbound-rtp\"===result.type){var mediaType=result.mediaType||\"audio\",sendrecvType=result.isRemote?\"recv\":\"send\";if(sendrecvType){if(result.bytesSent){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent||(getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal[mediaType][sendrecvType].prevBytesSent;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult[mediaType][sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult[mediaType].bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived||(getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult[mediaType].bytesReceived=kilobytes.toFixed(1)}}}},getStatsParser.outboundrtp=function(result){if(isSafari&&\"outbound-rtp\"===result.type){var mediaType=result.mediaType||\"audio\",sendrecvType=result.isRemote?\"recv\":\"send\";if(sendrecvType){if(result.bytesSent){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent||(getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal[mediaType][sendrecvType].prevBytesSent;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult[mediaType][sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult[mediaType].bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived||(getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult[mediaType].bytesReceived=kilobytes.toFixed(1)}}}},getStatsParser.track=function(result){if(isSafari&&\"track\"===result.type){var sendrecvType=result.remoteSource===!0?\"send\":\"recv\";result.frameWidth&&result.frameHeight&&(getStatsResult.resolutions[sendrecvType].width=result.frameWidth,getStatsResult.resolutions[sendrecvType].height=result.frameHeight)}};var SSRC={audio:{send:[],recv:[]},video:{send:[],recv:[]}};getStatsParser.ssrc=function(result){if(result.googCodecName&&(\"video\"===result.mediaType||\"audio\"===result.mediaType)&&\"ssrc\"===result.type){var sendrecvType=result.id.split(\"_\").pop();SSRC[result.mediaType][sendrecvType].indexOf(result.ssrc)===-1&&SSRC[result.mediaType][sendrecvType].push(result.ssrc),getStatsResult[result.mediaType][sendrecvType].streams=SSRC[result.mediaType][sendrecvType].length}},getStatsLooper()};\"undefined\"!=typeof module&&(module.exports=getStats),\"function\"==typeof define&&define.amd&&define(\"getStats\",[],function(){return getStats});","'use strict';\r\n\r\nvar share = (function share() {\r\n\r\n\tvar avatarUrl = '../static/plugins/ep_profile_modal/static/img/user.png';\r\n\r\n\tvar getUserId = function getUserId() {\r\n\t\treturn clientVars.userId || window.pad.getUserId();\r\n\t}\r\n\r\n\tfunction stopStreaming(stream) {\r\n\t\tif (stream) {\r\n\t\t\tstream.getTracks().forEach(function stopStream(track) {\r\n\t\t\t\ttrack.stop();\r\n\t\t\t\tstream.removeTrack(track);\r\n\t\t\t});\r\n\t\t\tstream = null;\r\n\t\t}\r\n\t}\r\n\r\n\tvar scrollDownToLastChatText = function scrollDownToLastChatText(selector) {\r\n\t\tvar $element = $(selector);\r\n\t\tif ($element.length <= 0 || !$element[0]) return true;\r\n\t\t$element.animate({ scrollTop: $element[0].scrollHeight }, { duration: 400, queue: false });\r\n\t};\r\n\r\n\tvar getUserFromId = function getUserFromId(userId) {\r\n\t\tif (!window.pad || !window.pad.collabClient) return null;\r\n\t\tvar result = window.pad.collabClient.getConnectedUsers().filter(function getUser(user) {\r\n\t\t\treturn user.userId === userId;\r\n\t\t});\r\n\t\tvar user = result.length > 0 ? result[0] : null;\r\n\t\treturn user;\r\n\t};\r\n\r\n\tvar slugify = function slugify(text) {\r\n\t\treturn text.toString().toLowerCase().trim().replace(/\\s+/g, '-') // Replace spaces with -\r\n\t\t.replace(/&/g, '-and-') // Replace & with 'and'\r\n\t\t.replace(/[^\\w\\-]+/g, '') // Remove all non-word chars\r\n\t\t.replace(/\\--+/g, '-') // Replace multiple - with single -\r\n\t\t.replace(/^-+/, '') // Trim - from start of text\r\n\t\t.replace(/-+$/, ''); // Trim - from end of text\r\n\t};\r\n\r\n\tvar $body_ace_outer = function $body_ace_outer() {\r\n\t\treturn $(document).find('iframe[name=\"ace_outer\"]').contents();\r\n\t};\r\n\r\n\tvar createShareLink = function createShareLink(headingTagId, headerText) {\r\n\t\treturn window.location.origin + window.location.pathname + '?header=' + slugify(headerText) + '&headerId=' + headingTagId + '&joinvideo=true';\r\n\t};\r\n\r\n\tfunction addTextChatMessage(msg) {\r\n\t\tvar authorClass = 'author-' + msg.userId.replace(/[^a-y0-9]/g, function replace(c) {\r\n\t\t\tif (c === '.') return '-';\r\n\t\t\treturn 'z' + c.charCodeAt(0) + 'z';\r\n\t\t});\r\n\r\n\t\t// create the time string\r\n\t\tvar minutes = '' + new Date(msg.time).getMinutes();\r\n\t\tvar hours = '' + new Date(msg.time).getHours();\r\n\t\tif (minutes.length === 1) minutes = '0' + minutes;\r\n\t\tif (hours.length === 1) hours = '0' + hours;\r\n\t\tvar timeStr = hours + ':' + minutes;\r\n\r\n\t\tvar html = \"<p data-target='\" + msg.target + \"' data-id='\" + msg.headerId + \"' data-authorId='\" + msg.userId + \"' class='wrtc_text \" + msg.headId + ' ' + authorClass + \"'><b>\" + msg.userName + \"</b><span class='time \" + authorClass + \"'>\" + timeStr + '</span> ' + msg.text + '</p>';\r\n\r\n\t\t$(document).find('#chatbox #chattext').append(html);\r\n\t\tscrollDownToLastChatText('#chatbox #chattext');\r\n\t}\r\n\r\n\tvar notifyNewUserJoined = function notifyNewUserJoined(target, msg, action) {\r\n\t\tvar videoIcon = '<span class=\"videoIcon\"><svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"video\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\" class=\"svg-inline--fa fa-video fa-w-18 fa-2x\"><path fill=\"currentColor\" d=\"M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z\" class=\"\"></path></svg></span>';\r\n\t\tvar textIcon = '<span class=\"textIcon\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\"><path fill=\"currentColor\" d=\"M416 224V64c0-35.3-28.7-64-64-64H64C28.7 0 0 28.7 0 64v160c0 35.3 28.7 64 64 64v54.2c0 8 9.1 12.6 15.5 7.8l82.8-62.1H352c35.3.1 64-28.6 64-63.9zm96-64h-64v64c0 52.9-43.1 96-96 96H192v64c0 35.3 28.7 64 64 64h125.7l82.8 62.1c6.4 4.8 15.5.2 15.5-7.8V448h32c35.3 0 64-28.7 64-64V224c0-35.3-28.7-64-64-64z\"></path></svg></span>';\r\n\t\tvar btnJoin = \"<span class='wrtc_roomLink' data-join='\" + target + \"' data-action='JOIN' data-id='\" + msg.headerId + \"' title='Join'>\" + msg.headerTitle + '</span>';\r\n\r\n\t\tvar text = action === 'JOIN' ? 'joins' : 'leaves';\r\n\r\n\t\tif (target === 'VIDEO') {\r\n\t\t\tvar roomCounter = \"<span class='userCount'>(\" + msg.userCount + '/' + msg.VIDEOCHATLIMIT + ')</span>';\r\n\t\t\tmsg.text = '<span>' + text + '</span>' + videoIcon + btnJoin + roomCounter;\r\n\t\t} else if (target === 'TEXT') {\r\n\t\t\tmsg.text = '<span>' + text + '</span>' + textIcon + btnJoin;\r\n\t\t}\r\n\r\n\t\tmsg.target = target;\r\n\r\n\t\taddTextChatMessage(msg);\r\n\t};\r\n\r\n\tvar roomBoxIconActive = function roomBoxIconActive() {\r\n\t\t$body_ace_outer().find('.wbrtc_roomBox').each(function (index, val) {\r\n\t\t\tvar textActive = $(val).attr('data-text');\r\n\t\t\tvar videoActive = $(val).attr('data-video');\r\n\t\t\tif (textActive || videoActive) {\r\n\t\t\t\t$(val).find('.btn_joinChat_chatRoom').addClass('active');\r\n\t\t\t} else {\r\n\t\t\t\t$(val).find('.btn_joinChat_chatRoom').removeClass('active');\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tvar appendUserList = function appendUserList(roomInfo, selector) {\r\n\t\tif (!roomInfo.list) return true;\r\n\t\tvar $element = typeof selector === 'string' ? $(document).find(selector) : selector;\r\n\t\t$element.empty();\r\n\t\troomInfo.list.forEach(function reOrderUserList(el) {\r\n\t\t\tvar userInList = getUserFromId(el.userId) || { colorId: '', name: 'anonymous', userId: '0000000' };\r\n\t\t\tif (clientVars.ep_profile_list && clientVars.ep_profile_list[el.userId]) {\r\n\t\t\t\tavatarUrl = clientVars.ep_profile_list[el.userId].imageUrl || clientVars.ep_profile_list[el.userId].img;\r\n\t\t\t}\r\n\t\t\t$element.append('<li data-id=' + el.userId + \" style='border-color: \" + userInList.colorId + \"'><div class='avatar'><img src='\" + avatarUrl + \"'></div>\" + userInList.name + '</li>');\r\n\t\t});\r\n\t};\r\n\r\n\tvar wrtcStore = {\r\n\t\tcomponents: {\r\n\t\t\ttext: {active: false},\r\n\t\t\tvideo: {active: false},\r\n\t\t\troom: {active: false}\r\n\t\t}\r\n\t};\r\n\r\n\tvar wrtcPubsub = {\r\n\t\tevents: {},\r\n\t\ton: function on(eventName, fn) {\r\n\t\t\tthis.events[eventName] = this.events[eventName] || [];\r\n\t\t\tthis.events[eventName].push(fn);\r\n\t\t},\r\n\t\toff: function off(eventName, fn) {\r\n\t\t\tif (this.events[eventName]) {\r\n\t\t\t\tfor (var i = 0; i < this.events[eventName].length; i++) {\r\n\t\t\t\t\tif (this.events[eventName][i] === fn) {\r\n\t\t\t\t\t\tthis.events[eventName].splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\temit: function emit(eventName) {\r\n\t\t\tfor (var _len = arguments.length, data = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\r\n\t\t\t\tdata[_key - 1] = arguments[_key];\r\n\t\t\t}\r\n\r\n\t\t\tif (this.events[eventName]) {\r\n\t\t\t\tthis.events[eventName].forEach(function (fn) {\r\n\t\t\t\t\tfn.apply(undefined, data);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar inlineAvatar = {\r\n\t\tROOM: function ROOM(headerId, room) {\r\n\t\t\tvar inlineAvatarLimit = clientVars.webrtc.inlineAvatarLimit || 4;\r\n\t\t\tvar $element = $body_ace_outer().find('#wbrtc_avatarCol .' + headerId + ' .wrtc_inlineAvatars');\r\n\t\t\t$element.find('.avatar').remove();\r\n\t\t\t$element.parent().css({ left: WRTC_Room.getHeaderRoomX($element.parent()) + 'px' });\r\n\t\t\tObject.keys(room).forEach(function reOrderUserList(key, index) {\r\n\t\t\t\tvar userInList = getUserFromId(room[key].userId) || { colorId: '', name: 'anonymous'};\r\n\t\t\t\tif(userInList.userId){\r\n\t\t\t\t\t// TODO: If the user is not found, we hangup the user.\r\n\t\t\t\t\tif (clientVars.ep_profile_list && clientVars.ep_profile_list[userInList.userId]) {\r\n\t\t\t\t\t\tavatarUrl = clientVars.ep_profile_list[userInList.userId].imageUrl || clientVars.ep_profile_list[userInList.userId].img;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (index < inlineAvatarLimit) {\r\n\t\t\t\t\t\t$element.find('.avatarMore').hide();\r\n\t\t\t\t\t\t$element.append('<div class=\"avatar\" data-id=\"' + userInList.userId + '\"><img src=\"' + avatarUrl + '\"></div>');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$element.find('.avatarMore').show().text('+' + (index + 1 - inlineAvatarLimit));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tTEXT: function TEXT(headerId, room) {\r\n\t\t\tvar $element = $(document).find('#wrtc_textChatWrapper .wrtc_inlineAvatars');\r\n\t\t\t$element.find('.avatar').remove();\r\n\t\t\tthis.append(room.list, $element);\r\n\t\t},\r\n\t\tVIDEO: function VIDEO(headerId, room) {\r\n\t\t\tvar $element = $(document).find('#werc_toolbar .wrtc_inlineAvatars');\r\n\t\t\t$element.find('.avatar').remove();\r\n\t\t\tthis.append(room.list, $element);\r\n\t\t},\r\n\t\tappend: function appendAvatart(list, $element) {\r\n\t\t\tvar inlineAvatarLimit = clientVars.webrtc.inlineAvatarLimit || 4;\r\n\t\t\tlist.forEach(function reOrderUserList(el, index) {\r\n\t\t\t\tvar userInList = getUserFromId(el.userId) || { colorId: '', name: 'anonymous'};\r\n\t\t\t\tif(userInList.userId){\r\n\t\t\t\t\tif (clientVars.ep_profile_list && clientVars.ep_profile_list[userInList.userId]) {\r\n\t\t\t\t\t\tavatarUrl = clientVars.ep_profile_list[userInList.userId].imageUrl || clientVars.ep_profile_list[userInList.userId].img;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (index < inlineAvatarLimit) {\r\n\t\t\t\t\t\t$element.find('.avatarMore').hide();\r\n\t\t\t\t\t\t$element.append('<div class=\"avatar\" data-id=\"' + userInList.userId + '\"><img src=\"' + avatarUrl + '\"></div>');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$element.find('.avatarMore').show().text('+' + (index + 1 - inlineAvatarLimit));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\twrtcPubsub.on('component status', function(componentName, status) {\r\n\t\twrtcStore.components[componentName].active = status\r\n\t})\r\n\r\n\twrtcPubsub.on('update store', function (requestUser, headerId, action, target, roomInfo, callback) {\r\n\t\tif (!requestUser || !headerId || !action || !roomInfo || !target) return false;\r\n\r\n\t\tif(!wrtcStore[headerId]) wrtcStore[headerId] = {};\r\n\t\tif(!wrtcStore[headerId].USERS) wrtcStore[headerId].USERS = {};\r\n\r\n\t\tvar users = wrtcStore[headerId].USERS;\r\n\t\twrtcStore[headerId][target] = roomInfo;\r\n\t\t// if(action === \"JOIN\"){}\r\n\t\t// if(action === \"LEAVE\"){}\r\n\t\t// remove all users\r\n\t\tusers = {};\r\n\r\n\t\twrtcStore[headerId].TEXT.list.forEach(function (el) {\r\n\t\t\tif (!users[el.userId]) users[el.userId] = {};\r\n\t\t\tusers[el.userId] = el;\r\n\t\t});\r\n\r\n\t\twrtcStore[headerId].VIDEO.list.forEach(function (el) {\r\n\t\t\tif (!users[el.userId]) users[el.userId] = {};\r\n\t\t\tusers[el.userId] = el;\r\n\t\t});\r\n\r\n\t\tinlineAvatar[target](headerId, wrtcStore[headerId][target]);\r\n\t\tinlineAvatar.ROOM(headerId, users);\r\n\r\n\t\tif (callback) callback(wrtcStore[headerId]);\r\n\t});\r\n\r\n\twrtcPubsub.on('disable room buttons', function disableRoomButtons(headerId, actions, target) {\r\n\t\tvar $headingRoom = $body_ace_outer().find('#' + headerId);\r\n\r\n\t\tvar $btnVideo = $headingRoom.find('.btn_icon[data-join=\"VIDEO\"]');\r\n\t\tvar $btnText = $headingRoom.find('.btn_icon[data-join=\"TEXT\"]');\r\n\t\tvar $btnPlus = $headingRoom.find('.btn_icon[data-join=\"PLUS\"]');\r\n\r\n\t\t$btnPlus.append('<div class=\"loader\"></div>');\r\n\r\n\t\tif (target === 'TEXT' || target === 'VIDEO') {\r\n\t\t\t// disable target and plus buttton\r\n\t\t\t$headingRoom.find('.btn_icon[data-join=\"' + target + '\"]').prop('disabled', true);\r\n\t\t\t$btnPlus.prop('disabled', true);\r\n\t\t}\r\n\r\n\t\tif (target === 'PLUS') {\r\n\t\t\t// disable all buttons\r\n\t\t\t$btnText.prop('disabled', true);\r\n\t\t\t$btnVideo.prop('disabled', true);\r\n\t\t\t$btnPlus.prop('disabled', true);\r\n\t\t}\r\n\t});\r\n\r\n\twrtcPubsub.on('enable room buttons', function enableRoomButtons(headerId, action, target) {\r\n\t\tvar $headingRoom = $body_ace_outer().find('#' + headerId);\r\n\t\tvar newAction = action === 'JOIN' ? 'LEAVE' : 'JOIN';\r\n\r\n\t\tvar $btnVideo = $headingRoom.find('.btn_icon[data-join=\"VIDEO\"]');\r\n\t\tvar $btnText = $headingRoom.find('.btn_icon[data-join=\"TEXT\"]');\r\n\t\tvar $btnPlus = $headingRoom.find('.btn_icon[data-join=\"PLUS\"]');\r\n\r\n\t\t$btnPlus.find('.loader').remove();\r\n\r\n\t\tif (target === 'TEXT' || target === 'VIDEO') {\r\n\t\t\t// enable target and plus buttton\r\n\t\t\t$headingRoom.find('.btn_icon[data-join=\"' + target + '\"]').attr({ 'data-action': newAction }).prop('disabled', false);\r\n\r\n\t\t\t$btnPlus.attr({ 'data-action': newAction }).prop('disabled', false);\r\n\t\t}\r\n\r\n\t\tif (target === 'TEXTPLUS') {\r\n\t\t\t// enable text button\r\n\t\t\t$btnText.attr({ 'data-action': newAction }).prop('disabled', false);\r\n\t\t\t$btnVideo.attr({ 'data-action': newAction });\r\n\t\t}\r\n\r\n\t\tif (target === 'PLUS') {\r\n\t\t\t// make enable and action toggle all buttons\r\n\t\t\t$btnText.attr({ 'data-action': newAction }).prop('disabled', false);\r\n\t\t\t$btnVideo.attr({ 'data-action': newAction }).prop('disabled', false);\r\n\t\t\t$btnPlus.attr({ 'data-action': newAction }).prop('disabled', false);\r\n\t\t}\r\n\t});\r\n\r\n\treturn {\r\n\t\tscrollDownToLastChatText,\r\n\t\tgetUserFromId,\r\n\t\tslugify,\r\n\t\t$body_ace_outer,\r\n\t\tcreateShareLink,\r\n\t\tnotifyNewUserJoined,\r\n\t\troomBoxIconActive,\r\n\t\tappendUserList,\r\n\t\twrtcStore,\r\n\t\twrtcPubsub,\r\n\t\tgetUserId,\r\n\t\tstopStreaming,\r\n\t\t\r\n\t}\r\n\r\n})();\r\n","\r\n// inspired by ep_comments_page plugin, used and modified copyPasteEvents.js\r\n\r\n'use strict';\r\nvar _ = require('ep_etherpad-lite/static/js/underscore');\r\nvar randomString = require('ep_etherpad-lite/static/js/pad_utils').randomString;\r\n\r\nvar events = (function(){\r\n\tvar padInner = null;\r\n\r\n\tvar getFirstColumnOfSelection = function getFirstColumnOfSelection(line, rep, firstLineOfSelection) {\r\n\t\treturn line !== firstLineOfSelection ? 0 : rep.selStart[1];\r\n\t};\r\n\r\n\tvar getLength = function getLength(line, rep) {\r\n\t\tvar nextLine = line + 1;\r\n\t\tvar startLineOffset = rep.lines.offsetOfIndex(line);\r\n\t\tvar endLineOffset = rep.lines.offsetOfIndex(nextLine);\r\n\r\n\t\t// lineLength without \\n\r\n\t\tvar lineLength = endLineOffset - startLineOffset - 1;\r\n\r\n\t\treturn lineLength;\r\n\t};\r\n\r\n\tvar getLastColumnOfSelection = function getLastColumnOfSelection(line, rep, lastLineOfSelection) {\r\n\t\tvar lastColumnOfSelection;\r\n\t\tif (line !== lastLineOfSelection) {\r\n\t\t\tlastColumnOfSelection = getLength(line, rep); // length of line\r\n\t\t} else {\r\n\t\t\tlastColumnOfSelection = rep.selEnd[1] - 1; // position of last character selected\r\n\t\t}\r\n\t\treturn lastColumnOfSelection;\r\n\t};\r\n\r\n\tvar hasCommentOnLine = function hasCommentOnLine(lineNumber, firstColumn, lastColumn, attributeManager) {\r\n\t\tvar foundHeadOnLine = false;\r\n\t\tvar headId = null;\r\n\t\tfor (var column = firstColumn; column <= lastColumn && !foundHeadOnLine; column++) {\r\n\t\t\theadId = _.object(attributeManager.getAttributesOnPosition(lineNumber, column)).headingTagId;\r\n\t\t\tif (headId) {\r\n\t\t\t\tfoundHeadOnLine = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { foundHeadOnLine: foundHeadOnLine, headId: headId };\r\n\t};\r\n\r\n\tvar hasCommentOnMultipleLineSelection = function hasCommentOnMultipleLineSelection(firstLineOfSelection, lastLineOfSelection, rep, attributeManager) {\r\n\t\tvar foundLineWithComment = false;\r\n\t\tfor (var line = firstLineOfSelection; line <= lastLineOfSelection && !foundLineWithComment; line++) {\r\n\t\t\tvar firstColumn = getFirstColumnOfSelection(line, rep, firstLineOfSelection);\r\n\t\t\tvar lastColumn = getLastColumnOfSelection(line, rep, lastLineOfSelection);\r\n\t\t\tvar hasComment = hasCommentOnLine(line, firstColumn, lastColumn, attributeManager);\r\n\t\t\tif (hasComment) {\r\n\t\t\t\tfoundLineWithComment = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn foundLineWithComment;\r\n\t};\r\n\r\n\tvar hasMultipleLineSelected = function hasMultipleLineSelected(firstLineOfSelection, lastLineOfSelection) {\r\n\t\treturn firstLineOfSelection !== lastLineOfSelection;\r\n\t};\r\n\r\n\tvar hasHeaderOnSelection = function hasHeaderOnSelection() {\r\n\t\tvar hasVideoHeader;\r\n\t\tvar attributeManager = this.documentAttributeManager;\r\n\t\tvar rep = this.rep;\r\n\t\tvar firstLineOfSelection = rep.selStart[0];\r\n\t\tvar firstColumn = rep.selStart[1];\r\n\t\tvar lastColumn = rep.selEnd[1];\r\n\t\tvar lastLineOfSelection = rep.selEnd[0];\r\n\t\tvar selectionOfMultipleLine = hasMultipleLineSelected(firstLineOfSelection, lastLineOfSelection);\r\n\t\tif (selectionOfMultipleLine) {\r\n\t\t\thasVideoHeader = hasCommentOnMultipleLineSelection(firstLineOfSelection, lastLineOfSelection, rep, attributeManager);\r\n\t\t} else {\r\n\t\t\thasVideoHeader = hasCommentOnLine(firstLineOfSelection, firstColumn, lastColumn, attributeManager);\r\n\t\t}\r\n\t\treturn { hasVideoHeader: hasVideoHeader.foundHeadOnLine, headId: hasVideoHeader.headId, hasMultipleLine: selectionOfMultipleLine };\r\n\t};\r\n\r\n\tfunction getSelectionHtml() {\r\n\t\tvar html = '';\r\n\t\tif (typeof window.getSelection !== 'undefined') {\r\n\t\t\tvar sel = padInner.contents()[0].getSelection();\r\n\t\t\tif (sel.rangeCount) {\r\n\t\t\t\tvar container = document.createElement('div');\r\n\t\t\t\tfor (var i = 0, len = sel.rangeCount; i < len; ++i) {\r\n\t\t\t\t\tcontainer.appendChild(sel.getRangeAt(i).cloneContents());\r\n\t\t\t\t}\r\n\t\t\t\thtml = container.innerHTML;\r\n\t\t\t}\r\n\t\t} else if (typeof document.selection !== 'undefined') {\r\n\t\t\tif (document.selection.type === 'Text') {\r\n\t\t\t\thtml = document.selection.createRange().htmlText;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn html;\r\n\t}\r\n\r\n\tfunction selectionMultipleLine() {\r\n\t\tvar rawHtml = getSelectionHtml();\r\n\t\trawHtml = $('<div></div>').append(rawHtml);\r\n\t\trawHtml.find(':header span').removeClass(function removeClass(index, css) {\r\n\t\t\treturn (css.match(/\\headingTagId_\\S+/g) || []).join(' ');\r\n\t\t}).addClass(function addClass(index, css) {\r\n\t\t\treturn 'headingTagId_' + randomString(16) + ' ' + css;\r\n\t\t});\r\n\t\treturn rawHtml.html();\r\n\t}\r\n\r\n\tfunction selectionOneLine(headerId) {\r\n\t\tvar hTag = padInner.contents().find('.headingTagId_' + headerId).closest(':header').eq(0).prop(\"tagName\").toLowerCase();\r\n\t\tvar content = padInner.contents().find('.headingTagId_' + headerId).closest(':header span').removeClass(function(index, css) {\r\n\t\t\treturn (css.match(/\\headingTagId_\\S+/g) || []).join(' ');\r\n\t\t}).html();\r\n\t\tif(!hTag && !content) return false;\r\n\t\tvar rawHtml = $('<div></div>').append('<' + hTag + \"><span class='headingTagId_\" + randomString(16) + \"'>\" + content + '</span></' + hTag + '>');\r\n\t\treturn rawHtml.html();\r\n\t}\r\n\r\n\tvar addTextOnClipboard = function addTextOnClipboard(e, aces, inner, removeSelection) {\r\n\t\tpadInner = inner;\r\n\r\n\t\tvar selection;\r\n\t\taces.callWithAce(function callWithAce(ace) {\r\n\t\t\tselection = ace.ace_hasHeaderOnSelection();\r\n\t\t});\r\n\r\n\t\tif (selection.hasVideoHeader || selection.hasMultipleLine) {\r\n\t\t\tvar rawHtml;\r\n\t\t\tif (selection.hasMultipleLine) {\r\n\t\t\t\tvar htmlSelection = getSelectionHtml();\r\n\t\t\t\trawHtml = selectionMultipleLine(htmlSelection);\r\n\t\t\t} else {\r\n\t\t\t\tif(!selection.headId) return false;\r\n\t\t\t\trawHtml = selectionOneLine(selection.headId);\r\n\t\t\t}\r\n\r\n\t\t\tif (rawHtml) {\r\n\t\t\t\te.originalEvent.clipboardData.setData('text/html', rawHtml);\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// if it is a cut event we have to remove the selection\r\n\t\t\tif (removeSelection) {\r\n\t\t\t\tpadInner.contents()[0].execCommand('delete');\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn {\r\n\t\thasHeaderOnSelection,\r\n\t\taddTextOnClipboard,\r\n\t}\r\n\r\n})();\r\n\r\n","// CodecsHandler.js\r\nvar CodecsHandler = (function() {\r\n\tfunction preferCodec(sdp, codecName) {\r\n\t\t\tvar info = splitLines(sdp);\r\n\r\n\t\t\tcodecName = codecName.toLowerCase()\r\n\r\n\t\t\tif (!info.videoCodecNumbers) {\r\n\t\t\t\t\treturn sdp;\r\n\t\t\t}\r\n\r\n\t\t\tif (codecName === 'vp8' && info.vp8LineNumber === info.videoCodecNumbers[0]) {\r\n\t\t\t\t\treturn sdp;\r\n\t\t\t}\r\n\r\n\t\t\tif (codecName === 'vp9' && info.vp9LineNumber === info.videoCodecNumbers[0]) {\r\n\t\t\t\t\treturn sdp;\r\n\t\t\t}\r\n\r\n\t\t\tif (codecName === 'h264' && info.h264LineNumber === info.videoCodecNumbers[0]) {\r\n\t\t\t\t\treturn sdp;\r\n\t\t\t}\r\n\r\n\t\t\tsdp = preferCodecHelper(sdp, codecName, info);\r\n\r\n\t\t\treturn sdp;\r\n\t}\r\n\r\n\tfunction preferCodecHelper(sdp, codec, info, ignore) {\r\n\t\t\tvar preferCodecNumber = '';\r\n\r\n\t\t\tif (codec === 'vp8') {\r\n\t\t\t\t\tif (!info.vp8LineNumber) {\r\n\t\t\t\t\t\t\treturn sdp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpreferCodecNumber = info.vp8LineNumber;\r\n\t\t\t}\r\n\r\n\t\t\tif (codec === 'vp9') {\r\n\t\t\t\t\tif (!info.vp9LineNumber) {\r\n\t\t\t\t\t\t\treturn sdp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpreferCodecNumber = info.vp9LineNumber;\r\n\t\t\t}\r\n\r\n\t\t\tif (codec === 'h264') {\r\n\t\t\t\t\tif (!info.h264LineNumber) {\r\n\t\t\t\t\t\t\treturn sdp;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpreferCodecNumber = info.h264LineNumber;\r\n\t\t\t}\r\n\r\n\t\t\tvar newLine = info.videoCodecNumbersOriginal.split('SAVPF')[0] + 'SAVPF ';\r\n\r\n\t\t\tvar newOrder = [preferCodecNumber];\r\n\r\n\t\t\tif (ignore) {\r\n\t\t\t\t\tnewOrder = [];\r\n\t\t\t}\r\n\r\n\t\t\tinfo.videoCodecNumbers.forEach(function(codecNumber) {\r\n\t\t\t\t\tif (codecNumber === preferCodecNumber) return;\r\n\t\t\t\t\tnewOrder.push(codecNumber);\r\n\t\t\t});\r\n\r\n\t\t\tnewLine += newOrder.join(' ');\r\n\r\n\t\t\tsdp = sdp.replace(info.videoCodecNumbersOriginal, newLine);\r\n\t\t\treturn sdp;\r\n\t}\r\n\r\n\tfunction splitLines(sdp) {\r\n\t\t\tvar info = {};\r\n\t\t\tsdp.split('\\n').forEach(function(line) {\r\n\t\t\t\t\tif (line.indexOf('m=video') === 0) {\r\n\t\t\t\t\t\t\tinfo.videoCodecNumbers = [];\r\n\t\t\t\t\t\t\tline.split('SAVPF')[1].split(' ').forEach(function(codecNumber) {\r\n\t\t\t\t\t\t\t\t\tcodecNumber = codecNumber.trim();\r\n\t\t\t\t\t\t\t\t\tif (!codecNumber || !codecNumber.length) return;\r\n\t\t\t\t\t\t\t\t\tinfo.videoCodecNumbers.push(codecNumber);\r\n\t\t\t\t\t\t\t\t\tinfo.videoCodecNumbersOriginal = line;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (line.indexOf('VP8/90000') !== -1 && !info.vp8LineNumber) {\r\n\t\t\t\t\t\t\tinfo.vp8LineNumber = line.replace('a=rtpmap:', '').split(' ')[0];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (line.indexOf('VP9/90000') !== -1 && !info.vp9LineNumber) {\r\n\t\t\t\t\t\t\tinfo.vp9LineNumber = line.replace('a=rtpmap:', '').split(' ')[0];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (line.indexOf('H264/90000') !== -1 && !info.h264LineNumber) {\r\n\t\t\t\t\t\t\tinfo.h264LineNumber = line.replace('a=rtpmap:', '').split(' ')[0];\r\n\t\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn info;\r\n\t}\r\n\r\n\tfunction removeVPX(sdp) {\r\n\t\t\tvar info = splitLines(sdp);\r\n\r\n\t\t\t// last parameter below means: ignore these codecs\r\n\t\t\tsdp = preferCodecHelper(sdp, 'vp9', info, true);\r\n\t\t\tsdp = preferCodecHelper(sdp, 'vp8', info, true);\r\n\r\n\t\t\treturn sdp;\r\n\t}\r\n\r\n\tfunction disableNACK(sdp) {\r\n\t\t\tif (!sdp || typeof sdp !== 'string') {\r\n\t\t\t\t\tthrow 'Invalid arguments.';\r\n\t\t\t}\r\n\r\n\t\t\tsdp = sdp.replace('a=rtcp-fb:126 nack\\r\\n', '');\r\n\t\t\tsdp = sdp.replace('a=rtcp-fb:126 nack pli\\r\\n', 'a=rtcp-fb:126 pli\\r\\n');\r\n\t\t\tsdp = sdp.replace('a=rtcp-fb:97 nack\\r\\n', '');\r\n\t\t\tsdp = sdp.replace('a=rtcp-fb:97 nack pli\\r\\n', 'a=rtcp-fb:97 pli\\r\\n');\r\n\r\n\t\t\treturn sdp;\r\n\t}\r\n\r\n\tfunction prioritize(codecMimeType, peer) {\r\n\t\t\tif (!peer || !peer.getSenders || !peer.getSenders().length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!codecMimeType || typeof codecMimeType !== 'string') {\r\n\t\t\t\t\tthrow 'Invalid arguments.';\r\n\t\t\t}\r\n\r\n\t\t\tpeer.getSenders().forEach(function(sender) {\r\n\t\t\t\t\tvar params = sender.getParameters();\r\n\t\t\t\t\tfor (var i = 0; i < params.codecs.length; i++) {\r\n\t\t\t\t\t\t\tif (params.codecs[i].mimeType == codecMimeType) {\r\n\t\t\t\t\t\t\t\t\tparams.codecs.unshift(params.codecs.splice(i, 1));\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsender.setParameters(params);\r\n\t\t\t});\r\n\t}\r\n\r\n\tfunction removeNonG722(sdp) {\r\n\t\t\treturn sdp.replace(/m=audio ([0-9]+) RTP\\/SAVPF ([0-9 ]*)/g, 'm=audio $1 RTP\\/SAVPF 9');\r\n\t}\r\n\r\n\tfunction setBAS(sdp, bandwidth, isScreen) {\r\n\t\tif (!!navigator.mozGetUserMedia || !bandwidth) {\r\n\t\t\treturn sdp;\r\n\t\t}\r\n\r\n\t\tif (isScreen) {\r\n\t\t\tif (!bandwidth.screen) {\r\n\t\t\t\tconsole.warn('It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.');\r\n\t\t\t} else if (bandwidth.screen < 300) {\r\n\t\t\t\tconsole.warn('It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail.');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// if screen; must use at least 300kbs\r\n\t\tif (bandwidth.screen && isScreen) {\r\n\t\t\tsdp = sdp.replace(/b=AS([^\\r\\n]+\\r\\n)/g, '');\r\n\t\t\tsdp = sdp.replace(/a=mid:video\\r\\n/g, 'a=mid:video\\r\\nb=AS:' + bandwidth.screen + '\\r\\n');\r\n\t\t}\r\n\r\n\t\t// remove existing bandwidth lines\r\n\t\tif (bandwidth.audio || bandwidth.video || bandwidth.data) {\r\n\t\t\tsdp = sdp.replace(/b=AS([^\\r\\n]+\\r\\n)/g, '');\r\n\t\t}\r\n\r\n\t\tif (bandwidth.audio) {\r\n\t\t\tsdp = sdp.replace(/a=mid:audio\\r\\n/g, 'a=mid:audio\\r\\nb=AS:' + bandwidth.audio + '\\r\\n');\r\n\t\t}\r\n\r\n\t\tif (bandwidth.video) {\r\n\t\t\tsdp = sdp.replace(/a=mid:video\\r\\n/g, 'a=mid:video\\r\\nb=AS:' + (isScreen ? bandwidth.screen : bandwidth.video) + '\\r\\n');\r\n\t\t}\r\n\r\n\t\treturn sdp;\r\n\t}\r\n\r\n\t// Find the line in sdpLines that starts with |prefix|, and, if specified,\r\n\t// contains |substr| (case-insensitive search).\r\n\tfunction findLine(sdpLines, prefix, substr) {\r\n\t\t\treturn findLineInRange(sdpLines, 0, -1, prefix, substr);\r\n\t}\r\n\r\n\t// Find the line in sdpLines[startLine...endLine - 1] that starts with |prefix|\r\n\t// and, if specified, contains |substr| (case-insensitive search).\r\n\tfunction findLineInRange(sdpLines, startLine, endLine, prefix, substr) {\r\n\t\t\tvar realEndLine = endLine !== -1 ? endLine : sdpLines.length;\r\n\t\t\tfor (var i = startLine; i < realEndLine; ++i) {\r\n\t\t\t\t\tif (sdpLines[i].indexOf(prefix) === 0) {\r\n\t\t\t\t\t\t\tif (!substr ||\r\n\t\t\t\t\t\t\t\t\tsdpLines[i].toLowerCase().indexOf(substr.toLowerCase()) !== -1) {\r\n\t\t\t\t\t\t\t\t\treturn i;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t}\r\n\r\n\t// Gets the codec payload type from an a=rtpmap:X line.\r\n\tfunction getCodecPayloadType(sdpLine) {\r\n\t\t\tvar pattern = new RegExp('a=rtpmap:(\\\\d+) \\\\w+\\\\/\\\\d+');\r\n\t\t\tvar result = sdpLine.match(pattern);\r\n\t\t\treturn (result && result.length === 2) ? result[1] : null;\r\n\t}\r\n\r\n\tfunction setVideoBitrates(sdp, params) {\r\n\t\t\tparams = params || {};\r\n\t\t\tvar xgoogle_min_bitrate = params.min;\r\n\t\t\tvar xgoogle_max_bitrate = params.max;\r\n\t\t\tvar videoCodec = params.codec.toUpperCase() || \"VP8\";\r\n\t\t\t\r\n\r\n\r\n\t\t\tvar sdpLines = sdp.split('\\r\\n');\r\n\r\n\t\t\t// VP8\r\n\t\t\tvar vp8Index = findLine(sdpLines, 'a=rtpmap', videoCodec+'/90000');\r\n\t\t\tvar vp8Payload;\r\n\t\t\tif (vp8Index) {\r\n\t\t\t\t\tvp8Payload = getCodecPayloadType(sdpLines[vp8Index]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!vp8Payload) {\r\n\t\t\t\t\treturn sdp;\r\n\t\t\t}\r\n\r\n\t\t\tvar rtxIndex = findLine(sdpLines, 'a=rtpmap', 'rtx/90000');\r\n\t\t\tvar rtxPayload;\r\n\t\t\tif (rtxIndex) {\r\n\t\t\t\t\trtxPayload = getCodecPayloadType(sdpLines[rtxIndex]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!rtxIndex) {\r\n\t\t\t\t\treturn sdp;\r\n\t\t\t}\r\n\r\n\t\t\tvar rtxFmtpLineIndex = findLine(sdpLines, 'a=fmtp:' + rtxPayload.toString());\r\n\t\t\tif (rtxFmtpLineIndex !== null) {\r\n\t\t\t\t\tvar appendrtxNext = '\\r\\n';\r\n\t\t\t\t\tappendrtxNext += 'a=fmtp:' + vp8Payload + ' x-google-min-bitrate=' + (xgoogle_min_bitrate || '228') + '; x-google-max-bitrate=' + (xgoogle_max_bitrate || '228');\r\n\t\t\t\t\tsdpLines[rtxFmtpLineIndex] = sdpLines[rtxFmtpLineIndex].concat(appendrtxNext);\r\n\t\t\t\t\tsdp = sdpLines.join('\\r\\n');\r\n\t\t\t}\r\n\r\n\r\n\t\t\treturn sdp;\r\n\t}\r\n\r\n\tfunction setOpusAttributes(sdp, params) {\r\n\t\t\tparams = params || {};\r\n\r\n\t\t\tvar sdpLines = sdp.split('\\r\\n');\r\n\r\n\t\t\t// Opus\r\n\t\t\tvar opusIndex = findLine(sdpLines, 'a=rtpmap', 'opus/48000');\r\n\t\t\tvar opusPayload;\r\n\t\t\tif (opusIndex) {\r\n\t\t\t\t\topusPayload = getCodecPayloadType(sdpLines[opusIndex]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!opusPayload) {\r\n\t\t\t\t\treturn sdp;\r\n\t\t\t}\r\n\r\n\t\t\tvar opusFmtpLineIndex = findLine(sdpLines, 'a=fmtp:' + opusPayload.toString());\r\n\t\t\tif (opusFmtpLineIndex === null) {\r\n\t\t\t\t\treturn sdp;\r\n\t\t\t}\r\n\r\n\t\t\tvar appendOpusNext = '';\r\n\t\t\tappendOpusNext += '; stereo=' + (typeof params.stereo != 'undefined' ? params.stereo : '1');\r\n\t\t\tappendOpusNext += '; sprop-stereo=' + (typeof params['sprop-stereo'] != 'undefined' ? params['sprop-stereo'] : '1');\r\n\r\n\t\t\tif (typeof params.maxaveragebitrate != 'undefined') {\r\n\t\t\t\t\tappendOpusNext += '; maxaveragebitrate=' + (params.maxaveragebitrate || 128 * 1024 * 8);\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof params.maxplaybackrate != 'undefined') {\r\n\t\t\t\t\tappendOpusNext += '; maxplaybackrate=' + (params.maxplaybackrate || 128 * 1024 * 8);\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof params.cbr != 'undefined') {\r\n\t\t\t\t\tappendOpusNext += '; cbr=' + (typeof params.cbr != 'undefined' ? params.cbr : '1');\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof params.useinbandfec != 'undefined') {\r\n\t\t\t\t\tappendOpusNext += '; useinbandfec=' + params.useinbandfec;\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof params.usedtx != 'undefined') {\r\n\t\t\t\t\tappendOpusNext += '; usedtx=' + params.usedtx;\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof params.maxptime != 'undefined') {\r\n\t\t\t\t\tappendOpusNext += '\\r\\na=maxptime:' + params.maxptime;\r\n\t\t\t}\r\n\r\n\t\t\tsdpLines[opusFmtpLineIndex] = sdpLines[opusFmtpLineIndex].concat(appendOpusNext);\r\n\r\n\t\t\tsdp = sdpLines.join('\\r\\n');\r\n\t\t\treturn sdp;\r\n\t}\r\n\r\n\t// forceStereoAudio => via webrtcexample.com\r\n\t// requires getUserMedia => echoCancellation:false\r\n\tfunction forceStereoAudio(sdp) {\r\n\t\t\tvar sdpLines = sdp.split('\\r\\n');\r\n\t\t\tvar fmtpLineIndex = null;\r\n\t\t\tfor (var i = 0; i < sdpLines.length; i++) {\r\n\t\t\t\t\tif (sdpLines[i].search('opus/48000') !== -1) {\r\n\t\t\t\t\t\t\tvar opusPayload = extractSdp(sdpLines[i], /:(\\d+) opus\\/48000/i);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < sdpLines.length; i++) {\r\n\t\t\t\t\tif (sdpLines[i].search('a=fmtp') !== -1) {\r\n\t\t\t\t\t\t\tvar payload = extractSdp(sdpLines[i], /a=fmtp:(\\d+)/);\r\n\t\t\t\t\t\t\tif (payload === opusPayload) {\r\n\t\t\t\t\t\t\t\t\tfmtpLineIndex = i;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (fmtpLineIndex === null) return sdp;\r\n\t\t\tsdpLines[fmtpLineIndex] = sdpLines[fmtpLineIndex].concat('; stereo=1; sprop-stereo=1');\r\n\t\t\tsdp = sdpLines.join('\\r\\n');\r\n\t\t\treturn sdp;\r\n\t}\r\n\r\n\treturn {\r\n\t\t\tremoveVPX: removeVPX,\r\n\t\t\tdisableNACK: disableNACK,\r\n\t\t\tprioritize: prioritize,\r\n\t\t\tremoveNonG722: removeNonG722,\r\n\t\t\tsetApplicationSpecificBandwidth: function(sdp, bandwidth, isScreen) {\r\n\t\t\t\t\treturn setBAS(sdp, bandwidth, isScreen);\r\n\t\t\t},\r\n\t\t\tsetVideoBitrates: function(sdp, params) {\r\n\t\t\t\t\treturn setVideoBitrates(sdp, params);\r\n\t\t\t},\r\n\t\t\tsetOpusAttributes: function(sdp, params) {\r\n\t\t\t\t\treturn setOpusAttributes(sdp, params);\r\n\t\t\t},\r\n\t\t\tpreferVP9: function(sdp) {\r\n\t\t\t\t\treturn preferCodec(sdp, 'vp9');\r\n\t\t\t},\r\n\t\t\tpreferCodec: preferCodec,\r\n\t\t\tforceStereoAudio: forceStereoAudio\r\n\t};\r\n})();\r\n","'use strict';\r\nvar padutils = require('ep_etherpad-lite/static/js/pad_utils').padutils;\r\n\r\nvar textChat = (function textChat() {\r\n\tvar socket = null;\r\n\tvar padId = null;\r\n\tvar currentRoom = {};\r\n\tvar $joinBtn = null;\r\n\r\n\tfunction createAndAppendMessage(msg) {\r\n\t\tif (!msg || !currentRoom.userId) return true;\r\n\r\n\t\t// correct the time\r\n\t\t// msg.time += window.clientTimeOffset;\r\n\r\n\t\tvar minutes = '' + new Date(msg.time).getMinutes();\r\n\t\tvar hours = '' + new Date(msg.time).getHours();\r\n\t\tif (minutes.length === 1) minutes = '0' + minutes;\r\n\t\tif (hours.length === 1) hours = '0' + hours;\r\n\t\tvar timeStr = hours + ':' + minutes;\r\n\r\n\t\tvar userName = $('<b>').text(msg.userName + ': ');\r\n\t\tvar tim = $('<span>').attr({ 'class': 'time' }).text(timeStr);\r\n\r\n\t\tvar text = padutils.escapeHtmlWithClickableLinks(msg.text, \"_blank\");\r\n\r\n\t\t// var urlParams = new URLSearchParams(msg.text.split(\"?\")[1]);\r\n\r\n\t\t// if(urlParams.get('id')) {\r\n\t\t// \tvar headerId = urlParams.get('id');\r\n\t\t// \tvar target = urlParams.get('target');\r\n\t\t// \tvar join = urlParams.get('join');\r\n\t\t// \ttext = $(text).attr({\r\n\t\t// \t\t\"data-join\": join,\r\n\t\t// \t\t\"data-action\":\"JOIN\",\r\n\t\t// \t\t\"data-id\": headerId\r\n\t\t// \t}).addClass('btn_roomHandler')\r\n\t\t// }\r\n\r\n\r\n\t\tvar message = $('<p>').attr({\r\n\t\t\t'data-authorid': msg.author\r\n\t\t}).append(userName).append(tim).append(text);\r\n\r\n\t\t$('#wrtc_textChat').append(message);\r\n\t\tshare.scrollDownToLastChatText('#wrtc_textChat');\r\n\t}\r\n\r\n\t// function privateNotifyNewUserJoined(target, msg, action) {\r\n\t// \tvar textIcon = '<span class=\"textIcon\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\"><path fill=\"currentColor\" d=\"M416 224V64c0-35.3-28.7-64-64-64H64C28.7 0 0 28.7 0 64v160c0 35.3 28.7 64 64 64v54.2c0 8 9.1 12.6 15.5 7.8l82.8-62.1H352c35.3.1 64-28.6 64-63.9zm96-64h-64v64c0 52.9-43.1 96-96 96H192v64c0 35.3 28.7 64 64 64h125.7l82.8 62.1c6.4 4.8 15.5.2 15.5-7.8V448h32c35.3 0 64-28.7 64-64V224c0-35.3-28.7-64-64-64z\"></path></svg></span>';\r\n\t// \tvar btnJoin = \"<span class='wrtc_roomLink' data-join='\" + target + \"' data-action='JOIN' data-id='\" + msg.headerId + \"' title='Join'>\" + msg.headerTitle + '</span>';\r\n\r\n\t// \tvar text = action === 'JOIN' ? 'joins' : 'leaves';\r\n\r\n\t// \tmsg.text = '<span>' + text + '</span>' + textIcon + btnJoin;\r\n\r\n\t// \tmsg.target = target;\r\n\r\n\t// \tcreateAndAppendMessage(msg);\r\n\t// }\r\n\r\n\tfunction eventTextChatInput() {\r\n\t\tvar keycode = event.keyCode || event.which;\r\n\t\t// when press Enter key\r\n\t\tif (keycode === 13) {\r\n\t\t\tvar textMessage = $(this).val();\r\n\t\t\tif (!textMessage) return true;\r\n\t\t\t$(this).val('');\r\n\t\t\tvar user = share.getUserFromId(clientVars.userId);\r\n\t\t\tif(!user) return true;\r\n\t\t\tvar msg = { text: textMessage, userName: user.name, author: user.userId, time: new Date().getTime() };\r\n\t\t\tsocket.emit('sendTextMessage', padId, currentRoom.headerId, msg, function sendTextMessage(incomMsg) {\r\n\t\t\t\tcreateAndAppendMessage(incomMsg);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction eventListers() {\r\n\t\t$(document).on('keypress', '#wrtc_textChatInputBox input', eventTextChatInput);\r\n\r\n\t\t$(document).on('click', '#wrtc_textChatWrapper .btn_toggle_modal', function click() {\r\n\t\t\tvar action = $(this).attr('data-action');\r\n\t\t\tvar chatBox = $('#wrtc_textChat').innerHeight() + $('#wrtc_textChatInputBox').innerHeight() + 1;\r\n\r\n\t\t\t$(this).find('.fa_arrow-from-top').toggle();\r\n\t\t\t$(this).find('.fa_arrow-to-top').toggle();\r\n\r\n\t\t\tif (action === 'collapse') {\r\n\t\t\t\t$(this).attr({ 'data-action': 'expand' });\r\n\t\t\t\t$('#wrtc_textChatWrapper').css({\r\n\t\t\t\t\ttransform: 'translate(-50%, ' + chatBox + 'px)'\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t$(this).attr({ 'data-action': 'collapse' });\r\n\t\t\t\t$('#wrtc_textChatWrapper').css({\r\n\t\t\t\t\ttransform: 'translate(-50%, 0)'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction deactivateModal(headerId, roomInfo) {\r\n\t\tvar $TextChatWrapper = $(document).find('#wrtc_textChatWrapper');\r\n\r\n\t\t$TextChatWrapper.removeClass('active').removeAttr('style');\r\n\t\t$TextChatWrapper.find('#wrtc_textChat p').remove();\r\n\t\t// socket.removeListener('receiveTextMessage:' + headerId);\r\n\r\n\t\tvar $btn = $(document).find('#wrtc_textChatWrapper .btn_toggle_modal');\r\n\t\t$btn.attr({ 'data-action': 'collapse' });\r\n\t\t$btn.find('.fa_arrow-from-top').toggle();\r\n\t\t$btn.find('.fa_arrow-to-top').toggle();\r\n\t}\r\n\r\n\tfunction activateModal(headerId, headTitle, userCount, roomInfo) {\r\n\t\tif (!headerId) return false;\r\n\t\tvar existTextChat = $(document).find('#wrtc_textChatWrapper');\r\n\t\tif (!existTextChat.length) {\r\n\t\t\tvar textChatBox = $('#wrtc_textChatBox').tmpl({\r\n\t\t\t\theaderId: headerId,\r\n\t\t\t\theadTitle: headTitle\r\n\t\t\t});\r\n\t\t\t$('body').append(textChatBox);\r\n\t\t} else {\r\n\t\t\t// TODO: change this to template\r\n\t\t\texistTextChat.attr({ 'data-id': headerId }).find('.textChatToolbar b, .btn_leave').attr({ 'data-id': headerId });\r\n\t\t\texistTextChat.find('.nd_title b').text(headTitle);\r\n\t\t}\r\n\r\n\t\t// for animation pop up\r\n\t\tsetTimeout(function setTimeout() {\r\n\t\t\t$(document).find('#wrtc_textChatWrapper').addClass('active');\r\n\t\t}, 250);\r\n\r\n\t\tsocket.on('receiveTextMessage:' + headerId, function receiveTextMessage(headingId, msg) {\r\n\t\t\tif (headingId === headerId) {\r\n\t\t\t\tcreateAndAppendMessage(msg);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.emit('getTextMessages', padId, headerId, {}, function getTextMessages(data) {\r\n\t\t\tdata.forEach(function (el) {\r\n\t\t\t\tcreateAndAppendMessage(el);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tshare.appendUserList(roomInfo, '#wrtc_textChatWrapper  #textChatUserModal ul');\r\n\t}\r\n\r\n\tfunction addUserToRoom(data, roomInfo) {\r\n\t\tif (!data || !data.userId) return true;\r\n\t\tvar headerId = data.headerId;\r\n\t\tvar $headingRoom = share.$body_ace_outer().find('#' + headerId);\r\n\t\tvar headTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n\t\tvar userCount = roomInfo.present;\r\n\t\t$headingRoom.find('.textChatCount').text(userCount);\r\n\r\n\t\tvar user = share.getUserFromId(data.userId);\r\n\t\t// some user may session does exist but the user info does not available in all over the current pad\r\n\t\tif (!user) return true;\r\n\r\n\t\t// TODO: this is not good idea, use global state\r\n\t\t// if incoming user has already in the room don't persuade the request\r\n\t\tvar IsUserInRooms = $headingRoom.find(\".wrtc_content.textChat ul li[data-id='\" + user.userId + \"']\").text();\r\n\t\tif (IsUserInRooms) return false;\r\n\r\n\t\tshare.appendUserList(roomInfo, $headingRoom.find('.wrtc_content.textChat ul'));\r\n\t\tshare.appendUserList(roomInfo, '#wrtc_textChatWrapper  #textChatUserModal ul');\r\n\r\n\t\t// notify, a user join the video-chat room\r\n\t\t// var msg = {\r\n\t\t// \ttime: new Date(),\r\n\t\t// \tuserId: data.userId || user.userId,\r\n\t\t// \tuserName: user.name || data.name || 'anonymous',\r\n\t\t// \theaderId: data.headerId,\r\n\t\t// \tuserCount: userCount,\r\n\t\t// \theaderTitle: headTitle\r\n\t\t// };\r\n\t\t// share.notifyNewUserJoined('TEXT', msg, 'JOIN');\r\n\r\n\t\t// if (data.headerId === currentRoom.headerId) {\r\n\t\t// \tvar privateMsg = {\r\n\t\t// \t\tuserName: user.name,\r\n\t\t// \t\tauthor: user.userId,\r\n\t\t// \t\theaderTitle: headTitle,\r\n\t\t// \t\ttime: new Date().getTime()\r\n\t\t// \t};\r\n\t\t// \tprivateNotifyNewUserJoined('TEXT', privateMsg, 'JOIN');\r\n\t\t// }\r\n\r\n\t\t// if (data.headerId === currentRoom.headerId && data.userId !== clientVars.userId) {\r\n\t\t// \t$.gritter.add({\r\n\t\t// \t\ttext: '<span class=\"author-name\">' + user.name + '</span>' + 'has joined the text-chat, <b><i> \"' + headTitle + '\"</b></i>',\r\n\t\t// \t\tsticky: false,\r\n\t\t// \t\ttime: 3000,\r\n\t\t// \t\tposition: 'center',\r\n\t\t// \t\tclass_name: 'chat-gritter-msg'\r\n\t\t// \t});\r\n\t\t// }\r\n\r\n\t\tif (data.userId === clientVars.userId) {\r\n\t\t\tcurrentRoom = data;\r\n\t\t\t$headingRoom.attr({ 'data-text': true });\r\n\t\t\tshare.roomBoxIconActive();\r\n\t\t\tactivateModal(headerId, headTitle, userCount, roomInfo);\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'JOIN', $joinBtn);\r\n\t\t}\r\n\r\n\t\tshare.wrtcPubsub.emit('update store', data, headerId, 'JOIN', 'TEXT', roomInfo, function updateStore() {});\r\n\t}\r\n\r\n\tfunction removeUserFromRoom(data, roomInfo, target, cb) {\r\n\t\tif (!data || !data.userId) return true;\r\n\t\tvar headerId = data.headerId;\r\n\t\tvar $headingRoom = share.$body_ace_outer().find('#' + headerId);\r\n\t\tvar headTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n\r\n\t\tvar userCount = roomInfo.present;\r\n\t\t$headingRoom.find('.textChatCount').text(userCount);\r\n\r\n\t\tvar $textChatUserList = $headingRoom.find('.wrtc_content.textChat ul');\r\n\r\n\t\tshare.appendUserList(roomInfo, $textChatUserList);\r\n\t\tshare.appendUserList(roomInfo, '#wrtc_textChatWrapper #textChatUserModal ul');\r\n\r\n\t\tif (userCount === 0) {\r\n\t\t\t$textChatUserList.append('<li class=\"empty\">Be the first to join the <button class=\"btn_joinChat_text\" data-action=\"JOIN\" data-id=\"' + headerId + '\" data-join=\"TEXT\"><b>text-chat</b></button></li>');\r\n\t\t}\r\n\r\n\t\t// var user = share.getUserFromId(data.userId);\r\n\r\n\t\t// notify, a user join the text-chat room\r\n\t\t// var msg = {\r\n\t\t// \ttime: new Date(),\r\n\t\t// \tuserId: user.userId || data.userId,\r\n\t\t// \tuserName: user.name || data.name || 'anonymous',\r\n\t\t// \theaderId: data.headerId,\r\n\t\t// \tuserCount: userCount,\r\n\t\t// \theaderTitle: headTitle\r\n\t\t// };\r\n\t\t// share.notifyNewUserJoined('TEXT', msg, 'LEAVE');\r\n\r\n\t\t// if (data.headerId === currentRoom.headerId) {\r\n\t\t// \tvar privateMsg = {\r\n\t\t// \t\tuserName: user.name,\r\n\t\t// \t\tauthor: user.userId,\r\n\t\t// \t\theaderTitle: headTitle,\r\n\t\t// \t\ttime: new Date().getTime()\r\n\t\t// \t};\r\n\t\t// \tprivateNotifyNewUserJoined('TEXT', privateMsg, 'LEAVE');\r\n\t\t// }\r\n\r\n\t\tif (data.userId === clientVars.userId) {\r\n\t\t\t$headingRoom.removeAttr('data-text');\r\n\t\t\tshare.roomBoxIconActive();\r\n\t\t\tcurrentRoom = {};\r\n\t\t\tdeactivateModal(data.headerId, roomInfo);\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t}\r\n\r\n\t\tshare.wrtcPubsub.emit('update store', data, headerId, 'LEAVE', 'TEXT', roomInfo, function () {});\r\n\r\n\t\tif (cb && typeof cb === 'function') cb();\r\n\t}\r\n\r\n\tfunction userJoin(headerId, userData, $joinButton) {\r\n\t\tif (!userData || !userData.userId) {\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// check if user already in that room\r\n\t\tif (currentRoom && currentRoom.headerId === headerId) {\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t$joinBtn = $joinButton;\r\n\r\n\t\tshare.$body_ace_outer().find('button.btn_joinChat_chatRoom').removeClass('active');\r\n\r\n\t\tif (!currentRoom.userId) {\r\n\t\t\tsocket.emit('userJoin', padId, userData, 'text', addUserToRoom);\r\n\t\t} else {\r\n\t\t\tsocket.emit('userLeave', padId, currentRoom, 'text', function userLeave(data, roomInfo, target) {\r\n\t\t\t\tremoveUserFromRoom(data, roomInfo, 'text', function join2newOne() {\r\n\t\t\t\t\tsocket.emit('userJoin', padId, userData, 'text', addUserToRoom);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction userLeave(headerId, userData, $joinButton) {\r\n\t\t$joinBtn = $joinButton;\r\n\t\tsocket.emit('userLeave', padId, userData, 'text', removeUserFromRoom);\r\n\t}\r\n\r\n\tfunction socketBulkUpdateRooms(rooms, info, target) {\r\n\t\tvar roomsInfo = {};\r\n\t\t// create a roomInfo for each individual room\r\n\t\tObject.keys(rooms).forEach(function (headerId) {\r\n\t\t\tvar roomInfo = {\r\n\t\t\t\tpresent: rooms[headerId].length,\r\n\t\t\t\tlist: rooms[headerId]\r\n\t\t\t};\r\n\t\t\troomsInfo[headerId] = roomInfo;\r\n\t\t});\r\n\r\n\t\t// bind roomInfo and send user to gateway_userJoin\r\n\t\tObject.keys(rooms).forEach(function (headerId) {\r\n\t\t\trooms[headerId].forEach(function (user) {\r\n\t\t\t\taddUserToRoom(user, roomsInfo[headerId], 'text');\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction bulkUpdateRooms(hTagList) {\r\n\t\tsocket.emit('bulkUpdateRooms', padId, hTagList, 'text', socketBulkUpdateRooms);\r\n\t}\r\n\r\n\tfunction postAceInit(hook, context, webSocket, docId) {\r\n\t\tsocket = webSocket;\r\n\t\tpadId = docId;\r\n\t\tshare.wrtcPubsub.emit('component status', 'text', true)\r\n\t\teventListers();\r\n\t}\r\n\r\n\treturn {\r\n\t\tpostAceInit: postAceInit,\r\n\t\tactivateModal: activateModal,\r\n\t\tdeactivateModal: deactivateModal,\r\n\t\tuserJoin: userJoin,\r\n\t\tuserLeave: userLeave,\r\n\t\tremoveUserFromRoom: removeUserFromRoom,\r\n\t\taddUserToRoom: addUserToRoom,\r\n\t\tbulkUpdateRooms: bulkUpdateRooms\r\n\t};\r\n})();\r\n","'use strict';\r\n\r\nvar videoChat = (function videoChat() {\r\n\tvar socket = null;\r\n\tvar padId = null;\r\n\tvar currentRoom = {};\r\n\tvar localStream = null;\r\n\tvar VIDEOCHATLIMIT = 0;\r\n\tvar $joinBtn = null;\r\n\r\n\tfunction mediaDevices() {\r\n\t\tnavigator.mediaDevices.enumerateDevices().then(function enumerateDevices(data) {\r\n\t\t\tvar videoSettings = localStorage.getItem('videoSettings') || { microphone: null, speaker: null, camera: null };\r\n\r\n\t\t\tif (typeof videoSettings === 'string') {\r\n\t\t\t\tvideoSettings = JSON.parse(videoSettings);\r\n\t\t\t}\r\n\r\n\t\t\tvar audioInputSelect = document.querySelector('select#audioSource');\r\n\t\t\tvar audioOutputSelect = document.querySelector('select#audioOutput');\r\n\t\t\tvar videoSelect = document.querySelector('select#videoSource');\r\n\r\n\t\t\tfor (var i = 0; i !== data.length; ++i) {\r\n\t\t\t\tvar deviceInfo = data[i];\r\n\t\t\t\tvar option = document.createElement('option');\r\n\t\t\t\toption.value = deviceInfo.deviceId;\r\n\t\t\t\tif (deviceInfo.kind === 'audioinput') {\r\n\t\t\t\t\toption.text = deviceInfo.label || 'microphone ' + (audioInputSelect.length + 1);\r\n\t\t\t\t\tif (videoSettings.microphone === deviceInfo.deviceId) option.selected = true;\r\n\t\t\t\t\taudioInputSelect.appendChild(option);\r\n\t\t\t\t} else if (deviceInfo.kind === 'audiooutput') {\r\n\t\t\t\t\toption.text = deviceInfo.label || 'speaker ' + (audioOutputSelect.length + 1);\r\n\t\t\t\t\tif (videoSettings.speaker === deviceInfo.deviceId) option.selected = true;\r\n\t\t\t\t\taudioOutputSelect.appendChild(option);\r\n\t\t\t\t} else if (deviceInfo.kind === 'videoinput') {\r\n\t\t\t\t\toption.text = deviceInfo.label || 'camera ' + (videoSelect.length + 1);\r\n\t\t\t\t\tif (videoSettings.camera === deviceInfo.deviceId) option.selected = true;\r\n\t\t\t\t\tvideoSelect.appendChild(option);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction isUserMediaAvailable() {\r\n\t\treturn window.navigator.mediaDevices.getUserMedia({ audio: true, video: true });\r\n\t}\r\n\r\n\tfunction removeUserFromRoom(data, roomInfo, cb) {\r\n\t\tif (!data || !roomInfo || !data.userId) return false;\r\n\t\tvar headerId = data.headerId;\r\n\t\tvar $headingRoom = share.$body_ace_outer().find('#' + headerId);\r\n\t\tvar headerTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n\t\tvar $videoChatUserList = $headingRoom.find('.wrtc_content.videoChat ul');\r\n\r\n\t\tshare.appendUserList(roomInfo, $videoChatUserList);\r\n\r\n\t\tvar userCount = roomInfo.present;\r\n\t\t$headingRoom.find('.videoChatCount').text(userCount);\r\n\r\n\t\tif (userCount === 0) {\r\n\t\t\t$videoChatUserList.append('<li class=\"empty\">Be the first to join the <button class=\"btn_joinChat_video\" data-action=\"JOIN\" data-id=\"' + headerId + '\" data-join=\"VIDEO\"><b>video-chat</b></button></li>');\r\n\t\t}\r\n\r\n\t\tvar user = share.getUserFromId(data.userId);\r\n\r\n\t\tif(user && data.action !== 'JOIN' && data.action !== 'RELOAD' ){\r\n\t\t\t// notify, a user join the video-chat room\r\n\t\t\tvar msg = {\r\n\t\t\t\ttime: new Date(),\r\n\t\t\t\tuserId: data.userId || user.userId,\r\n\t\t\t\tuserName: data.name || user.name || 'anonymous',\r\n\t\t\t\theaderId: data.headerId,\r\n\t\t\t\tuserCount: userCount,\r\n\t\t\t\theaderTitle: headerTitle,\r\n\t\t\t\tVIDEOCHATLIMIT: VIDEOCHATLIMIT\r\n\t\t\t};\r\n\t\t\tshare.notifyNewUserJoined('VIDEO', msg, 'LEAVE');\r\n\t\t}\r\n\r\n\t\tif (data.userId === clientVars.userId) {\r\n\t\t\t$headingRoom.removeAttr('data-video');\r\n\t\t\tshare.roomBoxIconActive();\r\n\t\t\tWRTC.deactivate(data.userId, data.headerId);\r\n\t\t\twindow.headerId = null;\r\n\r\n\t\t\tcurrentRoom = {};\r\n\r\n\t\t\t$('#wrtc_modal').css({\r\n\t\t\t\ttransform: 'translate(-50%, -100%)',\r\n\t\t\t\topacity: 0\r\n\t\t\t}).attr({ 'data-active': false });\r\n\r\n\r\n\t\t\t// WRTC.deactivate(data.userId, data.headerId);\r\n\t\t\tshare.stopStreaming(localStream);\r\n\t\t\tlocalStream = null;\r\n\t\t\tsocket.removeListener('receiveTextMessage:' + data.headerId);\r\n\t\t}\r\n\r\n\t\tif (cb && typeof cb === 'function') cb();\r\n\r\n\t\tshare.wrtcPubsub.emit('update store', data, headerId, 'LEAVE', 'VIDEO', roomInfo, function updateStore() {});\r\n\r\n\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\r\n\t\tWRTC.userLeave(data.userId)\r\n\t}\r\n\r\n\tfunction addUserToRoom(data, roomInfo) {\r\n\t\tif (!data || !data.userId) return false;\r\n\t\tvar headerId = data.headerId;\r\n\t\tvar $headingRoom = share.$body_ace_outer().find('#' + headerId);\r\n\t\tvar headerTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n\r\n\t\tvar user = share.getUserFromId(data.userId);\r\n\t\t// some user may session does exist but the user info does not available in all over the current pad\r\n\t\tif (!user) return true;\r\n\r\n\t\t// TODO: this is not good idea, use global state\r\n\t\t// if incoming user has already in the room don't persuade the request\r\n\t\tvar IsUserInRooms = $headingRoom.find(\".wrtc_content.videoChat ul li[data-id='\" + user.userId + \"']\").text();\r\n\t\tif (IsUserInRooms) return false;\r\n\r\n\t\tvar userCount = roomInfo.present;\r\n\t\t$headingRoom.find('.videoChatCount').text(userCount);\r\n\r\n\t\t$(document).find('#wrtc_textChatWrapper .textChatToolbar .userCount').text(userCount);\r\n\r\n\t\tshare.appendUserList(roomInfo, $headingRoom.find('.wrtc_content.videoChat ul'));\r\n\r\n\t\tif(data.action == 'JOIN'){\r\n\t\t\t// notify, a user join the video-chat room\r\n\t\t\tvar msg = {\r\n\t\t\t\ttime: new Date(),\r\n\t\t\t\tuserId: data.userId,\r\n\t\t\t\tuserName: user.name || data.name || 'anonymous',\r\n\t\t\t\theaderId: data.headerId,\r\n\t\t\t\tuserCount: userCount,\r\n\t\t\t\theaderTitle: headerTitle,\r\n\t\t\t\tVIDEOCHATLIMIT: VIDEOCHATLIMIT\r\n\t\t\t};\r\n\r\n\t\t\tshare.notifyNewUserJoined('VIDEO', msg, 'JOIN');\r\n\r\n\t\t\t// if (data.headerId === currentRoom.headerId && data.userId !== clientVars.userId) {\r\n\t\t\t// \t$.gritter.add({\r\n\t\t\t// \t\ttext: '<span class=\"author-name\">' + user.name + '</span>' + 'has joined the video-chat, <b><i> \"' + headerTitle + '\"</b></i>',\r\n\t\t\t// \t\tsticky: false,\r\n\t\t\t// \t\ttime: 3000,\r\n\t\t\t// \t\tposition: 'center',\r\n\t\t\t// \t\tclass_name: 'chat-gritter-msg'\r\n\t\t\t// \t});\r\n\t\t\t// }\r\n\t\t}\r\n\r\n\t\tif (data.userId === clientVars.userId) {\r\n\t\t\t$headingRoom.attr({ 'data-video': true });\r\n\t\t\tshare.roomBoxIconActive();\r\n\r\n\t\t\t$('#werc_toolbar p').attr({ 'data-id': data.headerId }).text(headerTitle);\r\n\t\t\t$(\"#werc_toolbar .btn_roomHandler\").attr({ 'data-id': data.headerId });\r\n\r\n\t\t\twindow.headerId = data.headerId;\r\n\t\t\tWRTC.activate(data.headerId, user.userId);\r\n\t\t\tcurrentRoom = data;\r\n\r\n\t\t\t$('#rtcbox').prepend('<h4 class=\"chatTitle\">' + headerTitle + '</h4>');\r\n\r\n\t\t\t$('#wrtc_modal').css({\r\n\t\t\t\ttransform: 'translate(-50%, 0)',\r\n\t\t\t\topacity: 1\r\n\t\t\t}).attr({ 'data-active': true });\r\n\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'JOIN', $joinBtn);\r\n\r\n\t\t\tsocket.on('receiveTextMessage:' + headerId, function receiveTextMessage(headingId, msg) {\r\n\t\t\t\tvar active = $(document).find('#wrtc_textChatWrapper').hasClass('active');\r\n\t\t\t\tif (headingId === headerId && !active) {\r\n\t\t\t\t\ttextChat.userJoin(headerId, data, 'TEXT');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\tshare.wrtcPubsub.emit('update store', data, headerId, 'JOIN', 'VIDEO', roomInfo, function updateStore() {});\r\n\t}\r\n\t\r\n\tfunction createSession(headerId, userInfo, $joinButton) {\r\n\t\tshare.$body_ace_outer().find('button.btn_joinChat_chatRoom').removeClass('active');\r\n\t\t$joinBtn = $joinButton;\r\n\t\tisUserMediaAvailable().then(function joining(stream) {\r\n\t\t\tlocalStream = stream;\r\n\r\n\t\t\tif (!currentRoom.userId) {\r\n\t\t\t\treturn socket.emit('userJoin', padId, userInfo, 'video', gateway_userJoin);\r\n\t\t\t}\r\n\t\t\t// If the user has already joined the video chat, make suer leave that room then join to the new chat room\r\n\t\t\tsocket.emit('userLeave', padId, currentRoom, 'video', function userLeave(_userData, roomInfo) {\r\n\t\t\t\tgateway_userLeave(_userData, roomInfo, function join2newOne() {\r\n\t\t\t\t\tsocket.emit('userJoin', padId, userInfo, 'video', gateway_userJoin);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t})['catch'](function (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\tsocket.emit('userLeave', padId, currentRoom, 'video', function userLeave(_userData, roomInfo) {\r\n\t\t\t\tgateway_userLeave(_userData, roomInfo);\r\n\t\t\t});\r\n\t\t\tWRTC.showUserMediaError(err);\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction userJoin(headerId, userInfo, $joinButton) {\r\n\t\tif (!userInfo || !userInfo.userId) {\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// check if has user already in that room\r\n\t\tif (currentRoom && currentRoom.headerId === headerId) {\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tcreateSession(headerId, userInfo, $joinButton);\r\n\t}\r\n\r\n\tfunction reloadSession(headerId, userInfo, $joinButton){\r\n\t\tif (!userInfo || !userInfo.userId) {\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tcreateSession(headerId, userInfo, $joinButton, 'RELOAD');\r\n\t}\r\n\r\n\tfunction userLeave(headerId, data, $joinButton) {\r\n\t\t$joinBtn = $joinButton;\r\n\t\tsocket.emit('userLeave', padId, data, 'video', gateway_userLeave);\r\n\t}\r\n\r\n\tfunction reachedVideoRoomSize(roomInfo, showAlert, isBulkUpdate) {\r\n\t\tif (roomInfo && roomInfo.present <= VIDEOCHATLIMIT) return true;\r\n\r\n\t\tshowAlert = showAlert || true;\r\n\t\tif (showAlert && !isBulkUpdate) {\r\n\t\t\t$.gritter.add({\r\n\t\t\t\ttitle: 'Video chat Limitation',\r\n\t\t\t\ttext: 'The video-chat room has been reached its limitation. \\r\\n <br> The size of this video-chat room is ' + VIDEOCHATLIMIT + '.',\r\n\t\t\t\tsticky: false,\r\n\t\t\t\tclass_name: 'error',\r\n\t\t\t\ttime: '5000'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction socketBulkUpdateRooms(rooms, info, target) {\r\n\t\tvar roomsInfo = {};\r\n\t\t// create a roomInfo for each individual room\r\n\t\tObject.keys(rooms).forEach(function makeRoomInfo(headerId) {\r\n\t\t\tvar roomInfo = {\r\n\t\t\t\tpresent: rooms[headerId].length,\r\n\t\t\t\tlist: rooms[headerId]\r\n\t\t\t};\r\n\t\t\troomsInfo[headerId] = roomInfo;\r\n\t\t});\r\n\r\n\t\t// bind roomInfo and send user to gateway_userJoin\r\n\t\tObject.keys(rooms).forEach(function (headerId) {\r\n\t\t\trooms[headerId].forEach(function (user) {\r\n\t\t\t\tgateway_userJoin(user, roomsInfo[headerId], true);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction bulkUpdateRooms(hTagList) {\r\n\t\tsocket.emit('bulkUpdateRooms', padId, hTagList, 'video', socketBulkUpdateRooms);\r\n\t}\r\n\r\n\t/**\r\n  *\r\n  * @param {Object} data @requires\r\n  * @param {String} data.padId @requires\r\n  * @param {String} data.userId @requires\r\n  * @param {String} data.userName @requires\r\n  * @param {String} data.headerId\r\n  *\r\n  * @param {Object} roomInfo\r\n  * @param {Boolean} showAlert\r\n  * @param {Boolean} bulkUpdate\r\n *\r\n *\t@returns\r\n  */\r\n\tfunction gateway_userJoin(data, roomInfo, showAlert, bulkUpdate) {\r\n\t\tif (!data) return reachedVideoRoomSize(null, true, false);\r\n\r\n\t\tif (data && reachedVideoRoomSize(roomInfo, showAlert, bulkUpdate)) {\r\n\t\t\treturn addUserToRoom(data, roomInfo);\r\n\t\t} else if (bulkUpdate) {\r\n\t\t\treturn addUserToRoom(data, roomInfo);\r\n\t\t}\r\n\t\tshare.stopStreaming(localStream);\r\n\t\tlocalStream = null;\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction gateway_userLeave(data, roomInfo, cb) {\r\n\t\tremoveUserFromRoom(data, roomInfo, cb);\r\n\t}\r\n\r\n\tfunction postAceInit(hook, context, webSocket, docId) {\r\n\t\tsocket = webSocket;\r\n\t\tpadId = docId;\r\n\t\tVIDEOCHATLIMIT = clientVars.webrtc.videoChatLimit;\r\n\t\tshare.wrtcPubsub.emit('component status', 'video', true)\r\n\t\tmediaDevices();\r\n\t}\r\n\r\n\treturn {\r\n\t\tpostAceInit: postAceInit,\r\n\t\tuserJoin: userJoin,\r\n\t\tuserLeave: userLeave,\r\n\t\tgateway_userJoin: gateway_userJoin,\r\n\t\tgateway_userLeave: gateway_userLeave,\r\n\t\tbulkUpdateRooms: bulkUpdateRooms,\r\n\t\treloadSession: reloadSession\r\n\t};\r\n})();\r\n","'use strict';\r\n\r\nvar WRTC_Room = (function WRTC_Room() {\r\n\tvar self = null;\r\n\tvar socket = null;\r\n\tvar padId = null;\r\n\tvar VIDEOCHATLIMIT = 0;\r\n\t// var $lastJoinButton = null;\r\n\tvar prefixHeaderId = 'headingTagId_';\r\n\tvar hElements = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', '.h1', '.h2', '.h3', '.h4', '.h5', '.h6'];\r\n\r\n\t/** --------- Helper --------- */\r\n\r\n\tfunction link2Clipboard(text) {\r\n\t\tvar $temp = $('<input>');\r\n\t\t$('body').append($temp);\r\n\t\t$temp.val(text).select();\r\n\t\tdocument.execCommand('copy');\r\n\t\t$temp.remove();\r\n\t\t$.gritter.add({\r\n\t\t\ttitle: 'Copied',\r\n\t\t\ttext: 'Join link copied to clip board',\r\n\t\t\tsticky: false,\r\n\t\t\tclass_name: 'copyLinkToClipboard',\r\n\t\t\ttime: '3000'\r\n\t\t});\r\n\t}\r\n\r\n\tfunction scroll2Header(headerId) {\r\n\t\tvar padContainer = share.$body_ace_outer().find('iframe').contents().find('#innerdocbody');\r\n\t\tpadContainer.find('.' + prefixHeaderId + headerId).each(function scrolling() {\r\n\t\t\tthis.scrollIntoView({\r\n\t\t\t\tbehavior: 'smooth'\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction closeTextChat () {\r\n\t\t$('#wrtc_textChatWrapper .btn_leave').trigger('click');\r\n\t}\r\n\r\n\tfunction joinChatRoom(headerId, userInfo, target) {\r\n\t\t// textChat.userJoin(headerId, userInfo, 'TEXTPLUS');\r\n\t\tvideoChat.userJoin(headerId, userInfo, 'PLUS');\r\n\t\tcloseTextChat();\r\n\t}\r\n\t\r\n\tfunction leaveChatRoom(headerId, userInfo, target) {\r\n\t\t// textChat.userLeave(headerId, userInfo, 'TEXTPLUS');\r\n\t\tvideoChat.userLeave(headerId, userInfo, 'PLUS');\r\n\t\tcloseTextChat();\r\n\t}\r\n\r\n\t/**\r\n  *\r\n  * @param {string} actions @enum (JOIN|LEAVE)\r\n  * @param {string} headerId\r\n  * @param {string} target @enum (chatRoom|video|text)\r\n  */\r\n\tfunction roomBtnHandler(actions, headerId, target) {\r\n\t\tif(typeof actions !== 'string') {\r\n\t\t\tactions.preventDefault();\r\n\t\t\t// actions.stopPropagation();\r\n\t\t}\r\n\t\theaderId = $(this).attr('data-id') || headerId;\r\n\t\tactions = $(this).attr('data-action') || actions;\r\n\t\ttarget = $(this).attr('data-join') || target;\r\n\r\n\t\tif (!headerId || !target ) return true;\r\n\r\n\t\tvar $joinBtn = $(this);\r\n\r\n\t\tvar userInfo = {\r\n\t\t\tpadId: clientVars.padId || window.pad.getPadId(),\r\n\t\t\tuserId: clientVars.userId || window.pad.getUserId(),\r\n\t\t\tuserName: clientVars.userName || 'anonymous',\r\n\t\t\theaderId: headerId,\r\n\t\t\ttarget: target,\r\n\t\t\taction: actions\r\n\t\t};\r\n\r\n\t\tshare.wrtcPubsub.emit('disable room buttons', headerId, actions, target);\r\n\r\n\t\tif (actions === 'JOIN') {\r\n\t\t\tswitch (target) {\r\n\t\t\t\tcase 'PLUS':\r\n\t\t\t\t\tjoinChatRoom(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'VIDEO':\r\n\t\t\t\t\tvideoChat.userJoin(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'TEXT':\r\n\t\t\t\t\ttextChat.userJoin(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} else if (actions === 'LEAVE') {\r\n\t\t\tswitch (target) {\r\n\t\t\t\tcase 'PLUS':\r\n\t\t\t\t\tleaveChatRoom(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'VIDEO':\r\n\t\t\t\t\tvideoChat.userLeave(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'TEXT':\r\n\t\t\t\t\ttextChat.userLeave(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} else if(actions === 'RELOAD') {\r\n\t\t\tvideoChat.reloadSession(headerId, userInfo, target, actions);\r\n\t\t} else if(actions === 'SHARELINK') {\r\n\t\t\tshareRoomsLink(headerId, target);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction joinByQueryString() {\r\n\t\tvar urlParams = new URLSearchParams(window.location.search);\r\n\t\tvar headerId = urlParams.get('id');\r\n\t\tvar target = urlParams.get('target');\r\n\t\tvar join = urlParams.get('join');\r\n\r\n\t\tif(!headerId) return true;\r\n\r\n\t\tvar isHeading = share.$body_ace_outer().find('#' + headerId);\r\n\r\n\t\tif(!isHeading.length){\r\n\t\t\t$.gritter.add({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\ttext: \"The header seems not to exist anymore!\",\r\n\t\t\t\ttime: 3000,\r\n\t\t\t\tsticky: false,\r\n\t\t\t\tclass_name: 'error'\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (headerId) {\r\n\t\t\tscroll2Header(headerId);\r\n\t\t}\r\n\t\tif (join === 'true') {\r\n\t\t\ttarget = target.toUpperCase();\r\n\t\t\tsetTimeout(function makeSureHeadingReady() {\r\n\t\t\t\troomBtnHandler('JOIN', headerId, target);\r\n\t\t\t}, 700);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction shareRoomsLink(headId, target) {\r\n\t\theadId = $(this).attr('data-id') || headId;\r\n\t\ttarget = $(this).attr('data-join') || target;\r\n\t\tvar title = share.$body_ace_outer().find('.wbrtc_roomBox.' + headId + ' .titleRoom').text();\r\n\r\n\t\tvar origin = window.location.origin;\r\n\t\tvar pathName = window.location.pathname;\r\n\t\tvar link = origin + pathName + '?header=' + share.slugify(title) + '&id=' + headId + '&target=' + target + '&join=true';\r\n\r\n\t\tvar $temp = $('<input>');\r\n\t\t$('body').append($temp);\r\n\t\t$temp.val(link).select();\r\n\t\tdocument.execCommand('copy');\r\n\t\t$temp.remove();\r\n\r\n\t\t$.gritter.add({\r\n\t\t\ttitle: 'Copied',\r\n\t\t\ttext: 'Join link copied to clip board',\r\n\t\t\tsticky: false,\r\n\t\t\tclass_name: 'copyLinkToClipboard',\r\n\t\t\ttime: '3000'\r\n\t\t});\r\n\t}\r\n\r\n\tfunction getHeaderRoomY($element) {\r\n\t\tvar height = $element.outerHeight();\r\n\t\tvar paddingTop = share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').css('padding-top');\r\n\t\tvar aceOuterPadding = parseInt(paddingTop, 10);\r\n\t\tvar offsetTop = Math.ceil($element.offset().top + aceOuterPadding);\r\n\t\treturn offsetTop + height / 2 - 31;\r\n\t}\r\n\r\n\tfunction getHeaderRoomX($element) {\r\n\t\tvar width = $element.outerWidth();\r\n\t\tvar paddingLeft = share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').css('padding-left');\r\n\t\tvar aceOuterPadding = parseInt(paddingLeft, 10);\r\n\t\tvar offsetLeft = Math.ceil(share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').offset().left - aceOuterPadding);\r\n\t\treturn offsetLeft - width - 6;\r\n\t}\r\n\r\n\tfunction activeEventListener() {\r\n\t\tvar $wbrtc_roomBox = share.$body_ace_outer();\r\n\r\n\t\t$wbrtc_roomBox.on('click', '.wbrtc_roomBox .btn_joinChat_text', roomBtnHandler);\r\n\t\t$wbrtc_roomBox.on('click', '.wbrtc_roomBox .btn_joinChat_video', roomBtnHandler);\r\n\t\t$wbrtc_roomBox.on('click', '.wbrtc_roomBox .btn_joinChat_chatRoom', roomBtnHandler);\r\n\r\n\t\t$(document).on('click', '#chattext .wrtc_roomLink', roomBtnHandler);\r\n\r\n\t\t$(document).on('click', '#werc_toolbar .btn_roomHandler, .btn_controllers .btn_roomHandler', roomBtnHandler);\r\n\r\n\t\t// ep_full_hyperlinks link listner\r\n\t\t$wbrtc_roomBox.on('click', 'a.btn_roomHandler', roomBtnHandler)\r\n\t\t$(document).on('click', 'a.btn_roomHandler', roomBtnHandler)\r\n\t\t// share.$body_ace_outer().on('mouseenter', '.wbrtc_roomBox', function mouseenter() {\r\n\t\t// \t$(this).parent().css({ overflow: 'initial' });\r\n\t\t// \t$(this).addClass('active').find('.wrtc_contentBody').css({ display: 'block' });\r\n\t\t// }).on('mouseleave', '.wbrtc_roomBox', function mouseleave() {\r\n\t\t// \t$(this).parent().css({ overflow: 'hidden' });\r\n\t\t// \t$(this).removeClass('active').find('.wrtc_contentBody').css({ display: 'none' });\r\n\t\t// });\r\n\r\n\t\tshare.$body_ace_outer().on('click', '.wbrtc_roomBoxFooter > button.btn_share', function click() {\r\n\t\t\tvar headerURI = $(this).find('input').val();\r\n\t\t\tlink2Clipboard(headerURI);\r\n\t\t});\r\n\r\n\t\t// share.$body_ace_outer().on('mouseenter', '.wrtc_roomInlineAvatar .avatar', function mouseenter() {\r\n\t\t// \tvar id = $(this).parent().parent().attr('id');\r\n\t\t// \tshare.$body_ace_outer().find('#' + id + '.wbrtc_roomBox').trigger('mouseenter');\r\n\t\t// }).on('mouseleave', '.wrtc_roomInlineAvatar .avatar', function mouseleave() {\r\n\t\t// \tvar id = $(this).parent().parent().attr('id');\r\n\t\t// \tshare.$body_ace_outer().find('#' + id + '.wbrtc_roomBox').trigger('mouseleave');\r\n\t\t// });\r\n\r\n\t\t$(document).on('click', '#werc_toolbar p, .textChatToolbar b', function click() {\r\n\t\t\tvar headerId = $(this).attr('data-id');\r\n\t\t\tscroll2Header(headerId);\r\n\t\t});\r\n\r\n\t\t$(document).on('click', '#werc_toolbar .btn_enlarge', function click() {\r\n\t\t\tif (!$(this).attr('active')) return true;\r\n\r\n\t\t\t$(this).toggleClass('large');\r\n\r\n\t\t\t$('#wrtc_modal .video-container .enlarge-btn').each(function trigger() {\r\n\t\t\t\t$(this).trigger('click');\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// video interface settings\r\n\t\t$(document).on('click', '#werc_toolbar .btn_videoSetting', function click() {\r\n\t\t\tvar offset = $(this).position();\r\n\t\t\tvar $box = $(document).find('#wrtc_settings');\r\n\t\t\tvar width = $box.outerWidth();\r\n\t\t\t$box.css({left: offset.left - width  + 'px',top: offset.top + 4 + 'px'}).toggleClass('active');\r\n\t\t});\r\n\t}\r\n\r\n\tself = {\r\n\t\tgetHeaderRoomX: getHeaderRoomX,\r\n\t\taceSetAuthorStyle: function aceSetAuthorStyle(context) {\r\n\t\t\tif (context.author) {\r\n\t\t\t\tvar user = share.getUserFromId(context.author);\r\n\t\t\t\tif (user) {\r\n\t\t\t\t\t// sync user info\r\n\t\t\t\t\tshare.$body_ace_outer().find(\".wrtc_content.textChat ul li[data-id='\" + user.userId + \"']\").css({ 'border-color': user.colorId }).text(user.name);\r\n\t\t\t\t\tshare.$body_ace_outer().find(\".wrtc_content.videoChat ul li[data-id='\" + user.userId + \"']\").css({ 'border-color': user.colorId }).text(user.name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserLeave: function userLeave(context, callback) {\r\n\t\t\t// Deprecated, we use socket disconnect\r\n\r\n\t\t\tcallback();\r\n\t\t},\r\n\t\tbulkUpdateRooms: function bulkUpdateRooms(hTagList) {\r\n\t\t\tvideoChat.bulkUpdateRooms(hTagList);\r\n\t\t\ttextChat.bulkUpdateRooms(hTagList);\r\n\t\t},\r\n\t\tpostAceInit: function postAceInit(hook, context, webSocket, docId) {\r\n\t\t\tsocket = webSocket;\r\n\t\t\tpadId = docId;\r\n\t\t\tVIDEOCHATLIMIT = clientVars.webrtc.videoChatLimit;\r\n\t\t\tshare.wrtcPubsub.emit('component status', 'room', true)\r\n\r\n\t\t\tsocket.on('userJoin', function (data, roomInfo, target) {\r\n\t\t\t\tif (target === 'video') {\r\n\t\t\t\t\tvideoChat.gateway_userJoin(data, roomInfo, false);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttextChat.addUserToRoom(data, roomInfo, target);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tsocket.on('userLeave', function (data, roomInfo, target) {\r\n\t\t\t\tif (target === 'video') {\r\n\t\t\t\t\tvideoChat.gateway_userLeave(data, roomInfo, target);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttextChat.removeUserFromRoom(data, roomInfo, target);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tactiveEventListener();\r\n\r\n\t\t\t// check if there is a join request in URI queryString\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tjoinByQueryString();\r\n\t\t\t}, 500);\r\n\t\t},\r\n\t\tadoptHeaderYRoom: function adoptHeaderYRoom() {\r\n\t\t\t// Set all video_heading to be inline with their target REP\r\n\t\t\tvar $padOuter = share.$body_ace_outer();\r\n\t\t\tif (!$padOuter) return;\r\n\r\n\t\t\t$padOuter.find('.wbrtc_roomBox, .wrtc_roomInlineAvatar ').each(function adjustHeaderIconPosition() {\r\n\t\t\t\tvar $el = $(this);\r\n\t\t\t\tvar $boxId = $el.attr('id');\r\n\t\t\t\tvar hClassId = 'headingTagId_' + $boxId;\r\n\t\t\t\tvar $headingEl = $padOuter.find('iframe').contents().find('#innerdocbody').find('.' + hClassId);\r\n\r\n\t\t\t\t// if the H tags does not find, remove chatBox\r\n\t\t\t\t// TODO: and kick out the user form the chatBox\r\n\t\t\t\tif ($headingEl.length <= 0) {\r\n\t\t\t\t\t$el.remove();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($el.attr('data-box') === 'avatar') $el.css({ left: getHeaderRoomX($el) + 'px' });\r\n\t\t\t\t$el.css({ top: getHeaderRoomY($headingEl) + 'px' });\r\n\t\t\t});\r\n\t\t},\r\n\t\tfindTags: function findTags() {\r\n\t\t\tvar components = share.wrtcStore.components;\r\n\t\t\tif(!components.text.active && !components.video.active && !components.room.active) return false;\r\n\t\t\tvar hTagList = [];\r\n\t\t\tvar hTagElements = hElements;\r\n\t\t\tvar hTags = share.$body_ace_outer().find('iframe').contents().find('#innerdocbody').children('div').children(hTagElements);\r\n\t\t\tvar aceInnerOffset = share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').offset();\r\n\t\t\tvar target = share.$body_ace_outer().find('#outerdocbody');\r\n\t\t\tvar newHTagAdded = false;\r\n\r\n\t\t\t$(hTags).each(function createWrtcRoomBox() {\r\n\t\t\t\tvar $el = $(this);\r\n\t\t\t\t// var lineNumber = $el.parent().prevAll().length;\r\n\t\t\t\t// var tag = $(\"#title\")[0].tagName.toLowerCase();\r\n\t\t\t\tvar newY = getHeaderRoomY($el);\r\n\t\t\t\tvar newX = Math.ceil(aceInnerOffset.left);\r\n\t\t\t\tvar headingTagId = $el.find('span').attr('class');\r\n\t\t\t\theadingTagId = /(?:^| )headingTagId_([A-Za-z0-9]*)/.exec(headingTagId);\r\n\r\n\t\t\t\tif (!headingTagId) {\r\n\t\t\t\t\tconsole.warn(\"[wrtc]: couldn't find headingTagId.\")\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar data = {\r\n\t\t\t\t\theadingTagId: headingTagId[1],\r\n\t\t\t\t\t// tag: tag,\r\n\t\t\t\t\tpositionTop: newY,\r\n\t\t\t\t\tpositionLeft: newX,\r\n\t\t\t\t\theadTitle: $el.text(),\r\n\t\t\t\t\t// lineNumber: lineNumber,\r\n\t\t\t\t\tvideoChatLimit: VIDEOCHATLIMIT\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (!share.wrtcStore[data.headingTagId]) share.wrtcStore[data.headingTagId] = { VIDEO: { list: [] }, TEXT: { list: [] }, USERS: {} };\r\n\r\n\t\t\t\t// if the header does not exists then adde to list\r\n\t\t\t\t// otherwise update textHeader\r\n\t\t\t\t// TODO: performance issue\r\n\t\t\t\tif (target.find('#' + data.headingTagId).length <= 0) {\r\n\t\t\t\t\tvar box = $('#wertc_roomBox').tmpl(data);\r\n\t\t\t\t\ttarget.find('#wbrtc_chatBox').append(box);\r\n\t\t\t\t\tvar avatarBox = $('#wertc_inlineAvatar').tmpl(data);\r\n\t\t\t\t\ttarget.find('#wbrtc_avatarCol').append(avatarBox);\r\n\t\t\t\t\tnewHTagAdded = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(document).find('[data-headid=' + data.headingTagId + '].wrtc_text .wrtc_roomLink, #werc_toolbar p[data-id=' + data.headingTagId + ']').text(data.headTitle);\r\n\t\t\t\t\ttarget.find('.wbrtc_roomBox[id=' + data.headingTagId + '] .titleRoom').text(data.headTitle);\r\n\t\t\t\t\t$(document).find('#wrtc_textChatWrapper[data-id=' + data.headingTagId + '] .nd_title b').text(data.headTitle);\r\n\t\t\t\t}\r\n\r\n\t\t\t\thTagList.push(data);\r\n\t\t\t});\r\n\t\t\t// if a new h tag addedd check all heading again!\r\n\t\t\tif (newHTagAdded) {\r\n\t\t\t\tself.bulkUpdateRooms(hTagList);\r\n\t\t\t\tnewHTagAdded = false;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn self;\r\n})();\r\n","/**\r\n * Copyright 2013 j <j@mailb.org>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n'use strict';\r\n\r\nvar WRTC = (function WRTC() {\r\n\tvar attemptRonnect = 50;\r\n\tvar reconnected = 0;\r\n\tvar videoSizes = { large: '260px', small: '160px' };\r\n\tvar pcConfig = {};\r\n\tvar audioInputSelect = null;\r\n\tvar videoSelect = null;\r\n\tvar audioOutputSelect = null;\r\n\tvar pcConstraints = {\r\n\t\toptional: [{\r\n\t\t\tDtlsSrtpKeyAgreement: true\r\n\t\t}]\r\n\t};\r\n\tvar sdpConstraints = {\r\n\t\tmandatory: {\r\n\t\t\tOfferToReceiveAudio: true,\r\n\t\t\tOfferToReceiveVideo: true\r\n\t\t}\r\n\t};\r\n\tvar localStream = null;\r\n\tvar remoteStream = {};\r\n\tvar pc = {};\r\n\tvar callQueue = [];\r\n\tvar enlargedVideos = new Set();\r\n\tvar localVideoElement = null;\r\n\tvar padId = null;\r\n\tvar socket = null;\r\n\r\n\tvar self = {\r\n\t\t// API HOOKS\r\n\t\tpostAceInit: function postAceInit(hook, context, webSocket,docId) {\r\n\t\t\tpadId = docId;\r\n\t\t\tsocket = webSocket;\r\n\r\n\t\t\tpcConfig.iceServers = clientVars.webrtc && clientVars.webrtc.iceServers ? clientVars.webrtc.iceServers : [{\r\n\t\t\t\turl: 'stun:stun.l.google.com:19302'\r\n\t\t\t}];\r\n\t\t\tif (clientVars.webrtc.video.sizes.large) {\r\n\t\t\t\tvideoSizes.large = clientVars.webrtc.video.sizes.large + 'px';\r\n\t\t\t}\r\n\t\t\tif (clientVars.webrtc.video.sizes.small) {\r\n\t\t\t\tvideoSizes.small = clientVars.webrtc.video.sizes.small + 'px';\r\n\t\t\t}\r\n\r\n\t\t\tself._pad = context.pad || window.pad;\r\n\r\n\t\t\t$(document).on('change', 'select#audioSource', self.audioVideoInputChange);\r\n\t\t\t$(document).on('change', 'select#videoSource', self.audioVideoInputChange);\r\n\t\t\t$(document).on('change', 'select#audioOutput', self.changeAudioDestination);\r\n\r\n\t\t\t$(window).on('unload', function () {\r\n\t\t\t\tconsole.info(\"[wrtc]: windos unloaded, now hangupAll\")\r\n\t\t\t\tself.hangupAll();\r\n\t\t\t});\r\n\r\n\t\t},\r\n\t\tappendInterfaceLayout: function appendInterfaceLayout() {\r\n\t\t\t// TODO: legacy code, move it to template\r\n\t\t\tvar werc_toolbar = $('#wertc_modal_toolbar').tmpl({\r\n\t\t\t\tvideoChatLimit: clientVars.webrtc.videoChatLimit,\r\n\t\t\t\theaderId: ''\r\n\t\t\t});\r\n\t\t\tvar $wrtc_modal = $('<div id=\"wrtc_modal\"><div class=\"videoWrapper\" class=\"thin-scrollbar\"></div></div');\r\n\t\t\t$wrtc_modal.append(werc_toolbar);\r\n\t\t\t$('body').prepend($wrtc_modal);\r\n\t\t\t$(document).on('click', '#wrtc_modal .btn_toggle_modal', function () {\r\n\t\t\t\tvar $parent = $(this).parent().parent();\r\n\t\t\t\tvar action = $(this).attr('data-action');\r\n\t\t\t\tvar videoBox = $('#wrtc_modal .videoWrapper').innerHeight();\r\n\r\n\t\t\t\t$(this).find('.fa_arrow-from-top').toggle();\r\n\t\t\t\t$(this).find('.fa_arrow-to-top').toggle();\r\n\r\n\t\t\t\tif (action === 'collapse') {\r\n\t\t\t\t\t$(this).attr({ 'data-action': 'expand' });\r\n\t\t\t\t\t$parent.find('.btn_enlarge').removeAttr('active');\r\n\t\t\t\t\t$('#wrtc_modal').css({\r\n\t\t\t\t\t\ttransform: 'translate(-50%, -' + videoBox + 'px)'\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(this).attr({ 'data-action': 'collapse' });\r\n\t\t\t\t\t$parent.find('.btn_enlarge').attr({ active: true });\r\n\t\t\t\t\t$('#wrtc_modal').css({\r\n\t\t\t\t\t\ttransform: 'translate(-50%, 0)'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$(document).on('click', '#wrtc_settings .btn_info', function click() {\r\n\t\t\t\tvar userID = Object.keys(pc)\r\n\t\t\t\tvar $this =  $(this)\r\n\t\t\t\tvar isActive = $this.attr('data-active')\r\n\t\t\t\tvar $modal = $(document).find(\"#wrtc_settings .wrtc_info\")\r\n\r\n\t\t\t\tif(isActive){\r\n\t\t\t\t\t$modal.hide();\r\n\t\t\t\t\tif(pc[userID[0]]){\r\n\t\t\t\t\t\tgetStats(pc[userID[0]], function(result) {\r\n\t\t\t\t\t\t\tresult.nomore();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$this.removeAttr(\"data-active\")\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$this.attr({'data-active': true})\r\n\t\t\t\t\t$modal.show()\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(pc[userID[0]] && !isActive){\r\n\t\t\t\t\tfunction bytesToSize(bytes) {\r\n\t\t\t\t\t\t\tvar k = 1000;\r\n\t\t\t\t\t\t\tvar sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\r\n\t\t\t\t\t\t\tif (bytes <= 0) {\r\n\t\t\t\t\t\t\t\t\treturn '0 Bytes';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar i = parseInt(Math.floor(Math.log(bytes) / Math.log(k)), 10);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif(!sizes[i]) {\r\n\t\t\t\t\t\t\t\t\treturn '0 Bytes';\r\n\t\t\t\t\t\t\t}\r\n\t\t\r\n\t\t\t\t\t\t\treturn (bytes / Math.pow(k, i)).toPrecision(3) + ' ' + sizes[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgetStats(pc[userID[0]], function(result) {\r\n\t\t\t\t\t\t\tconst statistic ={\r\n\t\t\t\t\t\t\t\t\"speed\": bytesToSize(result.bandwidth.speed),\r\n\t\t\t\t\t\t\t\t\"systemNetworkType\": result.connectionType.systemNetworkType,\r\n\t\t\t\t\t\t\t\t\"availableSendBandwidth\": bytesToSize(result.bandwidth.availableSendBandwidth),\r\n\t\t\t\t\t\t\t\t\"video\": {\r\n\t\t\t\t\t\t\t\t\t\"send.codecs\": result.video.send.codecs.join(\", \"),\r\n\t\t\t\t\t\t\t\t\t\"resolutions\": \"width \" + result.resolutions.send.width + \", height \" + result.resolutions.send.height,\r\n\t\t\t\t\t\t\t\t\t\"resolutions\": \"width \" + result.resolutions.recv.width + \", height \" + result.resolutions.recv.height,\r\n\t\t\t\t\t\t\t\t\t\"bytesSent\": bytesToSize(result.video.bytesSent),\r\n\t\t\t\t\t\t\t\t\t\"bytesReceived\": bytesToSize(result.video.bytesReceived)\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\"audio\":{\r\n\t\t\t\t\t\t\t\t\t\"send.codecs\": result.audio.send.codecs.join(\", \"),\r\n\t\t\t\t\t\t\t\t\t// \"recv.codecs\": result.audio.recv.codecs.join(\", \"),\r\n\t\t\t\t\t\t\t\t\t\"bytesSent\": bytesToSize(result.audio.bytesSent),\r\n\t\t\t\t\t\t\t\t\t\"bytesReceived\": bytesToSize(result.audio.bytesReceived)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$(document).find(\"#wrtc_settings .wrtc_info\").html(`<pre>${JSON.stringify(statistic, undefined, 2)}</pre>`)\r\n\t\t\t\t\t}, 1000);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t$(document).on('click', '#wrtc_settings .btn_close', function click() {\r\n\t\t\t\t$('#wrtc_settings').toggleClass('active');\r\n\t\t\t\tvar $btnInfo = $(\"#wrtc_settings .btn_info\")\r\n\t\t\t\tif($btnInfo.attr('data-active')) $btnInfo.trigger(\"click\")\r\n\t\t\t});\r\n\t\t},\r\n\t\taceSetAuthorStyle: function aceSetAuthorStyle(context) {\r\n\t\t\tif (context.author) {\r\n\t\t\t\tvar user = self.getUserFromId(context.author);\r\n\t\t\t\tif (user) {\r\n\t\t\t\t\t$('#video_' + user.userId.replace(/\\./g, '_')).css({\r\n\t\t\t\t\t\t'border-color': user.colorId\r\n\t\t\t\t\t}).siblings('.user-name').text(user.name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserLeave: function userLeave(userId, context, callback) {\r\n\t\t\tuserId = userId || context.userInfo.userId;\r\n\t\t\tif (userId && pc[userId]) {\r\n\t\t\t\tgState = \"LEAVING\"\r\n\t\t\t\tself.hide(userId)\r\n\t\t\t\tself.hangup(userId, true);\r\n\t\t\t}\r\n\t\t\tif(callback) callback();\r\n\t\t},\r\n\t\thandleClientMessage_RTC_MESSAGE: function handleClientMessage_RTC_MESSAGE(hook, context) {\r\n\t\t\tif (context.payload.data.headerId === window.headerId) self.receiveMessage(context.payload);\r\n\t\t},\r\n\t\t// END OF API HOOKS\r\n\t\tshow: function show() {\r\n\t\t\t$('#pad_title').addClass('f_wrtcActive');\r\n\t\t},\r\n\t\tshowUserMediaError: function showUserMediaError(err) {\r\n\t\t\t// show an error returned from getUserMedia\r\n\t\t\tvar reason;\r\n\t\t\t// For reference on standard errors returned by getUserMedia:\r\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\r\n\t\t\t// However keep in mind that we add our own errors in getUserMediaPolyfill\r\n\t\t\tswitch (err.name) {\r\n\t\t\t\tcase 'CustomNotSupportedError':\r\n\t\t\t\t\treason = 'Sorry, your browser does not support WebRTC. (or you have it disabled in your settings).<br><br>' + 'To participate in this audio/video chat you have to user a browser with WebRTC support like Chrome, Firefox or Opera.' + '<a href=\"http://www.webrtc.org/\" target=\"_new\">Find out more</a>';\r\n\t\t\t\t\tself.sendErrorStat('NotSupported');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'CustomSecureConnectionError':\r\n\t\t\t\t\treason = 'Sorry, you need to install SSL certificates for your Etherpad instance to use WebRTC';\r\n\t\t\t\t\tself.sendErrorStat('SecureConnection');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'NotAllowedError':\r\n\t\t\t\t\t// For certain (I suspect older) browsers, `NotAllowedError` indicates either an insecure connection or the user rejecting camera permissions.\r\n\t\t\t\t\t// The error for both cases appears to be identical, so our best guess at telling them apart is to guess whether we are in a secure context.\r\n\t\t\t\t\t// (webrtc is considered secure for https connections or on localhost)\r\n\t\t\t\t\tif (location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1') {\r\n\t\t\t\t\t\treason = 'Sorry, you need to give us permission to use your camera and microphone';\r\n\t\t\t\t\t\tself.sendErrorStat('Permission');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treason = 'Sorry, you need to install SSL certificates for your Etherpad instance to use WebRTC';\r\n\t\t\t\t\t\tself.sendErrorStat('SecureConnection');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'NotFoundError':\r\n\t\t\t\t\treason = \"Sorry, we couldn't find a suitable camera on your device. If you have a camera, make sure it set up correctly and refresh this website to retry.\";\r\n\t\t\t\t\tself.sendErrorStat('NotFound');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'NotReadableError':\r\n\t\t\t\t\t// `err.message` might give useful info to the user (not necessarily useful for other error messages)\r\n\t\t\t\t\treason = 'Sorry, a hardware error occurred that prevented access to your camera and/or microphone:<br><br>' + err.message;\r\n\t\t\t\t\tself.sendErrorStat('Hardware');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'AbortError':\r\n\t\t\t\t\t// `err.message` might give useful info to the user (not necessarily useful for other error messages)\r\n\t\t\t\t\treason = 'Sorry, an error occurred (probably not hardware related) that prevented access to your camera and/or microphone:<br><br>' + err.message;\r\n\t\t\t\t\tself.sendErrorStat('Abort');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t// `err` as a string might give useful info to the user (not necessarily useful for other error messages)\r\n\t\t\t\t\treason = 'Sorry, there was an unknown Error:<br><br>' + err;\r\n\t\t\t\t\tself.sendErrorStat('Unknown');\r\n\t\t\t}\r\n\t\t\t$.gritter.add({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\ttext: reason,\r\n\t\t\t\tsticky: true,\r\n\t\t\t\tclass_name: 'error'\r\n\t\t\t});\r\n\t\t\tself.hide();\r\n\t\t},\r\n\t\thide: function hide(userId) {\r\n\t\t\tif (!userId) return false;\r\n\t\t\tuserId = userId.split('.')[1];\r\n\t\t\t$('#rtcbox').find('#video_a_' + userId).parent().remove();\r\n\t\t},\r\n\t\tactivate: function activate(headerId) {\r\n\t\t\tself.show();\r\n\t\t\tself.hangupAll();\r\n\t\t\tself.getUserMedia(headerId);\r\n\t\t},\r\n\t\tdeactivate: function deactivate(userId, headerId) {\r\n\t\t\tif (!userId) return false;\r\n\t\t\tself.hide(userId);\r\n\t\t\tself.hangupAll(headerId);\r\n\t\t\tself.hangup(userId, true, headerId);\r\n\t\t\tif (localStream) {\r\n\t\t\t\tshare.stopStreaming(localStream);\r\n\t\t\t\tlocalStream = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\ttoggleMuted: function toggleMuted() {\r\n\t\t\tvar audioTrack = localStream.getAudioTracks();\r\n\t\t\tif (audioTrack) {\r\n\t\t\t\taudioTrack.enabled = !audioTrack.enabled;\r\n\t\t\t\treturn !audioTrack.enabled;\r\n\t\t\t}\r\n\t\t},\r\n\t\ttoggleVideo: function toggleVideo() {\r\n\t\t\tvar videoTrack = localStream.getVideoTracks()[0];\r\n\t\t\tif (videoTrack) {\r\n\t\t\t\tvideoTrack.enabled = !videoTrack.enabled;\r\n\t\t\t\treturn !videoTrack.enabled;\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetUserFromId: function getUserFromId(userId) {\r\n\t\t\tif (!self._pad || !self._pad.collabClient) return null;\r\n\t\t\tvar result = self._pad.collabClient.getConnectedUsers().filter(function (user) {\r\n\t\t\t\treturn user.userId === userId;\r\n\t\t\t});\r\n\t\t\tvar user = result.length > 0 ? result[0] : null;\r\n\t\t\treturn user;\r\n\t\t},\r\n\t\tsetStream: function setStream(userId, stream) {\r\n\t\t\tif (!userId) return false;\r\n\t\t\tvar isLocal = userId === share.getUserId();\r\n\t\t\tvar videoId = 'video_' + userId.replace(/\\./g, '_');\r\n\t\t\tvar video = $('#' + videoId)[0];\r\n\r\n\t\t\tvar user = self.getUserFromId(userId);\r\n\r\n\t\t\tif (!video && stream) {\r\n\t\t\t\tvar videoContainer = $(\"<div class='video-container'>\").css({\r\n\t\t\t\t\twidth: videoSizes.small,\r\n\t\t\t\t\t'max-height': videoSizes.small\r\n\t\t\t\t}).appendTo($('#wrtc_modal .videoWrapper'));\r\n\r\n\t\t\t\tvideoContainer.append($('<div class=\"user-name\">').text(user.name));\r\n\r\n\t\t\t\tvideo = $('<video playsinline>').attr('id', videoId).css({\r\n\t\t\t\t\t'border-color': user.colorId,\r\n\t\t\t\t\twidth: videoSizes.small,\r\n\t\t\t\t\t'max-height': videoSizes.small\r\n\t\t\t\t}).on({\r\n\t\t\t\t\tloadedmetadata: function loadedmetadata() {\r\n\t\t\t\t\t\tself.addInterface(userId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).appendTo(videoContainer)[0];\r\n\r\n\t\t\t\tvideo.autoplay = true;\r\n\t\t\t\tif (isLocal) {\r\n\t\t\t\t\tvideoContainer.addClass('local-user');\r\n\t\t\t\t\tvideo.muted = true;\r\n\t\t\t\t}\r\n\t\t\t\tself.addInterface(userId);\r\n\t\t\t}\r\n\t\t\tif (stream) {\r\n\t\t\t\tattachMediaStream(video, stream);\r\n\t\t\t} else if (video) {\r\n\t\t\t\t$(video).parent().remove();\r\n\t\t\t}\r\n\t\t},\r\n\t\taddInterface: function addInterface(userId) {\r\n\t\t\tif (!userId) return false;\r\n\t\t\tvar isLocal = userId === share.getUserId();\r\n\t\t\tvar videoId = 'video_' + userId.replace(/\\./g, '_');\r\n\t\t\tvar $video = $('#' + videoId);\r\n\r\n\t\t\tvar $mute = $(\"<span class='interface-btn audio-btn buttonicon'>\").attr('title', 'Mute').on({\r\n\t\t\t\tclick: function click() {\r\n\t\t\t\t\tvar muted;\r\n\t\t\t\t\tif (isLocal) {\r\n\t\t\t\t\t\tmuted = self.toggleMuted();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$video[0].muted = !$video[0].muted;\r\n\t\t\t\t\t\tmuted = $video[0].muted;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$mute.attr('title', muted ? 'Unmute' : 'Mute').toggleClass('muted', muted);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tvar videoEnabled = true;\r\n\t\t\tvar $disableVideo = isLocal ? $(\"<span class='interface-btn video-btn buttonicon'>\").attr('title', 'Disable video').on({\r\n\t\t\t\tclick: function click() {\r\n\t\t\t\t\tself.toggleVideo();\r\n\t\t\t\t\tvideoEnabled = !videoEnabled;\r\n\t\t\t\t\t$disableVideo.attr('title', videoEnabled ? 'Disable video' : 'Enable video').toggleClass('off', !videoEnabled);\r\n\t\t\t\t}\r\n\t\t\t}) : null;\r\n\r\n\t\t\tvar videoEnlarged = false;\r\n\t\t\tvar $largeVideo = $(\"<span class='interface-btn enlarge-btn buttonicon'>\").attr('title', 'Make video larger').on({\r\n\t\t\t\tclick: function click() {\r\n\t\t\t\t\tvideoEnlarged = !videoEnlarged;\r\n\r\n\t\t\t\t\tif (videoEnlarged) {\r\n\t\t\t\t\t\tenlargedVideos.add(userId);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tenlargedVideos['delete'](userId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$largeVideo.attr('title', videoEnlarged ? 'Make video smaller' : 'Make video larger').toggleClass('large', videoEnlarged);\r\n\r\n\t\t\t\t\tvar videoSize = $(document).find('#wrtc_modal .ndbtn.btn_enlarge').hasClass('large') ? videoSizes.large : videoSizes.small;\r\n\t\t\t\t\t$video.parent().css({ width: videoSize, 'max-height': videoSize });\r\n\t\t\t\t\t$video.css({ width: videoSize, 'max-height': videoSize });\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif($(document).find('#wrtc_modal .ndbtn.btn_enlarge').hasClass('large')){\r\n\t\t\t\t$video.parent().css({ width: videoSizes.large, 'max-height': videoSizes.large });\r\n\t\t\t\t$video.css({ width: videoSizes.large, 'max-height': videoSizes.large });\r\n\t\t\t}\r\n\r\n\t\t\tif(isLocal) localVideoElement = $video;\r\n\r\n\t\t\t$('#interface_' + videoId).remove();\r\n\t\t\t$(\"<div class='interface-container'>\").attr('id', 'interface_' + videoId).append($mute).append($disableVideo).append($largeVideo).insertAfter($video);\r\n\t\t\tself.changeAudioDestination();\r\n\t\t},\r\n\t\t// Sends a stat to the back end. `statName` must be in the\r\n\t\t// approved list on the server side.\r\n\t\tsendErrorStat: function sendErrorStat(statName) {\r\n\t\t\tvar msg = { component: 'pad', type: 'STATS', data: { statName: statName, type: 'RTC_MESSAGE' } };\r\n\t\t\tself._pad.socket.json.send(msg);\r\n\t\t},\r\n\t\tsendMessage: function sendMessage(to, data) {\r\n\t\t\tself._pad.collabClient.sendMessage({\r\n\t\t\t\ttype: 'RTC_MESSAGE',\r\n\t\t\t\tpayload: { data: data, to: to }\r\n\t\t\t});\r\n\t\t},\r\n\t\treceiveMessage: function receiveMessage(msg) {\r\n\t\t\tvar peer = msg.from;\r\n\t\t\tvar data = msg.data;\r\n\t\t\tvar type = data.type;\r\n\t\t\tif (peer === share.getUserId()) {\r\n\t\t\t\t// console.info('ignore own messages');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t/*\r\n      if (type != 'icecandidate')\r\n        console.info('receivedMessage', 'peer', peer, 'type', type, 'data', data);\r\n      */\r\n\t\t\tif (type === 'hangup') {\r\n\t\t\t\tself.hangup(peer, true);\r\n\t\t\t} else if (type === 'offer') {\r\n\t\t\t\tif (pc[peer]) {\r\n\t\t\t\t\tself.hangup(peer, true);\r\n\t\t\t\t\tself.createPeerConnection(peer, data.headerId);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.createPeerConnection(peer, data.headerId);\r\n\t\t\t\t}\r\n\t\t\t\tif (localStream) {\r\n\t\t\t\t\tif (pc[peer].getLocalStreams) {\r\n\t\t\t\t\t\tif (!pc[peer].getLocalStreams().length) {\r\n\t\t\t\t\t\t\tpc[peer].addStream(localStream);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (pc[peer].localStreams) {\r\n\t\t\t\t\t\tif (!pc[peer].localStreams.length) {\r\n\t\t\t\t\t\t\tpc[peer].addStream(localStream);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar offer = new RTCSessionDescription(data.offer);\r\n\t\t\t\tpc[peer].setRemoteDescription(offer, function () {\r\n\t\t\t\t\tpc[peer].createAnswer(function (desc) {\r\n\t\t\t\t\t\tdesc.sdp = cleanupSdp(desc.sdp);\r\n\t\t\t\t\t\tpc[peer].setLocalDescription(desc, function () {\r\n\t\t\t\t\t\t\tself.sendMessage(peer, { type: 'answer', answer: desc, headerId: data.headerId });\r\n\t\t\t\t\t\t}, logError);\r\n\t\t\t\t\t}, logError, sdpConstraints);\r\n\t\t\t\t}, logError);\r\n\t\t\t} else if (type === 'answer') {\r\n\t\t\t\tif (pc[peer]) {\r\n\t\t\t\t\tvar answer = new RTCSessionDescription(data.answer);\r\n\t\t\t\t\tpc[peer].setRemoteDescription(answer, function () {}, logError);\r\n\t\t\t\t}\r\n\t\t\t} else if (type === 'icecandidate') {\r\n\t\t\t\tif (pc[peer]) {\r\n\t\t\t\t\tvar candidate = new RTCIceCandidate(data.candidate);\r\n\t\t\t\t\tvar p = pc[peer].addIceCandidate(candidate);\r\n\t\t\t\t\tif (p) {\r\n\t\t\t\t\t\tp.then(function () {\r\n\t\t\t\t\t\t\t// Do stuff when the candidate is successfully passed to the ICE agent\r\n\t\t\t\t\t\t})['catch'](function () {\r\n\t\t\t\t\t\t\tconsole.error('Error: Failure during addIceCandidate()', data);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error('unknown message', data);\r\n\t\t\t}\r\n\t\t},\r\n\t\thangupAll: function hangupAll(_headerId) {\r\n\t\t\tObject.keys(pc).forEach(function (userId) {\r\n\t\t\t\tself.hangup(userId, true, _headerId);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetUserId: function getUserId() {\r\n\t\t\treturn self._pad && share.getUserId();\r\n\t\t},\r\n\t\thangup: function hangup(userId, notify, headerId) {\r\n\t\t\tnotify = arguments.length === 1 ? true : notify;\r\n\t\t\tif (pc[userId] && userId !== share.getUserId()) {\r\n\t\t\t\tself.setStream(userId, '');\r\n\t\t\t\tpc[userId].close();\r\n\t\t\t\tdelete pc[userId];\r\n\t\t\t\tif (notify) self.sendMessage(userId, { type: 'hangup', headerId: headerId });\r\n\t\t\t}\r\n\t\t},\r\n\t\tcall: function call(userId, headerId) {\r\n\t\t\tif (!localStream) {\r\n\t\t\t\tcallQueue.push(userId);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar constraints = { optional: [], mandatory: {} };\r\n\t\t\t// temporary measure to remove Moz* constraints in Chrome\r\n\t\t\tif (webrtcDetectedBrowser === 'chrome') {\r\n\t\t\t\tfor (var prop in constraints.mandatory) {\r\n\t\t\t\t\tif (prop.indexOf('Moz') !== -1) {\r\n\t\t\t\t\t\tdelete constraints.mandatory[prop];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconstraints = mergeConstraints(constraints, sdpConstraints);\r\n\r\n\t\t\tif (!pc[userId]) {\r\n\t\t\t\tself.createPeerConnection(userId, headerId);\r\n\t\t\t}\r\n\t\t\tpc[userId].addStream(localStream);\r\n\t\t\tpc[userId].createOffer(function (desc) {\r\n\t\t\t\tdesc.sdp = cleanupSdp(desc.sdp);\r\n\t\t\t\tpc[userId].setLocalDescription(desc, function () {\r\n\t\t\t\t\tself.sendMessage(userId, { type: 'offer', offer: desc, headerId: headerId });\r\n\t\t\t\t}, logError);\r\n\t\t\t}, logError, constraints);\r\n\t\t},\r\n\t\tcreatePeerConnection: function createPeerConnection(userId, headerId) {\r\n\t\t\tif (pc[userId]) {\r\n\t\t\t\tconsole.warn('WARNING creating PC connection even though one exists', userId);\r\n\t\t\t}\r\n\t\t\tpc[userId] = new RTCPeerConnection(pcConfig, pcConstraints);\r\n\t\t\tpc[userId].onicecandidate = function (event) {\r\n\t\t\t\tif (event.candidate) {\r\n\t\t\t\t\tself.sendMessage(userId, {\r\n\t\t\t\t\t\ttype: 'icecandidate',\r\n\t\t\t\t\t\theaderId: headerId,\r\n\t\t\t\t\t\tcandidate: event.candidate\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tattemptRonnect = 0;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tpc[userId].onaddstream = function (event) {\r\n\t\t\t\tremoteStream[userId] = event.stream;\r\n\t\t\t\tself.setStream(userId, event.stream);\r\n\t\t\t};\r\n\t\t\tpc[userId].onremovestream = function () {\r\n\t\t\t\tself.setStream(userId, '');\r\n\t\t\t};\r\n\t\t},\r\n\t\taudioVideoInputChange: function audioVideoInputChange() {\r\n\t\t\tshare.stopStreaming(localStream);\r\n\t\t\tlocalStream = null\r\n\r\n\t\t\tself.getUserMedia(window.headerId);\r\n\t\t},\r\n\t\tattachSinkId: function attachSinkId(element, sinkId) {\r\n\t\t\t// Attach audio output device to video element using device/sink ID.\r\n\t\t\tif (element && element[0] && typeof element[0].sinkId !== 'undefined') {\r\n\t\t\t\telement[0].setSinkId(sinkId)\r\n\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\t// console.info(`Success, audio output device attached: ${sinkId}`);\r\n\t\t\t\t\t\t})['catch'](error => {\r\n\t\t\t\t\t\t\tvar errorMessage = error;\r\n\t\t\t\t\t\t\tif (error.name === 'SecurityError') {\r\n\t\t\t\t\t\t\t\terrorMessage = `You need to use HTTPS for selecting audio output device: ${error}`;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconsole.error(errorMessage);\r\n\t\t\t\t\t\t\t// Jump back to first output device in the list as it's the default.\r\n\t\t\t\t\t\t\taudioOutputSelect.selectedIndex = 0;\r\n\t\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn('Browser does not support output device selection.');\r\n\t\t\t}\r\n\t\t},\r\n\t\tchangeAudioDestination: function changeAudioDestination() {\r\n\t\t\tvar audioOutputSelect = document.querySelector('select#audioOutput');\r\n\t\t\tvar audioDestination = audioOutputSelect.value;\r\n\t\t\tvar videoElement = localVideoElement\r\n\t\t\tself.attachSinkId(videoElement, audioDestination);\r\n\t\t},\r\n\t\tgetUserMedia: function getUserMedia(headerId) {\r\n\t\t\taudioInputSelect = document.querySelector('select#audioSource');\r\n\t\t\tvideoSelect = document.querySelector('select#videoSource');\r\n\t\t\taudioOutputSelect = document.querySelector('select#audioOutput');\r\n\t\t\t\r\n\t\t\tvar audioSource = audioInputSelect.value;\r\n\t\t\tvar videoSource = videoSelect.value;\r\n\t\t\tvar audioOutput = audioOutputSelect.value;\r\n\r\n\t\t\tvar mediaConstraints = {\r\n\t\t\t\taudio: true,\r\n\t\t\t\tvideo: {\r\n\t\t\t\t\twidth: {exact: 320},\r\n\t\t\t\t\theight: {exact: 240},\r\n\t\t\t\t\tframeRate: { ideal: 15, max: 30 },\r\n\t\t\t\t\tfacingMode: \"user\" \r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif (audioSource) {\r\n\t\t\t\tmediaConstraints.audio.deviceId = { exact: audioSource };\r\n\t\t\t}\r\n\t\t\tif (videoSource) {\r\n\t\t\t\tmediaConstraints.video.deviceId = { exact: videoSource };\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlocalStorage.setItem('videoSettings', JSON.stringify({ microphone: audioSource, speaker: audioOutput, camera: videoSource }));\r\n\r\n\t\t\twindow.navigator.mediaDevices.getUserMedia(mediaConstraints).then(function (stream) {\r\n\t\t\t\tlocalStream = stream;\r\n\t\t\t\tself.setStream(share.getUserId(), stream);\r\n\t\t\t\tself._pad.collabClient.getConnectedUsers().forEach(function (user) {\r\n\t\t\t\t\tif (user.userId !== share.getUserId()) {\r\n\t\t\t\t\t\tif (pc[user.userId]) {\r\n\t\t\t\t\t\t\tself.hangup(user.userId, false, headerId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tself.call(user.userId, headerId);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})['catch'](function (err) {\r\n\t\t\t\tself.showUserMediaError(err);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t// Normalize RTC implementation between browsers\r\n\t// var getUserMedia = window.navigator.mediaDevices.getUserMedia\r\n\tvar attachMediaStream = function attachMediaStream(element, stream) {\r\n\t\tif (typeof element.srcObject !== 'undefined') {\r\n\t\t\telement.srcObject = stream;\r\n\t\t} else if (typeof element.mozSrcObject !== 'undefined') {\r\n\t\t\telement.mozSrcObject = stream;\r\n\t\t} else if (typeof element.src !== 'undefined') {\r\n\t\t\telement.src = URL.createObjectURL(stream);\r\n\t\t} else {\r\n\t\t\tconsole.error('Error attaching stream to element.', element);\r\n\t\t}\r\n\t};\r\n\tvar webrtcDetectedBrowser = 'chrome';\r\n\r\n\tfunction cleanupSdp(sdp) {\r\n\t\tvar bandwidth = {\r\n\t\t\tscreen: 300, // 300kbits minimum\r\n\t\t\taudio: 64,   // 64kbits  minimum\r\n\t\t\tvideo: 300,\r\n\t\t\tminVideo: 128, // 125kbits  min\r\n\t\t\tmaxVideo: 1024, // 125kbits  max\r\n\t\t\tvideoCodec: clientVars.webrtc.video.codec\r\n\t\t};\r\n\r\n\t\tvar isScreenSharing = false;\r\n\r\n\t\tsdp = CodecsHandler.setApplicationSpecificBandwidth(sdp, bandwidth, isScreenSharing);\r\n\t\tsdp = CodecsHandler.setVideoBitrates(sdp, {\r\n\t\t\tmin: bandwidth.minVideo,\r\n\t\t\tmax: bandwidth.maxVideo,\r\n\t\t\tcodec: bandwidth.videoCodec\r\n\t\t});\r\n\t\tsdp = CodecsHandler.setOpusAttributes(sdp);\r\n\t\tsdp = CodecsHandler.preferCodec(sdp, bandwidth.videoCodec)\r\n\r\n\t\treturn sdp;\r\n\t}\r\n\r\n\tfunction mergeConstraints(cons1, cons2) {\r\n\t\tvar merged = cons1;\r\n\t\tfor (var name in cons2.mandatory) {\r\n\t\t\tmerged.mandatory[name] = cons2.mandatory[name];\r\n\t\t}\r\n\t\tmerged.optional.concat(cons2.optional);\r\n\t\treturn merged;\r\n\t}\r\n\r\n\tfunction randomIntFromInterval(min, max) {\r\n\t\treturn Math.floor(Math.random() * (max - min + 1) + min);\r\n\t}\r\n\r\n\tfunction logError(error) {\r\n\t\tif(error && error.message.includes(\"Failed to set remote answer sdp\")){\r\n\t\t\treconnected++;\r\n\t\t\tconsole.log(\"[wrtc]: Try reconnecting\", reconnected, attemptRonnect);\r\n\t\t\tif(attemptRonnect <= reconnected)\r\n\t\t\t\tthrow new Error(\"[wrtc]: please reload the video chat and try again to connect!\");\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tconsole.log(\"[wrtc]: reconnecting...\")\r\n\t\t\t\tself.getUserMedia(window.headerId)\r\n\t\t\t}, randomIntFromInterval(200, 1000));\r\n\t\t}\r\n\t\tconsole.error('WebRTC ERROR:', error);\r\n\t}\r\n\r\n\tself.pc = pc;\r\n\treturn self;\r\n})();\r\n"]}